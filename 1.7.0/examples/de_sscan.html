

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>The synApps sscan and SscanRecord &#8212; apstools 1.7</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.5ea377869091fd0449014c60fc090103.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/design-tabs.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'examples/de_sscan';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.15.4';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://raw.githubusercontent.com/BCDA-APS/apstools/main/docs/source/_static/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = '1.7.0';
        DOCUMENTATION_OPTIONS.show_version_warning_banner = false;
        </script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="File Writer Examples" href="filewriter_examples.html" />
    <link rel="prev" title="Integration with APS Data Management (DM)" href="de_aps_data_management.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">apstools 1.7</p>
  
</a></div>
    
      <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-2"
      type="button"
      class="version-switcher__button btn btn-sm dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-2"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-2"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-2">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../install.html">
    Installation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../api/index.html">
    API Documentation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../applications/index.html">
    Applications
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../changes.html">
    Change History
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../license.html">
    License
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/BCDA-APS/apstools" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../install.html">
    Installation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../api/index.html">
    API Documentation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../applications/index.html">
    Applications
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../changes.html">
    Change History
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../license.html">
    License
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/BCDA-APS/apstools" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="device_examples.html">Device Examples</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="de_0_adsim_hdf5_basic.html">Area Detector with default HDF5 File Name</a></li>
<li class="toctree-l2"><a class="reference internal" href="de_1_adsim_hdf5_custom_names.html">Area Detector with custom HDF5 File Name</a></li>
<li class="toctree-l2"><a class="reference internal" href="de_2_adsim_hdf5_single_mode.html">Area Detector, Single mode, HDF5 file</a></li>
<li class="toctree-l2"><a class="reference internal" href="de_ad_pe.html">ADPerkinElmer Area Detector with default HDF5 File Name</a></li>
<li class="toctree-l2"><a class="reference internal" href="de_ad_pilatus.html">ADPilatus Area Detector with default HDF5 File Name</a></li>
<li class="toctree-l2"><a class="reference internal" href="de_aps_data_management.html">Integration with APS Data Management (DM)</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">The synApps <code class="docutils literal notranslate"><span class="pre">sscan</span></code> and <code class="docutils literal notranslate"><span class="pre">SscanRecord</span></code></a></li>
</ul>
</details></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="filewriter_examples.html">File Writer Examples</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="fw_nxwriter.html">Callback</a></li>

<li class="toctree-l2"><a class="reference internal" href="fw_specfile_example.html">Output scan(s) to a SPEC data file.</a></li>
</ul>
</details></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="howto_examples.html">How-To Examples</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="ho_contingency.html">How to interrupt/stop/abort a running plan &amp; recover to safe settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="ho_list_control_objects.html">What are the objects to control?</a></li>
<li class="toctree-l2"><a class="reference internal" href="ho_nxwriter_templates.html">How to use NeXus/HDF5 Templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="ho_search_databroker.html">How to Search for Bluesky Data?</a></li>
<li class="toctree-l2"><a class="reference internal" href="ho_session_logs.html">How to setup logging</a></li>
</ul>
</details></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="plan_examples.html">Plan Examples</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="pl_excel_scan.html">The <code class="docutils literal notranslate"><span class="pre">Excel_plan()</span></code> – batch scans using a spreadsheet</a></li>
<li class="toctree-l2"><a class="reference internal" href="pl_lineup.html">The <code class="docutils literal notranslate"><span class="pre">lineup()</span></code> plan - align an axis with a signal</a></li>
<li class="toctree-l2"><a class="reference internal" href="pl_nscan.html">The <code class="docutils literal notranslate"><span class="pre">nscan()</span></code> plan – scan multiple axes together</a></li>
<li class="toctree-l2"><a class="reference internal" href="pl_run_command_list.html">The <code class="xref py py-func docutils literal notranslate"><span class="pre">run_command_file()</span></code> plan – batch scans using a text file</a></li>
<li class="toctree-l2"><a class="reference internal" href="pl_tuneaxis.html">The <code class="docutils literal notranslate"><span class="pre">TuneAxis()</span></code> plan - align an axis with a signal</a></li>
</ul>
</details></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="download_examples.html">File Downloads for the Examples</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">Examples</a></li>
    
    
    <li class="breadcrumb-item"><a href="device_examples.html" class="nav-link">Device Examples</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">The synApps...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="The-synApps-sscan-and-SscanRecord">
<h1>The synApps <code class="docutils literal notranslate"><span class="pre">sscan</span></code> and <code class="docutils literal notranslate"><span class="pre">SscanRecord</span></code><a class="headerlink" href="#The-synApps-sscan-and-SscanRecord" title="Permalink to this heading">#</a></h1>
<p>The synApps <code class="docutils literal notranslate"><span class="pre">sscan</span></code> record is used to measure scans of detector(s) <em>v</em>. positioner(s).</p>
<p><strong>Goals</strong>: Demonstrate use of the <code class="docutils literal notranslate"><span class="pre">sscan</span></code> record with Bluesky.</p>
<ol class="arabic simple">
<li><p>Press SCAN button of a preconfigured scan.</p></li>
<li><p>Same example as section 1, but uses <a class="reference external" href="https://bcda-aps.github.io/apstools/latest/api/synApps/_sscan.html">SscanRecord</a> instead of <a class="reference external" href="https://blueskyproject.io/ophyd/user/tutorials/single-PV.html">EpicsSignal</a>.</p></li>
<li><p>Setup the same scan from bluesky.</p></li>
<li><p>Add the scan data as a bluesky run.</p></li>
</ol>
<p>This notebook is intended for those who are familiar with EPICS and its motor, scaler, and sscan records but are new to Bluesky.</p>
<section id="sscan-record-configuration">
<h2>sscan record configuration<a class="headerlink" href="#sscan-record-configuration" title="Permalink to this heading">#</a></h2>
<p>Consider this <code class="docutils literal notranslate"><span class="pre">sscan</span></code> record (<code class="docutils literal notranslate"><span class="pre">gp:scan1</span></code>) which is configured for a step scan of <code class="docutils literal notranslate"><span class="pre">scaler</span></code> (<code class="docutils literal notranslate"><span class="pre">gp:scaler1</span></code>) <em>vs.</em> <code class="docutils literal notranslate"><span class="pre">motor</span></code> (<code class="docutils literal notranslate"><span class="pre">gp:m1</span></code>).</p>
<p>Figure (1a) shows <code class="docutils literal notranslate"><span class="pre">gp:scan1</span></code> configured to step scan motor <code class="docutils literal notranslate"><span class="pre">m1</span></code> from -1.2 to 1.2 in 21 points, collecting counts from scaler <code class="docutils literal notranslate"><span class="pre">gp:scaler1</span></code> channels 2 &amp; 4 (<code class="docutils literal notranslate"><span class="pre">I0</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">diode</span></code>, respectively). Figure (1b) shows <code class="docutils literal notranslate"><span class="pre">gp:scaler1</span></code> configured with a counting time of 0.2 seconds per point and several detector channels.</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Figure (1a) scan</p></th>
<th class="head"><p>Figure (1b) scaler</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><img alt="scan1 setup" src="../_images/sscan-scaler-v-motor.png" /></p></td>
<td><p><img alt="scaler1 setup" src="../_images/scaler16.png" /></p></td>
</tr>
</tbody>
</table>
</div>
<p>The <em>SCAN</em> button is connected to EPICS PV <code class="docutils literal notranslate"><span class="pre">gp:scan1.EXSC</span></code>. The scan starts when SCAN is pressed. (Try it.) When the <em>SCAN</em> button is pressed, the GUI sends <code class="docutils literal notranslate"><span class="pre">1</span></code> to the EPICS PV and the scan starts. When the scan finishes (or aborts), the value of the PV changes to <code class="docutils literal notranslate"><span class="pre">0</span></code> which is then sent back to the GUI.</p>
</section>
<section id="Python-setup">
<h2>Python setup<a class="headerlink" href="#Python-setup" title="Permalink to this heading">#</a></h2>
<p>All these examples need this minimum setup. The first example will not need any databroker catalog. The EPICS IOC has a prefix of <code class="docutils literal notranslate"><span class="pre">gp:</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">bluesky</span>
<span class="kn">import</span> <span class="nn">bluesky.plan_stubs</span> <span class="k">as</span> <span class="nn">bps</span>

<span class="n">RE</span> <span class="o">=</span> <span class="n">bluesky</span><span class="o">.</span><span class="n">RunEngine</span><span class="p">()</span>
<span class="n">IOC</span> <span class="o">=</span> <span class="s2">&quot;gp:&quot;</span>
</pre></div>
</div>
</div>
</section>
<section id="1.-Press-SCAN-button-of-a-preconfigured-scan">
<h2>1. Press SCAN button of a preconfigured scan<a class="headerlink" href="#1.-Press-SCAN-button-of-a-preconfigured-scan" title="Permalink to this heading">#</a></h2>
<p>Above, we said the scan can be run by pressing the <em>SCAN</em> button in the GUI. Let’s do the same thing with bluesky. That is, we’ll have bluesky press the <em>SCAN</em> button and then wait for the scan to end.</p>
<p>First, connect with the EPICS PV of the <em>SCAN</em> button (<code class="docutils literal notranslate"><span class="pre">gp:scan1.EXSC</span></code>) using <code class="docutils literal notranslate"><span class="pre">ophyd.EpicsSignal</span></code>. Once the object is connected with the EPICS PV, show the current value of the PV.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ophyd</span> <span class="kn">import</span> <span class="n">EpicsSignal</span>

<span class="n">scan_button</span> <span class="o">=</span> <span class="n">EpicsSignal</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">IOC</span><span class="si">}</span><span class="s2">scan1.EXSC&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;scan_button&quot;</span><span class="p">)</span>
<span class="n">scan_button</span><span class="o">.</span><span class="n">wait_for_connection</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">scan_button</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0
</pre></div></div>
</div>
<p>Write a bluesky plan that starts the scan (by pushing the button) and watches the button’s value until it reports the scan ended. As written above, we know exactly when the scan has ended when the button value changes from <code class="docutils literal notranslate"><span class="pre">1</span></code> to <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p>
<p>We use <code class="docutils literal notranslate"><span class="pre">bps.sleep()</span></code> here to allow the <code class="docutils literal notranslate"><span class="pre">RE</span></code> to attend to its other responsibilities while waiting, rather than <code class="docutils literal notranslate"><span class="pre">time.sleep()</span></code> which would suspend all python activities (i.e. block the <code class="docutils literal notranslate"><span class="pre">RE</span></code>).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">run_sscan</span><span class="p">():</span>
    <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">mv</span><span class="p">(</span><span class="n">scan_button</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Wait for the scan to end with a polling loop.</span>
    <span class="k">while</span> <span class="n">scan_button</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>NOTE: The polling loop, used by this simple example, is not recommended for bluesky plans.</p>
<details><p>Use a Status object instead of a polling loop.</p>
<p>Polling loops are discouraged because:</p>
<ul class="simple">
<li><p>they are not efficient (involving waiting periods of empirical duration)</p></li>
<li><p>they do not handle timeouts, settling times, Python exceptions</p></li>
<li><p>the <code class="docutils literal notranslate"><span class="pre">RE</span></code> already has a main event loop</p></li>
<li><p>we often want to watch <em>multiple</em> <a class="reference external" href="https://blueskyproject.io/ophyd/user/tutorials/single-PV.html#set">signals</a> with different update rates or complex logic</p></li>
</ul>
<p>Instead of polling the value of an EpicsSignal, it is more efficient to start an EPICS CA monitor on the EpicsSignal. When new values of the signal are reported by EPICS as CA monitor events, a designated <em>callback</em> function is called to respond.</p>
<p>Ophyd <a class="reference external" href="https://blueskyproject.io/ophyd/ser/generated/ophyd.status.Status.html#ophyd.status.Status">Status</a> objects track actions, like moving and triggering, that could take some time to complete. These ophyd status objects have additional features such as timeout and settling time.</p>
<p>See the ophyd <a class="reference external" href="https://blueskyproject.io/tutorials/Ophyd/02%20-%20Complex%20Behaviors%20%28Set%20and%20Multiple%20PVs%29.html#adding-a-set-method-to-device">tutorial</a> for use of a status object with a <code class="docutils literal notranslate"><span class="pre">.set()</span></code> method (which is the method called by <code class="docutils literal notranslate"><span class="pre">bps.mv()</span></code>). It is not intuitive to use <code class="docutils literal notranslate"><span class="pre">bps.mv(scan_button,</span> <span class="pre">1)</span></code> here. That would only trigger the scan to <em>start</em> but would not wait for the scan button value to return to <code class="docutils literal notranslate"><span class="pre">0</span></code>. We also want to wait until the scan is complete.</p>
<p>Instead, <code class="docutils literal notranslate"><span class="pre">bps.trigger(ophyd_object)</span></code> tells the ophyd object (such as a scaler or area detector) to acquire its data. This triggers the ophyd object (by calling the object’s <code class="docutils literal notranslate"><span class="pre">.trigger()</span></code> method which returns an ophyd Status object) and (optionally) waits for that status object to report it is done.</p>
<p>We can add such a <code class="docutils literal notranslate"><span class="pre">.trigger()</span></code> method if we create a subclass of <code class="docutils literal notranslate"><span class="pre">EpicsSignal</span></code>. The <code class="docutils literal notranslate"><span class="pre">.trigger()</span></code> method is called from a bluesky plan using <code class="docutils literal notranslate"><span class="pre">bps.trigger(scan_button)</span></code>.</p>
<p>In our <code class="docutils literal notranslate"><span class="pre">.trigger()</span></code> method, our status object is built from the <a class="reference external" href="https://blueskyproject.io/ophyd/user/generated/ophyd.status.SubscriptionStatus.html#ophyd-status-subscriptionstatus">SubscriptionStatus</a> class, which manages the subscription to CA monitor events. The designated function receives <code class="docutils literal notranslate"><span class="pre">old_value</span></code> and <code class="docutils literal notranslate"><span class="pre">value</span></code> from a CA monitor event and returns a boolean value. Once the scan ends, the status object is set to <code class="docutils literal notranslate"><span class="pre">done=True</span></code> and <code class="docutils literal notranslate"><span class="pre">success=True</span></code> and the CA monitor subscription is
removed.</p>
<p>Here is the code for the scan button, written with a status object:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bluesky</span> <span class="kn">import</span> <span class="n">plan_stubs</span> <span class="k">as</span> <span class="n">bps</span>
<span class="kn">from</span> <span class="nn">ophyd</span> <span class="kn">import</span> <span class="n">EpicsSignal</span>
<span class="kn">from</span> <span class="nn">ophyd.status</span> <span class="kn">import</span> <span class="n">SubscriptionStatus</span>

<span class="k">class</span> <span class="nc">MySscanScanButton</span><span class="p">(</span><span class="n">EpicsSignal</span><span class="p">):</span>
    <span class="n">timeout</span> <span class="o">=</span> <span class="mi">60</span>

    <span class="k">def</span> <span class="nf">trigger</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Start the scan and return status to monitor completion.</span>

<span class="sd">        This method is called from &#39;bps.trigger(scan_button, wait=True)&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">just_ended</span><span class="p">(</span><span class="n">old_value</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Returns True when scan ends (signal changes from 1 to 0).&quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="n">old_value</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">0</span>

        <span class="c1"># Starts an EPICS CA monitor on this signal and calls &#39;just_ended()&#39; with updates.</span>
        <span class="c1"># Once the status object is set to done, the CA subscription will be ended.</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">SubscriptionStatus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">just_ended</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">)</span>

        <span class="c1"># Push the scan button...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># And return the status object.</span>
        <span class="c1"># The caller can use it to tell when the scan is complete.</span>
        <span class="k">return</span> <span class="n">status</span>

<span class="n">scan_button</span> <span class="o">=</span> <span class="n">MySscanScanButton</span><span class="p">(</span><span class="s2">&quot;gp:scan1.EXSC&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;scan_button&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">run_sscan</span><span class="p">():</span>
    <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="n">scan_button</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</details><p>Execute the <code class="docutils literal notranslate"><span class="pre">run_sscan()</span></code> plan using the bluesky RunEngine <code class="docutils literal notranslate"><span class="pre">RE</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">run_sscan</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
()
</pre></div></div>
</div>
<p>We’ll get the data arrays from the <code class="docutils literal notranslate"><span class="pre">sscan</span></code> record in a later section of this notebook.</p>
</section>
<section id="2.-Run-preconfigured-sscan-record">
<h2>2. Run preconfigured <code class="docutils literal notranslate"><span class="pre">sscan</span></code> record<a class="headerlink" href="#2.-Run-preconfigured-sscan-record" title="Permalink to this heading">#</a></h2>
<p>The <a class="reference external" href="https://bcda-aps.github.io/apstools/latest/api/synApps/_sscan.html#apstools.synApps.sscan.SscanRecord">SscanRecord</a> class from <code class="docutils literal notranslate"><span class="pre">apstools.synApps</span></code> provides access to most fields of the <code class="docutils literal notranslate"><span class="pre">sscan</span></code> record. Use <code class="docutils literal notranslate"><span class="pre">SscanRecord</span></code> to connect with <code class="docutils literal notranslate"><span class="pre">gp:scan1</span></code>. Repeat the above example. In the <code class="docutils literal notranslate"><span class="pre">SscanRecord</span></code> class, the scan button is called <code class="docutils literal notranslate"><span class="pre">execute_scan</span></code>.</p>
<p><em>Again, it is recommended to use an ophyd Status object instead of a polling loop.</em></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">apstools.synApps</span> <span class="kn">import</span> <span class="n">SscanRecord</span>

<span class="n">scan1</span> <span class="o">=</span> <span class="n">SscanRecord</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">IOC</span><span class="si">}</span><span class="s2">scan1&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;scan1&quot;</span><span class="p">)</span>
<span class="n">scan1</span><span class="o">.</span><span class="n">wait_for_connection</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">run_sscan</span><span class="p">():</span>
    <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">mv</span><span class="p">(</span><span class="n">scan1</span><span class="o">.</span><span class="n">execute_scan</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Again, it is advised to use a Status object instead of a polling loop.</span>
    <span class="c1"># Wait for the scan to end with a polling loop.</span>
    <span class="k">while</span> <span class="n">scan1</span><span class="o">.</span><span class="n">execute_scan</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">run_sscan</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
()
</pre></div></div>
</div>
<section id="Get-the-data-arrays-from-the-sscan-record">
<h3>Get the data arrays from the <code class="docutils literal notranslate"><span class="pre">sscan</span></code> record<a class="headerlink" href="#Get-the-data-arrays-from-the-sscan-record" title="Permalink to this heading">#</a></h3>
<p>Retrieve the data collected by <code class="docutils literal notranslate"><span class="pre">scan1</span></code> as a dictionary of numpy arrays. Include the motor and both detectors. The <code class="docutils literal notranslate"><span class="pre">sscan</span></code> record has buffers capable of collecting as many as 1,000 points per array (in its default configuration). First get the number of points collected, then limit each array length to that number.</p>
<p>Write this as a function so it can be called again later. It does not have any statements that would block the RunEngine and it executes quickly. It does not need to be written as a bluesky plan.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_sscan_data</span><span class="p">():</span>
    <span class="n">npts</span> <span class="o">=</span> <span class="n">scan1</span><span class="o">.</span><span class="n">current_point</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;m1&quot;</span><span class="p">:</span> <span class="n">scan1</span><span class="o">.</span><span class="n">positioners</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">get</span><span class="p">()[:</span><span class="n">npts</span><span class="p">],</span>
        <span class="s2">&quot;I0&quot;</span><span class="p">:</span> <span class="n">scan1</span><span class="o">.</span><span class="n">detectors</span><span class="o">.</span><span class="n">d01</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">get</span><span class="p">()[:</span><span class="n">npts</span><span class="p">],</span>
        <span class="s2">&quot;diode&quot;</span><span class="p">:</span> <span class="n">scan1</span><span class="o">.</span><span class="n">detectors</span><span class="o">.</span><span class="n">d02</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">get</span><span class="p">()[:</span><span class="n">npts</span><span class="p">],</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">data</span>

<span class="n">get_sscan_data</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;m1&#39;: array([-1.2 , -1.08, -0.96, -0.84, -0.72, -0.6 , -0.48, -0.36, -0.24,
        -0.12,  0.  ,  0.12,  0.24,  0.36,  0.48,  0.6 ,  0.72,  0.84,
         0.96,  1.08,  1.2 ]),
 &#39;I0&#39;: array([1., 1., 1., 1., 1., 1., 1., 1., 2., 3., 3., 4., 4., 2., 1., 1., 1.,
        1., 1., 1., 2.], dtype=float32),
 &#39;diode&#39;: array([2., 1., 0., 1., 2., 0., 1., 1., 2., 2., 4., 3., 3., 3., 1., 1., 1.,
        2., 2., 2., 1.], dtype=float32)}
</pre></div></div>
</div>
</section>
</section>
<section id="3.-Setup-and-run-same-scan-from-bluesky">
<h2>3. Setup and run same scan from bluesky<a class="headerlink" href="#3.-Setup-and-run-same-scan-from-bluesky" title="Permalink to this heading">#</a></h2>
<p>Repeat the scan from the previous examples, but use bluesky to configure <code class="docutils literal notranslate"><span class="pre">scan1</span></code>. It will be useful to connect the motor, the scaler, and two of the scaler channels.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ophyd</span> <span class="kn">import</span> <span class="n">EpicsMotor</span>
<span class="kn">from</span> <span class="nn">ophyd.scaler</span> <span class="kn">import</span> <span class="n">ScalerCH</span>

<span class="n">m1</span> <span class="o">=</span> <span class="n">EpicsMotor</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">IOC</span><span class="si">}</span><span class="s2">m1&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;m1&quot;</span><span class="p">)</span>
<span class="n">scaler1</span> <span class="o">=</span> <span class="n">ScalerCH</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">IOC</span><span class="si">}</span><span class="s2">scaler1&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;scaler1&quot;</span><span class="p">)</span>
<span class="n">m1</span><span class="o">.</span><span class="n">wait_for_connection</span><span class="p">()</span>
<span class="n">scaler1</span><span class="o">.</span><span class="n">wait_for_connection</span><span class="p">()</span>

<span class="c1"># for convenience</span>
<span class="n">I0</span> <span class="o">=</span> <span class="n">scaler1</span><span class="o">.</span><span class="n">channels</span><span class="o">.</span><span class="n">chan02</span><span class="o">.</span><span class="n">s</span>
<span class="n">diode</span> <span class="o">=</span> <span class="n">scaler1</span><span class="o">.</span><span class="n">channels</span><span class="o">.</span><span class="n">chan04</span><span class="o">.</span><span class="n">s</span>
</pre></div>
</div>
</div>
<p>We can supply the count time per point and scan range parameters as arguments to the setup. After setting the counting time for the scaler, the next step in the setup is to clear any existing configuration of <code class="docutils literal notranslate"><span class="pre">scan1</span></code> using its <code class="docutils literal notranslate"><span class="pre">reset()</span></code> method. Because <code class="docutils literal notranslate"><span class="pre">scan1.reset()</span></code> was written as an ophyd function, we’ll call it with <code class="docutils literal notranslate"><span class="pre">yield</span> <span class="pre">from</span> <span class="pre">run_blocking_function(scan1.reset)</span></code>.</p>
<p>Finally, we’ll setup <code class="docutils literal notranslate"><span class="pre">scan1</span></code> with the EPICS PV names to be used.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">apstools.plans</span> <span class="kn">import</span> <span class="n">run_blocking_function</span>

<span class="k">def</span> <span class="nf">setup_scan1</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">finish</span><span class="p">,</span> <span class="n">npts</span><span class="p">,</span> <span class="n">ct</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">mv</span><span class="p">(</span><span class="n">scaler1</span><span class="o">.</span><span class="n">preset_time</span><span class="p">,</span> <span class="n">ct</span><span class="p">)</span>  <span class="c1"># counting time/point</span>
    <span class="k">yield from</span> <span class="n">run_blocking_function</span><span class="p">(</span><span class="n">scan1</span><span class="o">.</span><span class="n">reset</span><span class="p">)</span>
    <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>  <span class="c1"># arbitrary wait for EPICS to finish the reset.</span>

    <span class="c1"># positioners</span>
    <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">mv</span><span class="p">(</span>
        <span class="n">scan1</span><span class="o">.</span><span class="n">number_points</span><span class="p">,</span> <span class="n">npts</span><span class="p">,</span>
        <span class="n">scan1</span><span class="o">.</span><span class="n">positioners</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span>
        <span class="n">scan1</span><span class="o">.</span><span class="n">positioners</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">end</span><span class="p">,</span> <span class="n">finish</span><span class="p">,</span>
        <span class="n">scan1</span><span class="o">.</span><span class="n">positioners</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">readback_pv</span><span class="p">,</span> <span class="n">m1</span><span class="o">.</span><span class="n">user_readback</span><span class="o">.</span><span class="n">pvname</span><span class="p">,</span>
        <span class="n">scan1</span><span class="o">.</span><span class="n">positioners</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">setpoint_pv</span><span class="p">,</span> <span class="n">m1</span><span class="o">.</span><span class="n">user_setpoint</span><span class="o">.</span><span class="n">pvname</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c1"># triggers (push scaler count button at each point)</span>
    <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">mv</span><span class="p">(</span>
        <span class="n">scan1</span><span class="o">.</span><span class="n">triggers</span><span class="o">.</span><span class="n">t1</span><span class="o">.</span><span class="n">trigger_pv</span><span class="p">,</span> <span class="n">scaler1</span><span class="o">.</span><span class="n">count</span><span class="o">.</span><span class="n">pvname</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c1"># detectors</span>
    <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">mv</span><span class="p">(</span>
        <span class="n">scan1</span><span class="o">.</span><span class="n">detectors</span><span class="o">.</span><span class="n">d01</span><span class="o">.</span><span class="n">input_pv</span><span class="p">,</span> <span class="n">I0</span><span class="o">.</span><span class="n">pvname</span><span class="p">,</span>
        <span class="n">scan1</span><span class="o">.</span><span class="n">detectors</span><span class="o">.</span><span class="n">d02</span><span class="o">.</span><span class="n">input_pv</span><span class="p">,</span> <span class="n">diode</span><span class="o">.</span><span class="n">pvname</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<p>Setup the scan.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">setup_scan1</span><span class="p">(</span><span class="o">-</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
()
</pre></div></div>
</div>
<p>Run the scan. We should not have to reprogram this plan.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">run_sscan</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
()
</pre></div></div>
</div>
<p>Get the scan data. Same function as before. It’s not a bluesky plan, so <code class="docutils literal notranslate"><span class="pre">RE()</span></code> is not needed.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">get_sscan_data</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;m1&#39;: array([-1.2 , -1.08, -0.96, -0.84, -0.72, -0.6 , -0.48, -0.36, -0.24,
        -0.12,  0.  ,  0.12,  0.24,  0.36,  0.48,  0.6 ,  0.72,  0.84,
         0.96,  1.08,  1.2 ]),
 &#39;I0&#39;: array([1., 1., 1., 1., 1., 1., 1., 1., 2., 2., 4., 3., 3., 2., 1., 2., 2.,
        1., 1., 1., 1.], dtype=float32),
 &#39;diode&#39;: array([1., 1., 2., 1., 2., 1., 0., 1., 2., 2., 4., 3., 3., 1., 1., 2., 0.,
        1., 1., 1., 1.], dtype=float32)}
</pre></div></div>
</div>
</section>
<section id="4.-Post-data-to-bluesky-as-a-run">
<h2>4. Post data to bluesky as a run<a class="headerlink" href="#4.-Post-data-to-bluesky-as-a-run" title="Permalink to this heading">#</a></h2>
<p>So far, we have just run <code class="docutils literal notranslate"><span class="pre">scan1</span></code> and shown the data collected. We’ll need to do a bit more work to get this data into bluesky as a run.</p>
<p>Bluesky obtains data for a run from an ophyd Device or Signal. We’ll need to convert the data arrays into a structure that the <code class="docutils literal notranslate"><span class="pre">RE</span></code> will accept.</p>
<p>While we might just use <code class="docutils literal notranslate"><span class="pre">bps.read(scan1)</span></code> to get the data, the data would be named according to the <code class="docutils literal notranslate"><span class="pre">scan1</span></code> structure. We want more meaningful names so we re-assign the names of the original objects (motor and scaler channel names).</p>
<p>To post <em>bluesky data</em>, it must come from an ophyd <code class="docutils literal notranslate"><span class="pre">Device</span></code> (subclass). (See <a class="reference external" href="https://nsls-ii.github.io/ophyd/device-overview.html#device-and-component">here</a> for help with <code class="docutils literal notranslate"><span class="pre">Device</span></code> and <code class="docutils literal notranslate"><span class="pre">Component</span></code>.)</p>
<p>The <code class="docutils literal notranslate"><span class="pre">ThisScanData()</span></code> class is such an ophyd <code class="docutils literal notranslate"><span class="pre">Device</span></code> subclass, customized for the arrays of our <code class="docutils literal notranslate"><span class="pre">scan1</span></code>. We’ll read the arrays from <code class="docutils literal notranslate"><span class="pre">scan1</span></code>, then write them (using <code class="docutils literal notranslate"><span class="pre">bps.mv()</span></code>) to our custom device. Since we do not have timestamps for each of the data points, we’ll post the entire array as a single RunEngine <a class="reference external" href="https://blueskyproject.io/bluesky/generated/bluesky.plan_stubs.create.html#bluesky.plan_stubs.create">event</a>. The event will have the timestamp from the <code class="docutils literal notranslate"><span class="pre">bps.mv()</span></code> plan stub.</p>
<p>As we make an object of this class, we define <code class="docutils literal notranslate"><span class="pre">name=&quot;scan1&quot;</span></code> so the names of the data in the databroker will appear as <code class="docutils literal notranslate"><span class="pre">scan1_m1</span></code>, <code class="docutils literal notranslate"><span class="pre">scan1_I0</span></code>, &amp; <code class="docutils literal notranslate"><span class="pre">scan1_diode</span></code>.</p>
<p>The steps are all descriptive. The run is opened with the metadata dictionary supplied (<code class="docutils literal notranslate"><span class="pre">md</span></code>), the <code class="docutils literal notranslate"><span class="pre">primary</span></code> stream is created and written with the <code class="docutils literal notranslate"><span class="pre">scan_data</span></code>, then all is buttoned up and bluesky finishes the run.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ophyd</span> <span class="kn">import</span> <span class="n">Component</span><span class="p">,</span> <span class="n">Device</span><span class="p">,</span> <span class="n">Signal</span>

<span class="k">class</span> <span class="nc">ThisSscanData</span><span class="p">(</span><span class="n">Device</span><span class="p">):</span>
    <span class="n">m1</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">Signal</span><span class="p">)</span>
    <span class="n">I0</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">Signal</span><span class="p">)</span>
    <span class="n">diode</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">Signal</span><span class="p">)</span>

<span class="n">scan_data</span> <span class="o">=</span> <span class="n">ThisSscanData</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;scan1&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">post_sscan_data</span><span class="p">(</span><span class="n">md</span><span class="o">=</span><span class="p">{}):</span>
    <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">open_run</span><span class="p">(</span><span class="n">md</span><span class="p">)</span>
    <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;primary&quot;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">get_sscan_data</span><span class="p">()</span>
    <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">mv</span><span class="p">(</span>
        <span class="n">scan_data</span><span class="o">.</span><span class="n">m1</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;m1&quot;</span><span class="p">],</span>
        <span class="n">scan_data</span><span class="o">.</span><span class="n">I0</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;I0&quot;</span><span class="p">],</span>
        <span class="n">scan_data</span><span class="o">.</span><span class="n">diode</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;diode&quot;</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">scan_data</span><span class="p">)</span>
    <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">close_run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Now we need a databroker catalog. Make a temporary one for this notebook.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">databroker</span>

<span class="n">cat</span> <span class="o">=</span> <span class="n">databroker</span><span class="o">.</span><span class="n">temp</span><span class="p">()</span><span class="o">.</span><span class="n">v2</span>
<span class="n">RE</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">cat</span><span class="o">.</span><span class="n">v1</span><span class="o">.</span><span class="n">insert</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0
</pre></div></div>
</div>
<p>Post the data from the recent scan as a new bluesky run.</p>
<p>Note: A bluesky plan can generate zero or more runs, each indexed by a <code class="docutils literal notranslate"><span class="pre">uid</span></code>. Print the tuple of run uids returned from <code class="docutils literal notranslate"><span class="pre">RE()</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">uids</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="n">post_sscan_data</span><span class="p">())</span>
<span class="n">uids</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&#39;b40e4926-d365-4c72-9936-76d28425c7fc&#39;,)
</pre></div></div>
</div>
<p>Get the run entry (by uid) from the catalog.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run</span> <span class="o">=</span> <span class="n">cat</span><span class="p">[</span><span class="n">uids</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<span class="n">run</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
BlueskyRun
  uid=&#39;b40e4926-d365-4c72-9936-76d28425c7fc&#39;
  exit_status=&#39;success&#39;
  2024-03-18 16:06:34.111 -- 2024-03-18 16:06:34.117
  Streams:
    * primary

</pre></div></div>
</div>
<p>Show the data arrays from the run’s primary stream. The data are returned as a single xarray <a class="reference external" href="https://docs.xarray.dev/en/stable/generated/xarray.Dataset.html">Dataset</a>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run</span><span class="o">.</span><span class="n">primary</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:      (time: 1, dim_0: 21, dim_1: 21, dim_2: 21)
Coordinates:
  * time         (time) float64 1.711e+09
Dimensions without coordinates: dim_0, dim_1, dim_2
Data variables:
    scan1_m1     (time, dim_0) float64 -1.2 -1.08 -0.96 -0.84 ... 0.96 1.08 1.2
    scan1_I0     (time, dim_1) float32 1.0 1.0 1.0 1.0 1.0 ... 1.0 1.0 1.0 1.0
    scan1_diode  (time, dim_2) float32 1.0 1.0 2.0 1.0 2.0 ... 1.0 1.0 1.0 1.0</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-56c6b907-9cd0-4e41-b1aa-b63ee48b8d21' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-56c6b907-9cd0-4e41-b1aa-b63ee48b8d21' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>time</span>: 1</li><li><span>dim_0</span>: 21</li><li><span>dim_1</span>: 21</li><li><span>dim_2</span>: 21</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-741375e6-1538-40cf-888f-22fe2e619487' class='xr-section-summary-in' type='checkbox'  checked><label for='section-741375e6-1538-40cf-888f-22fe2e619487' class='xr-section-summary' >Coordinates: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>1.711e+09</div><input id='attrs-28d98647-e91a-46e1-ba51-d2c69da80902' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-28d98647-e91a-46e1-ba51-d2c69da80902' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-4b3b8fdc-b8b0-40a3-a7a4-eb9ec3846cf5' class='xr-var-data-in' type='checkbox'><label for='data-4b3b8fdc-b8b0-40a3-a7a4-eb9ec3846cf5' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1.710796e+09])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-f19e57aa-c6d3-4e20-aba9-796d84617d14' class='xr-section-summary-in' type='checkbox'  checked><label for='section-f19e57aa-c6d3-4e20-aba9-796d84617d14' class='xr-section-summary' >Data variables: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>scan1_m1</span></div><div class='xr-var-dims'>(time, dim_0)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>-1.2 -1.08 -0.96 ... 0.96 1.08 1.2</div><input id='attrs-3f32cc73-02e6-47d6-95a7-ca9d79c49af4' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-3f32cc73-02e6-47d6-95a7-ca9d79c49af4' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-547b5c9d-1a5f-4e91-9d30-80563db5c8fc' class='xr-var-data-in' type='checkbox'><label for='data-547b5c9d-1a5f-4e91-9d30-80563db5c8fc' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>object :</span></dt><dd>scan1</dd></dl></div><div class='xr-var-data'><pre>array([[-1.2 , -1.08, -0.96, -0.84, -0.72, -0.6 , -0.48, -0.36, -0.24,
        -0.12,  0.  ,  0.12,  0.24,  0.36,  0.48,  0.6 ,  0.72,  0.84,
         0.96,  1.08,  1.2 ]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>scan1_I0</span></div><div class='xr-var-dims'>(time, dim_1)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>1.0 1.0 1.0 1.0 ... 1.0 1.0 1.0 1.0</div><input id='attrs-4172d194-bd10-45df-8960-b899736f20f6' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-4172d194-bd10-45df-8960-b899736f20f6' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-27b0db4d-91d9-4313-9bb1-c63d5579f72e' class='xr-var-data-in' type='checkbox'><label for='data-27b0db4d-91d9-4313-9bb1-c63d5579f72e' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>object :</span></dt><dd>scan1</dd></dl></div><div class='xr-var-data'><pre>array([[1., 1., 1., 1., 1., 1., 1., 1., 2., 2., 4., 3., 3., 2., 1., 2.,
        2., 1., 1., 1., 1.]], dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>scan1_diode</span></div><div class='xr-var-dims'>(time, dim_2)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>1.0 1.0 2.0 1.0 ... 1.0 1.0 1.0 1.0</div><input id='attrs-17c5adfd-f115-4a54-ab41-80cfa590ac32' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-17c5adfd-f115-4a54-ab41-80cfa590ac32' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-3033aa79-a619-4cb0-b357-47c6d939650a' class='xr-var-data-in' type='checkbox'><label for='data-3033aa79-a619-4cb0-b357-47c6d939650a' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>object :</span></dt><dd>scan1</dd></dl></div><div class='xr-var-data'><pre>array([[1., 1., 2., 1., 2., 1., 0., 1., 2., 2., 4., 3., 3., 1., 1., 2.,
        0., 1., 1., 1., 1.]], dtype=float32)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-d1bd60c8-3ab7-4842-a47b-800f0cd3ef44' class='xr-section-summary-in' type='checkbox'  ><label for='section-d1bd60c8-3ab7-4842-a47b-800f0cd3ef44' class='xr-section-summary' >Indexes: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>time</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-632b4521-d86c-42ff-acaa-b0017c131bc8' class='xr-index-data-in' type='checkbox'/><label for='index-632b4521-d86c-42ff-acaa-b0017c131bc8' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([1710795994.116818], dtype=&#x27;float64&#x27;, name=&#x27;time&#x27;))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-bcbc863d-842e-46b3-99f9-a12bfefb6710' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-bcbc863d-842e-46b3-99f9-a12bfefb6710' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div></div>
</div>
</section>
<section id="Combined-setup,-scan,-post-data">
<h2>Combined setup, scan, post data<a class="headerlink" href="#Combined-setup,-scan,-post-data" title="Permalink to this heading">#</a></h2>
<p>Instead of calling the <code class="docutils literal notranslate"><span class="pre">RE()</span></code> separately with each of these plans, combine them into an outer plan.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">combined</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">finish</span><span class="p">,</span> <span class="n">npts</span><span class="p">,</span> <span class="n">ct</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">md</span><span class="o">=</span><span class="p">{}):</span>
    <span class="k">yield from</span> <span class="n">setup_scan1</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">finish</span><span class="p">,</span> <span class="n">npts</span><span class="p">,</span> <span class="n">ct</span><span class="o">=</span><span class="n">ct</span><span class="p">)</span>
    <span class="k">yield from</span> <span class="n">run_sscan</span><span class="p">()</span>
    <span class="k">yield from</span> <span class="n">post_sscan_data</span><span class="p">(</span><span class="n">md</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Run the combined plan and retrieve the data from the databroker catalog.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">uids</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="n">combined</span><span class="p">(</span><span class="o">-</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="n">ct</span><span class="o">=</span><span class="mf">.2</span><span class="p">))</span>
<span class="n">cat</span><span class="p">[</span><span class="n">uids</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">primary</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:      (time: 1, dim_0: 21, dim_1: 21, dim_2: 21)
Coordinates:
  * time         (time) float64 1.711e+09
Dimensions without coordinates: dim_0, dim_1, dim_2
Data variables:
    scan1_m1     (time, dim_0) float64 -1.2 -1.08 -0.96 -0.84 ... 0.96 1.08 1.2
    scan1_I0     (time, dim_1) float32 2.0 0.0 0.0 0.0 0.0 ... 1.0 1.0 1.0 1.0
    scan1_diode  (time, dim_2) float32 2.0 0.0 0.0 1.0 1.0 ... 1.0 1.0 1.0 1.0</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-a76c5efc-ba8c-49c7-aac3-9d06a0d28cfc' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-a76c5efc-ba8c-49c7-aac3-9d06a0d28cfc' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>time</span>: 1</li><li><span>dim_0</span>: 21</li><li><span>dim_1</span>: 21</li><li><span>dim_2</span>: 21</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-c84d0091-6c3e-40d4-830c-48191debfbf9' class='xr-section-summary-in' type='checkbox'  checked><label for='section-c84d0091-6c3e-40d4-830c-48191debfbf9' class='xr-section-summary' >Coordinates: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>1.711e+09</div><input id='attrs-cd4bd93a-64e3-4806-a8d0-f119d28b9b56' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-cd4bd93a-64e3-4806-a8d0-f119d28b9b56' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-9ddd02a9-f134-4e4e-91d1-1e62832a7d14' class='xr-var-data-in' type='checkbox'><label for='data-9ddd02a9-f134-4e4e-91d1-1e62832a7d14' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1.710796e+09])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-42551b90-eeb6-41d9-85c2-4a7f6866a7b6' class='xr-section-summary-in' type='checkbox'  checked><label for='section-42551b90-eeb6-41d9-85c2-4a7f6866a7b6' class='xr-section-summary' >Data variables: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>scan1_m1</span></div><div class='xr-var-dims'>(time, dim_0)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>-1.2 -1.08 -0.96 ... 0.96 1.08 1.2</div><input id='attrs-893102f4-4c15-4f28-baf4-cc814c2c2b58' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-893102f4-4c15-4f28-baf4-cc814c2c2b58' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-e2f81a69-922a-49fd-a6fd-1b2c5675b05a' class='xr-var-data-in' type='checkbox'><label for='data-e2f81a69-922a-49fd-a6fd-1b2c5675b05a' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>object :</span></dt><dd>scan1</dd></dl></div><div class='xr-var-data'><pre>array([[-1.2 , -1.08, -0.96, -0.84, -0.72, -0.6 , -0.48, -0.36, -0.24,
        -0.12,  0.  ,  0.12,  0.24,  0.36,  0.48,  0.6 ,  0.72,  0.84,
         0.96,  1.08,  1.2 ]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>scan1_I0</span></div><div class='xr-var-dims'>(time, dim_1)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>2.0 0.0 0.0 0.0 ... 1.0 1.0 1.0 1.0</div><input id='attrs-8cd8ad34-869d-48d1-a393-8c57c43271d2' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-8cd8ad34-869d-48d1-a393-8c57c43271d2' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-c49ba796-038f-4827-aba5-487ab4e3c0bc' class='xr-var-data-in' type='checkbox'><label for='data-c49ba796-038f-4827-aba5-487ab4e3c0bc' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>object :</span></dt><dd>scan1</dd></dl></div><div class='xr-var-data'><pre>array([[2., 0., 0., 0., 0., 0., 1., 1., 1., 3., 3., 4., 2., 2., 1., 1.,
        2., 1., 1., 1., 1.]], dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>scan1_diode</span></div><div class='xr-var-dims'>(time, dim_2)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>2.0 0.0 0.0 1.0 ... 1.0 1.0 1.0 1.0</div><input id='attrs-33b66c15-4933-48fe-810d-966003d19f38' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-33b66c15-4933-48fe-810d-966003d19f38' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-5cad3e33-03d1-4cae-9f07-40ab3f97bb9a' class='xr-var-data-in' type='checkbox'><label for='data-5cad3e33-03d1-4cae-9f07-40ab3f97bb9a' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>object :</span></dt><dd>scan1</dd></dl></div><div class='xr-var-data'><pre>array([[2., 0., 0., 1., 1., 1., 1., 1., 1., 4., 4., 4., 3., 2., 1., 2.,
        1., 1., 1., 1., 1.]], dtype=float32)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-df7ad68e-a372-4c9e-8a5e-7f535b5327ba' class='xr-section-summary-in' type='checkbox'  ><label for='section-df7ad68e-a372-4c9e-8a5e-7f535b5327ba' class='xr-section-summary' >Indexes: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>time</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-d6edd80d-4ab7-4af8-aac8-136812f51bd9' class='xr-index-data-in' type='checkbox'/><label for='index-d6edd80d-4ab7-4af8-aac8-136812f51bd9' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([1710796011.975966], dtype=&#x27;float64&#x27;, name=&#x27;time&#x27;))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-98c73cec-7ab4-4038-903a-7ada09c86e5b' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-98c73cec-7ab4-4038-903a-7ada09c86e5b' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div></div>
</div>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="de_aps_data_management.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Integration with APS Data Management (DM)</p>
      </div>
    </a>
    <a class="right-next"
       href="filewriter_examples.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">File Writer Examples</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sscan-record-configuration">sscan record configuration</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Python-setup">Python setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#1.-Press-SCAN-button-of-a-preconfigured-scan">1. Press SCAN button of a preconfigured scan</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#2.-Run-preconfigured-sscan-record">2. Run preconfigured <code class="docutils literal notranslate"><span class="pre">sscan</span></code> record</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Get-the-data-arrays-from-the-sscan-record">Get the data arrays from the <code class="docutils literal notranslate"><span class="pre">sscan</span></code> record</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#3.-Setup-and-run-same-scan-from-bluesky">3. Setup and run same scan from bluesky</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#4.-Post-data-to-bluesky-as-a-run">4. Post data to bluesky as a run</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Combined-setup,-scan,-post-data">Combined setup, scan, post data</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../_sources/examples/de_sscan.ipynb.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2017-2024, UChicago Argonne, LLC.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.4.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>