

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>File Writers &#8212; apstools 1.6.17 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'api/_filewriters';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://raw.githubusercontent.com/BCDA-APS/apstools/main/docs/source/_static/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = '1.6.17';
        </script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Plans" href="_plans.html" />
    <link rel="prev" title="Devices" href="_devices.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  <div class="navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    <p class="title logo__title">apstools 1.6.17 documentation</p>
  
</a></div>
    
      <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button type="button" class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle" data-bs-toggle="dropdown">
      1.6.17  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div class="version-switcher__menu dropdown-menu list-group-flush py-0">
    <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
    
  </div>
  
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../overview.html">
                        Overview
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../applications/index.html">
                        Applications
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../examples/index.html">
                        Guides
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="index.html">
                        API Documentation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../install.html">
                        Installation
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../changes.html">
                        Change History
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../license.html">
                        License
                      </a>
                    </li>
                
                </div>
            </div>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../overview.html">
                        Overview
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../applications/index.html">
                        Applications
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../examples/index.html">
                        Guides
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="index.html">
                        API Documentation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../install.html">
                        Installation
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../changes.html">
                        Change History
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../license.html">
                        License
                      </a>
                    </li>
                
                </div>
            </div>
            
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="_callbacks.html">Callbacks (includes File Writers)</a></li>
<li class="toctree-l1"><a class="reference internal" href="_devices.html">Devices</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">File Writers</a></li>
<li class="toctree-l1"><a class="reference internal" href="_plans.html">Plans</a></li>
<li class="toctree-l1"><a class="reference internal" href="_utils.html">Utilities</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="synApps/index.html">synApps Support: Records, Databases, …</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="synApps/__common.html">EPICS Record support: common structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="synApps/_asyn.html">synApps asyn record</a></li>
<li class="toctree-l2"><a class="reference internal" href="synApps/_busy.html">synApps busy record</a></li>
<li class="toctree-l2"><a class="reference internal" href="synApps/_calcout.html">EPICS base calcout record</a></li>
<li class="toctree-l2"><a class="reference internal" href="synApps/_db_2slit.html">EPICS synApps optics 2slit.db</a></li>
<li class="toctree-l2"><a class="reference internal" href="synApps/_epid.html">synApps epid record</a></li>
<li class="toctree-l2"><a class="reference internal" href="synApps/_iocstats.html">synApps IOC statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="synApps/_luascript.html">synApps luascript record</a></li>
<li class="toctree-l2"><a class="reference internal" href="synApps/_save_data.html">synApps save data</a></li>
<li class="toctree-l2"><a class="reference internal" href="synApps/_scalcout.html">EPICS synApps calc scalcout record</a></li>
<li class="toctree-l2"><a class="reference internal" href="synApps/_sscan.html">synApps sscan record</a></li>
<li class="toctree-l2"><a class="reference internal" href="synApps/_sseq.html">synApps sseq record</a></li>
<li class="toctree-l2"><a class="reference internal" href="synApps/_sub.html">EPICS base sub record &amp; synApps userAve records</a></li>
<li class="toctree-l2"><a class="reference internal" href="synApps/_swait.html">synApps swait record</a></li>
<li class="toctree-l2"><a class="reference internal" href="synApps/_transform.html">synApps transform record</a></li>
</ul>
</li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumbs">
  <ul class="bd-breadcrumbs" role="navigation" aria-label="Breadcrumb">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">API Documentation</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">File Writers</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="file-writers">
<span id="filewriters"></span><h1>File Writers<a class="headerlink" href="#file-writers" title="Permalink to this heading">#</a></h1>
<p>The file writer callbacks are:</p>
<table class="autosummary longtable table autosummary">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#apstools.callbacks.callback_base.FileWriterCallbackBase" title="apstools.callbacks.callback_base.FileWriterCallbackBase"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FileWriterCallbackBase</span></code></a>(*args, **kwargs)</p></td>
<td><p>Base class for filewriter callbacks.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#apstools.callbacks.nexus_writer.NXWriterAPS" title="apstools.callbacks.nexus_writer.NXWriterAPS"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NXWriterAPS</span></code></a>(*args, **kwargs)</p></td>
<td><p>Customize <code class="xref py py-class docutils literal notranslate"><span class="pre">NXWriter</span></code> with APS-specific content.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#apstools.callbacks.nexus_writer.NXWriter" title="apstools.callbacks.nexus_writer.NXWriter"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NXWriter</span></code></a>(*args, **kwargs)</p></td>
<td><p>General class for writing HDF5/NeXus file (using only NeXus base classes).</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback" title="apstools.callbacks.spec_file_writer.SpecWriterCallback"><code class="xref py py-obj docutils literal notranslate"><span class="pre">SpecWriterCallback</span></code></a>([filename, auto_write, ...])</p></td>
<td><p>Collect data from Bluesky RunEngine documents to write as SPEC data.</p></td>
</tr>
</tbody>
</table>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">#</a></h2>
<p>Each filewriter can be used as a callback to the Bluesky RunEngine
for live data acquisition or later as a handler for a document set
from the databroker.  Methods are provided to handle each document
type.  The callback method, <code class="docutils literal notranslate"><span class="pre">receiver(document_type,</span> <span class="pre">document)</span></code>, receives
the set of documents, one-by-one, and sends them to the appropriate
handler.  Once the <code class="docutils literal notranslate"><span class="pre">stop</span></code> document is received, the <code class="docutils literal notranslate"><span class="pre">writer()</span></code> method
is called to write the output file.</p>
<section id="examples">
<h3>Examples<a class="headerlink" href="#examples" title="Permalink to this heading">#</a></h3>
<p>Write SPEC file automatically from data acquisition:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">specwriter</span> <span class="o">=</span> <span class="n">apstools</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">SpecWriterCallback</span><span class="p">()</span>
<span class="n">RE</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">specwriter</span><span class="o">.</span><span class="n">receiver</span><span class="p">)</span>
</pre></div>
</div>
<p>Write NeXus file automatically from data acquisition:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nxwriter</span> <span class="o">=</span> <span class="n">apstools</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">NXWriter</span><span class="p">()</span>
<span class="n">RE</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">nxwriter</span><span class="o">.</span><span class="n">receiver</span><span class="p">)</span>
</pre></div>
</div>
<p>Write APS-specific NeXus file automatically from data acquisition:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nxwriteraps</span> <span class="o">=</span> <span class="n">apstools</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">NXWriterAPS</span><span class="p">()</span>
<span class="n">RE</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">nxwriteraps</span><span class="o">.</span><span class="n">receiver</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="programmer-s-note">
<h3>Programmer’s Note<a class="headerlink" href="#programmer-s-note" title="Permalink to this heading">#</a></h3>
<p>Subclassing from <code class="docutils literal notranslate"><span class="pre">object</span></code> (or no superclass)
avoids the need to import <code class="docutils literal notranslate"><span class="pre">bluesky.callbacks.core.CallbackBase</span></code>.
One less import when only accessing the Databroker.
The <em>only</em> advantage to subclassing from <code class="docutils literal notranslate"><span class="pre">CallbackBase</span></code>
seems to be a simpler setup call to <code class="docutils literal notranslate"><span class="pre">RE.subscribe()</span></code>.</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>superclass</p></th>
<th class="head"><p>subscription code</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>object</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">RE.subscribe(specwriter.receiver)</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>CallbackBase</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">RE.subscribe(specwriter)</span></code></p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="hdf5-nexus-file-writers">
<h2>HDF5/NeXus File Writers<a class="headerlink" href="#hdf5-nexus-file-writers" title="Permalink to this heading">#</a></h2>
<section id="filewritercallbackbase">
<h3>FileWriterCallbackBase<a class="headerlink" href="#filewritercallbackbase" title="Permalink to this heading">#</a></h3>
<p>Base class for filewriter callbacks.</p>
<p>Applications should subclass and rewrite the <code class="docutils literal notranslate"><span class="pre">writer()</span></code> method.</p>
<p>The local buffers are cleared when a start document is received.
Content is collected here from each document until the stop document.
The content is written once the stop document is received.</p>
<section id="output-file-name-and-path">
<h4>Output File Name and Path<a class="headerlink" href="#output-file-name-and-path" title="Permalink to this heading">#</a></h4>
<p>The output file will be written to the file named in
<code class="docutils literal notranslate"><span class="pre">self.file_name</span></code>.  (Include the output directory if
different from the current working directory.)</p>
<p>When <code class="docutils literal notranslate"><span class="pre">self.file_name</span></code> is <code class="docutils literal notranslate"><span class="pre">None</span></code> (the default), the
<a class="reference internal" href="#apstools.callbacks.callback_base.FileWriterCallbackBase.make_file_name" title="apstools.callbacks.callback_base.FileWriterCallbackBase.make_file_name"><code class="xref py py-meth docutils literal notranslate"><span class="pre">make_file_name()</span></code></a>
method will construct
the file name using a combination of the date and time
(from the <code class="docutils literal notranslate"><span class="pre">start</span></code> document), the <code class="docutils literal notranslate"><span class="pre">start</span></code> document
<code class="docutils literal notranslate"><span class="pre">uid</span></code>, and the <code class="docutils literal notranslate"><span class="pre">scan_id</span></code>.
The default file extension (given in <code class="docutils literal notranslate"><span class="pre">NEXUS_FILE_EXTENSION</span></code>)
is used in
<a class="reference internal" href="#apstools.callbacks.callback_base.FileWriterCallbackBase.make_file_name" title="apstools.callbacks.callback_base.FileWriterCallbackBase.make_file_name"><code class="xref py py-meth docutils literal notranslate"><span class="pre">make_file_name()</span></code></a>.
The directory will be
<code class="docutils literal notranslate"><span class="pre">self.file_path</span></code> (or the current working directory
if <code class="docutils literal notranslate"><span class="pre">self.file_path</span></code> is <code class="docutils literal notranslate"><span class="pre">None</span></code> which is the default).</p>
<p>Either specify <code class="docutils literal notranslate"><span class="pre">self.file_name</span></code> or override
<a class="reference internal" href="#apstools.callbacks.callback_base.FileWriterCallbackBase.make_file_name" title="apstools.callbacks.callback_base.FileWriterCallbackBase.make_file_name"><code class="xref py py-meth docutils literal notranslate"><span class="pre">make_file_name()</span></code></a>
in a subclass to change the procedure for default output file names.</p>
</section>
<section id="metadata">
<h4>Metadata<a class="headerlink" href="#metadata" title="Permalink to this heading">#</a></h4>
<p>Almost all metadata keys (additional attributes added to the run’s
<code class="docutils literal notranslate"><span class="pre">start</span></code> document) are completely optional.  Certain keys are
specified by the RunEngine, some keys are specified by the plan
(or plan support methods), and other keys are supplied by the
user or the instrument team.</p>
<p>These are the keys used by this callback to help guide how
information is stored in a NeXus HDF5 file structure.</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>key</p></th>
<th class="head"><p>creator</p></th>
<th class="head"><p>how is it used</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>detectors</p></td>
<td><p>inconsistent</p></td>
<td><p>name(s) of the signals used as detectors</p></td>
</tr>
<tr class="row-odd"><td><p>motors</p></td>
<td><p>inconsistent</p></td>
<td><p>synonym for <code class="docutils literal notranslate"><span class="pre">positioners</span></code></p></td>
</tr>
<tr class="row-even"><td><p>plan_args</p></td>
<td><p>inconsistent</p></td>
<td><p>parameters (arguments) given</p></td>
</tr>
<tr class="row-odd"><td><p>plan_name</p></td>
<td><p>inconsistent</p></td>
<td><p>name of the plan used to collect data</p></td>
</tr>
<tr class="row-even"><td><p>positioners</p></td>
<td><p>inconsistent</p></td>
<td><p>name(s) of the signals used as positioners</p></td>
</tr>
<tr class="row-odd"><td><p>scan_id</p></td>
<td><p>RunEngine</p></td>
<td><p>incrementing number of the run, user can reset</p></td>
</tr>
<tr class="row-even"><td><p>uid</p></td>
<td><p>RunEngine</p></td>
<td><p>unique identifier of the run</p></td>
</tr>
<tr class="row-odd"><td><p>versions</p></td>
<td><p>instrument</p></td>
<td><p>documents the software versions used to collect data</p></td>
</tr>
</tbody>
</table>
<p>For more information about Bluesky <em>events</em> and document types, see
<a class="reference external" href="https://blueskyproject.io/event-model/data-model.html">https://blueskyproject.io/event-model/data-model.html</a>.</p>
</section>
</section>
<section id="nxwriter">
<h3>NXWriter<a class="headerlink" href="#nxwriter" title="Permalink to this heading">#</a></h3>
<p>General class for writing HDF5/NeXus file (using only NeXus base classes).</p>
<p>One scan is written to one HDF5/NeXus file.</p>
<section id="id1">
<h4>Output File Name and Path<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h4>
<p>The output file will be written to the file named in
<code class="docutils literal notranslate"><span class="pre">self.file_name</span></code>.  (Include the output directory if
different from the current working directory.)</p>
<p>When <code class="docutils literal notranslate"><span class="pre">self.file_name</span></code> is <code class="docutils literal notranslate"><span class="pre">None</span></code> (the default), the
<a class="reference internal" href="#apstools.callbacks.callback_base.FileWriterCallbackBase.make_file_name" title="apstools.callbacks.callback_base.FileWriterCallbackBase.make_file_name"><code class="xref py py-meth docutils literal notranslate"><span class="pre">make_file_name()</span></code></a>
method will construct
the file name using a combination of the date and time
(from the <cite>start</cite> document), the <code class="docutils literal notranslate"><span class="pre">start</span></code> document
<code class="docutils literal notranslate"><span class="pre">uid</span></code>, and the <code class="docutils literal notranslate"><span class="pre">scan_id</span></code>.
The default file extension (given in <code class="docutils literal notranslate"><span class="pre">NEXUS_FILE_EXTENSION</span></code>) is
used in
<a class="reference internal" href="#apstools.callbacks.callback_base.FileWriterCallbackBase.make_file_name" title="apstools.callbacks.callback_base.FileWriterCallbackBase.make_file_name"><code class="xref py py-meth docutils literal notranslate"><span class="pre">make_file_name()</span></code></a>.
The directory will be
<code class="docutils literal notranslate"><span class="pre">self.file_path</span></code> (or the current working directory
if <code class="docutils literal notranslate"><span class="pre">self.file_path</span></code> is <code class="docutils literal notranslate"><span class="pre">None</span></code> which is the default).</p>
<p>Either specify <code class="docutils literal notranslate"><span class="pre">self.file_name</span></code> of override
<a class="reference internal" href="#apstools.callbacks.callback_base.FileWriterCallbackBase.make_file_name" title="apstools.callbacks.callback_base.FileWriterCallbackBase.make_file_name"><code class="xref py py-meth docutils literal notranslate"><span class="pre">make_file_name()</span></code></a>
in a subclass
to change the procedure for default output file names.</p>
</section>
<section id="id2">
<h4>Metadata<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h4>
<p>Almost all metadata keys (additional attributes added to the run’s
<code class="docutils literal notranslate"><span class="pre">start</span></code> document) are completely optional.  Certain keys are
specified by the RunEngine, some keys are specified by the plan
(or plan support methods), and other keys are supplied by the
user or the instrument team.</p>
<p>These are the keys used by this callback to help guide how
information is stored in a NeXus HDF5 file structure.</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>key</p></th>
<th class="head"><p>creator</p></th>
<th class="head"><p>how is it used</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>detectors</p></td>
<td><p>inconsistent</p></td>
<td><p>name(s) of the signals used as plottable values</p></td>
</tr>
<tr class="row-odd"><td><p>motors</p></td>
<td><p>inconsistent</p></td>
<td><p>synonym for <code class="docutils literal notranslate"><span class="pre">positioners</span></code></p></td>
</tr>
<tr class="row-even"><td><p>plan_args</p></td>
<td><p>inconsistent</p></td>
<td><p>parameters (arguments) given</p></td>
</tr>
<tr class="row-odd"><td><p>plan_name</p></td>
<td><p>inconsistent</p></td>
<td><p>name of the plan used to collect data</p></td>
</tr>
<tr class="row-even"><td><p>positioners</p></td>
<td><p>inconsistent</p></td>
<td><p>name(s) of the positioners used for plotting</p></td>
</tr>
<tr class="row-odd"><td><p>scan_id</p></td>
<td><p>RunEngine</p></td>
<td><p>incrementing number of the run, user can reset</p></td>
</tr>
<tr class="row-even"><td><p>subtitle</p></td>
<td><p>user</p></td>
<td><p>-tba-</p></td>
</tr>
<tr class="row-odd"><td><p>title</p></td>
<td><p>user</p></td>
<td><p>/entry/title</p></td>
</tr>
<tr class="row-even"><td><p>uid</p></td>
<td><p>RunEngine</p></td>
<td><p>unique identifier of the run</p></td>
</tr>
<tr class="row-odd"><td><p>versions</p></td>
<td><p>instrument</p></td>
<td><p>documents the software versions used to collect data</p></td>
</tr>
</tbody>
</table>
<p>Notes:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">detectors[0]</span></code> will be used as the <code class="docutils literal notranslate"><span class="pre">/entry/data&#64;signal</span></code> attribute</p></li>
<li><p>the <em>complete</em> list in <code class="docutils literal notranslate"><span class="pre">positioners</span></code> will be used as the <code class="docutils literal notranslate"><span class="pre">/entry/data&#64;axes</span></code> attribute</p></li>
</ol>
</section>
</section>
<section id="nxwriteraps">
<h3>NXWriterAPS<a class="headerlink" href="#nxwriteraps" title="Permalink to this heading">#</a></h3>
<p>Customize <a class="reference internal" href="#apstools.callbacks.nexus_writer.NXWriter" title="apstools.callbacks.nexus_writer.NXWriter"><code class="xref py py-class docutils literal notranslate"><span class="pre">NXWriter</span></code></a> with APS-specific content.</p>
<ul class="simple">
<li><p>Adds <code class="docutils literal notranslate"><span class="pre">/entry/instrument/undulator</span></code> group if metadata exists.</p></li>
<li><p>Adds APS information to <code class="docutils literal notranslate"><span class="pre">/entry/instrument/source</span></code> group.</p></li>
</ul>
<p>APS instruments should subclass <a class="reference internal" href="#apstools.callbacks.nexus_writer.NXWriterAPS" title="apstools.callbacks.nexus_writer.NXWriterAPS"><code class="xref py py-class docutils literal notranslate"><span class="pre">NXWriterAPS</span></code></a>
to make customizations for specific plans or other considerations.</p>
</section>
</section>
<section id="hdf5-nexus-file-structures">
<h2>HDF5/NeXus File Structures<a class="headerlink" href="#hdf5-nexus-file-structures" title="Permalink to this heading">#</a></h2>
<p>Bluesky stores a wealth of information about a measurement in a <em>run</em>.
Raw data from the Bluesky <em>run</em> is stored in the HDF5/NeXus structure
under the <code class="docutils literal notranslate"><span class="pre">/entry/instrument/bluesky</span></code> group as shown in this example:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>  bluesky:NXnote
<span class="linenos">2</span>    @NX_class = NXnote
<span class="linenos">3</span>    @target = /entry/instrument/bluesky
<span class="linenos">4</span>    plan_name --&gt; /entry/instrument/bluesky/metadata/plan_name
<span class="linenos">5</span>    uid --&gt; /entry/instrument/bluesky/metadata/run_start_uid
</pre></div>
</div>
<p>The NeXus structure is built using links to the raw data in
<code class="docutils literal notranslate"><span class="pre">/entry/instrument/bluesky</span></code>.</p>
<section id="id3">
<h3>Metadata<a class="headerlink" href="#id3" title="Permalink to this heading">#</a></h3>
<p>Metadata from the <code class="docutils literal notranslate"><span class="pre">start</span></code> document is stored in the <code class="docutils literal notranslate"><span class="pre">metadata</span></code> subgroup
as shown in this example:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>  metadata:NXnote
<span class="linenos"> 2</span>    @NX_class = NXnote
<span class="linenos"> 3</span>    @target = /entry/instrument/bluesky/metadata
<span class="linenos"> 4</span>    beamline_id:NX_CHAR = b&#39;APS USAXS 9-ID-C&#39;
<span class="linenos"> 5</span>      @target = /entry/instrument/bluesky/metadata/beamline_id
<span class="linenos"> 6</span>    datetime:NX_CHAR = b&#39;2019-05-02 17:45:33.904824&#39;
<span class="linenos"> 7</span>      @target = /entry/instrument/bluesky/metadata/datetime
<span class="linenos"> 8</span>    detectors:NX_CHAR = b&#39;- I0_USAXS\n&#39;
<span class="linenos"> 9</span>      @target = /entry/instrument/bluesky/metadata/detectors
<span class="linenos">10</span>      @text_format = yaml
<span class="linenos">11</span>    hints:NX_CHAR = b&#39;dimensions:\n- - - m_stage_r\n  - primary\n&#39;
<span class="linenos">12</span>      @target = /entry/instrument/bluesky/metadata/hints
<span class="linenos">13</span>      @text_format = yaml
<span class="linenos">14</span>    login_id:NX_CHAR = b&#39;usaxs@usaxscontrol.xray.aps.anl.gov&#39;
<span class="linenos">15</span>      @target = /entry/instrument/bluesky/metadata/login_id
<span class="linenos">16</span>    motors:NX_CHAR = b&#39;- m_stage_r\n&#39;
<span class="linenos">17</span>      @target = /entry/instrument/bluesky/metadata/motors
<span class="linenos">18</span>      @text_format = yaml
<span class="linenos">19</span>    pid:NX_INT64[] = 
<span class="linenos">20</span>      @target = /entry/instrument/bluesky/metadata/pid
<span class="linenos">21</span>    plan_name:NX_CHAR = b&#39;tune_mr&#39;
<span class="linenos">22</span>      @target = /entry/instrument/bluesky/metadata/plan_name
<span class="linenos">23</span>    plan_type:NX_CHAR = b&#39;generator&#39;
<span class="linenos">24</span>      @target = /entry/instrument/bluesky/metadata/plan_type
<span class="linenos">25</span>    proposal_id:NX_CHAR = b&#39;testing Bluesky installation&#39;
<span class="linenos">26</span>      @target = /entry/instrument/bluesky/metadata/proposal_id
<span class="linenos">27</span>    purpose:NX_CHAR = b&#39;tuner&#39;
<span class="linenos">28</span>      @target = /entry/instrument/bluesky/metadata/purpose
<span class="linenos">29</span>    run_start_uid:NX_CHAR = 2ffe4d87-9f0c-464a-9d14-213ec71afaf7
<span class="linenos">30</span>      @long_name = bluesky run uid
<span class="linenos">31</span>      @target = /entry/instrument/bluesky/metadata/run_start_uid
<span class="linenos">32</span>    tune_md:NX_CHAR = b&quot;initial_position: 8.824977\ntime_iso8601: &#39;2019-05-02 17:45:33.923544&#39;\nwidth: -0.004\n&quot;
<span class="linenos">33</span>      @target = /entry/instrument/bluesky/metadata/tune_md
<span class="linenos">34</span>      @text_format = yaml
<span class="linenos">35</span>    tune_parameters:NX_CHAR = b&#39;initial_position: 8.824977\nnum: 31\npeak_choice: com\nwidth: -0.004\nx_axis: m_stage_r\ny_axis: I0_USAXS\n&#39;
<span class="linenos">36</span>      @target = /entry/instrument/bluesky/metadata/tune_parameters
<span class="linenos">37</span>      @text_format = yaml
<span class="linenos">38</span>    uid --&gt; /entry/instrument/bluesky/run_start_uid
</pre></div>
</div>
<p>Note that complex structures (lists and dictionaries)
are written as YAML.  YAML is easily converted back into the
python structure using <code class="docutils literal notranslate"><span class="pre">yaml.load(yaml_text)</span></code> where <code class="docutils literal notranslate"><span class="pre">yaml_text</span></code>
is the YAML text from the HDF5 file.</p>
</section>
<section id="streams">
<h3>Streams<a class="headerlink" href="#streams" title="Permalink to this heading">#</a></h3>
<p>Data from each ophyd signal in a <em>document stream</em> is stored as datasets
within a <code class="docutils literal notranslate"><span class="pre">NXdata</span></code> <a class="footnote-reference brackets" href="#id5" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> subgroup of that stream.  Bluesky collects value(s) and timestamp(s)
which are stored in the datasets <code class="docutils literal notranslate"><span class="pre">value</span></code> and <code class="docutils literal notranslate"><span class="pre">EPOCH</span></code>, respectively.
Since <code class="docutils literal notranslate"><span class="pre">EPOCH</span></code> is the absolute number of seconds from some time in the deep past,
an additional <code class="docutils literal notranslate"><span class="pre">time</span></code> dataset repeats this data as time <em>relative</em> to the first time.
(This makes it much easier for some visualization programs to display
value v. time plots.)  Additional information, as available (such as units),
is added as NeXus attributes.  The <code class="docutils literal notranslate"><span class="pre">&#64;target</span></code> attribute is automatically added
to simplify linking any item into the NeXus tree structure.</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id5" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id4">1</a><span class="fn-bracket">]</span></span>
<p><code class="docutils literal notranslate"><span class="pre">NXdata</span></code> is used since some visualization tools recognize it to make a plot.</p>
</aside>
</aside>
<p>For example, the main data in a run is usually stored in the <code class="docutils literal notranslate"><span class="pre">primary</span></code> stream.
Here, we show the tree structure for one signal (<code class="docutils literal notranslate"><span class="pre">I0_USAXS</span></code>) from the primary stream:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>  primary:NXnote
<span class="linenos"> 2</span>    @NX_class = NXnote
<span class="linenos"> 3</span>    @target = /entry/instrument/bluesky/streams/primary
<span class="linenos"> 4</span>    @uid = 90489e9b-d66e-4753-8c4f-849e7a809aeb
<span class="linenos"> 5</span>    I0_USAXS:NXdata
<span class="linenos"> 6</span>      @NX_class = NXdata
<span class="linenos"> 7</span>      @axes = time
<span class="linenos"> 8</span>      @signal = value
<span class="linenos"> 9</span>      @signal_type = detector
<span class="linenos">10</span>      @target = /entry/instrument/bluesky/streams/primary/I0_USAXS
<span class="linenos">11</span>      EPOCH:NX_FLOAT64[31] = [1556837134.972796, 1556837135.589462, 1556837135.989462, &#39;...&#39;, 1556837147.656129]
<span class="linenos">12</span>        @long_name = epoch time (s)
<span class="linenos">13</span>        @target = /entry/instrument/bluesky/streams/primary/I0_USAXS/EPOCH
<span class="linenos">14</span>        @units = s
<span class="linenos">15</span>      time:NX_FLOAT64[31] = [0.0, 0.6166660785675049, 1.0166659355163574, &#39;...&#39;, 12.683332920074463]
<span class="linenos">16</span>        @long_name = time since first data (s)
<span class="linenos">17</span>        @start_time = 1556837134.972796
<span class="linenos">18</span>        @start_time_iso = 2019-05-02T17:45:34.972796
<span class="linenos">19</span>        @target = /entry/instrument/bluesky/streams/primary/I0_USAXS/time
<span class="linenos">20</span>        @units = s
<span class="linenos">21</span>      value:NX_FLOAT64[31] = [127.0, 126.0, 127.0, &#39;...&#39;, 127.0]
<span class="linenos">22</span>        @long_name = I0_USAXS
<span class="linenos">23</span>        @lower_ctrl_limit = 0.0
<span class="linenos">24</span>        @precision = 0
<span class="linenos">25</span>        @signal_type = detector
<span class="linenos">26</span>        @source = PV:9idcLAX:vsc:c0.S2
<span class="linenos">27</span>        @target = /entry/instrument/bluesky/streams/primary/I0_USAXS/value
<span class="linenos">28</span>        @units = 
<span class="linenos">29</span>        @upper_ctrl_limit = 0.0
</pre></div>
</div>
</section>
<section id="baseline">
<h3>Baseline<a class="headerlink" href="#baseline" title="Permalink to this heading">#</a></h3>
<p>In Bluesky, <em>baseline</em> streams record the value (and timestamp) of a
signal at the start and end of the run.  Similar to the handling for
streams (above), a subgroup is created for each baseline stream.
The datasets include <code class="docutils literal notranslate"><span class="pre">value</span></code>, <code class="docutils literal notranslate"><span class="pre">EPOCH</span></code>, <code class="docutils literal notranslate"><span class="pre">time</span></code> (as above) and
<code class="docutils literal notranslate"><span class="pre">value_start</span></code> and <code class="docutils literal notranslate"><span class="pre">value_end</span></code>.  Here’s an example:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>  baseline:NXnote
<span class="linenos"> 2</span>    @NX_class = NXnote
<span class="linenos"> 3</span>    @target = /entry/instrument/bluesky/streams/baseline
<span class="linenos"> 4</span>    @uid = f5fce6ac-f3fa-4c34-b11d-9e33c263cd20
<span class="linenos"> 5</span>    aps_current:NXdata
<span class="linenos"> 6</span>      @NX_class = NXdata
<span class="linenos"> 7</span>      @axes = time
<span class="linenos"> 8</span>      @signal = value
<span class="linenos"> 9</span>      @target = /entry/instrument/bluesky/streams/baseline/aps_current
<span class="linenos">10</span>      EPOCH:NX_FLOAT64[2] = [1556837133.753769, 1556837147.753723]
<span class="linenos">11</span>        @long_name = epoch time (s)
<span class="linenos">12</span>        @target = /entry/instrument/bluesky/streams/baseline/aps_current/EPOCH
<span class="linenos">13</span>        @units = s
<span class="linenos">14</span>      time:NX_FLOAT64[2] = [0.0, 13.999953985214233]
<span class="linenos">15</span>        @long_name = time since first data (s)
<span class="linenos">16</span>        @start_time = 1556837133.753769
<span class="linenos">17</span>        @start_time_iso = 2019-05-02T17:45:33.753769
<span class="linenos">18</span>        @target = /entry/instrument/bluesky/streams/baseline/aps_current/time
<span class="linenos">19</span>        @units = s
<span class="linenos">20</span>      value:NX_FLOAT64[2] = [0.004512578244000032, 0.003944485484000011]
<span class="linenos">21</span>        @long_name = aps_current
<span class="linenos">22</span>        @lower_ctrl_limit = 0.0
<span class="linenos">23</span>        @precision = 1
<span class="linenos">24</span>        @source = PV:S:SRcurrentAI
<span class="linenos">25</span>        @target = /entry/instrument/bluesky/streams/baseline/aps_current/value
<span class="linenos">26</span>        @units = mA
<span class="linenos">27</span>        @upper_ctrl_limit = 310.0
<span class="linenos">28</span>      value_end:NX_FLOAT64[] = 
<span class="linenos">29</span>        @long_name = aps_current
<span class="linenos">30</span>        @lower_ctrl_limit = 0.0
<span class="linenos">31</span>        @precision = 1
<span class="linenos">32</span>        @source = PV:S:SRcurrentAI
<span class="linenos">33</span>        @target = /entry/instrument/bluesky/streams/baseline/aps_current/value_end
<span class="linenos">34</span>        @units = mA
<span class="linenos">35</span>        @upper_ctrl_limit = 310.0
<span class="linenos">36</span>      value_start:NX_FLOAT64[] = 
<span class="linenos">37</span>        @long_name = aps_current
<span class="linenos">38</span>        @lower_ctrl_limit = 0.0
<span class="linenos">39</span>        @precision = 1
<span class="linenos">40</span>        @source = PV:S:SRcurrentAI
<span class="linenos">41</span>        @target = /entry/instrument/bluesky/streams/baseline/aps_current/value_start
<span class="linenos">42</span>        @units = mA
<span class="linenos">43</span>        @upper_ctrl_limit = 310.0
</pre></div>
</div>
</section>
<section id="full-structure">
<h3>Full Structure<a class="headerlink" href="#full-structure" title="Permalink to this heading">#</a></h3>
<p>The full structure of the example HDF5/NeXus file (omitting the attributes
and array data for brevity) is shown next.  You can see that most of the
NeXus structure is completed by making links to data from either
<code class="docutils literal notranslate"><span class="pre">/entry/instrument/bluesky/metadata</span></code> or <code class="docutils literal notranslate"><span class="pre">/entry/instrument/bluesky/streams</span></code>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span>20190502-174533-S00108-2ffe4d8.hdf : NeXus data file
<span class="linenos">  2</span>  entry:NXentry
<span class="linenos">  3</span>    duration:NX_FLOAT64[] = [ ... ]
<span class="linenos">  4</span>    end_time:NX_CHAR = 2019-05-02T17:45:48.078618
<span class="linenos">  5</span>    entry_identifier --&gt; /entry/instrument/bluesky/uid
<span class="linenos">  6</span>    plan_name --&gt; /entry/instrument/bluesky/metadata/plan_name
<span class="linenos">  7</span>    program_name:NX_CHAR = bluesky
<span class="linenos">  8</span>    start_time:NX_CHAR = 2019-05-02T17:45:33.937294
<span class="linenos">  9</span>    title:NX_CHAR = tune_mr-S0108-2ffe4d8
<span class="linenos"> 10</span>    contact:NXuser
<span class="linenos"> 11</span>      affiliation --&gt; /entry/instrument/bluesky/streams/baseline/bss_user_info_institution/value_start
<span class="linenos"> 12</span>      email --&gt; /entry/instrument/bluesky/streams/baseline/bss_user_info_email/value_start
<span class="linenos"> 13</span>      facility_user_id --&gt; /entry/instrument/bluesky/streams/baseline/bss_user_info_badge/value_start
<span class="linenos"> 14</span>      name --&gt; /entry/instrument/bluesky/streams/baseline/bss_user_info_contact/value_start
<span class="linenos"> 15</span>      role:NX_CHAR = contact
<span class="linenos"> 16</span>    data:NXdata
<span class="linenos"> 17</span>      EPOCH --&gt; /entry/instrument/bluesky/streams/primary/scaler0_time/time
<span class="linenos"> 18</span>      I0_USAXS --&gt; /entry/instrument/bluesky/streams/primary/I0_USAXS/value
<span class="linenos"> 19</span>      m_stage_r --&gt; /entry/instrument/bluesky/streams/primary/m_stage_r/value
<span class="linenos"> 20</span>      m_stage_r_soft_limit_hi --&gt; /entry/instrument/bluesky/streams/primary/m_stage_r_soft_limit_hi/value
<span class="linenos"> 21</span>      m_stage_r_soft_limit_lo --&gt; /entry/instrument/bluesky/streams/primary/m_stage_r_soft_limit_lo/value
<span class="linenos"> 22</span>      m_stage_r_user_setpoint --&gt; /entry/instrument/bluesky/streams/primary/m_stage_r_user_setpoint/value
<span class="linenos"> 23</span>      scaler0_display_rate --&gt; /entry/instrument/bluesky/streams/primary/scaler0_display_rate/value
<span class="linenos"> 24</span>      scaler0_time --&gt; /entry/instrument/bluesky/streams/primary/scaler0_time/value
<span class="linenos"> 25</span>    instrument:NXinstrument
<span class="linenos"> 26</span>      bluesky:NXnote
<span class="linenos"> 27</span>        plan_name --&gt; /entry/instrument/bluesky/metadata/plan_name
<span class="linenos"> 28</span>        uid --&gt; /entry/instrument/bluesky/metadata/run_start_uid
<span class="linenos"> 29</span>        metadata:NXnote
<span class="linenos"> 30</span>          APSTOOLS_VERSION:NX_CHAR = b&#39;1.1.0&#39;
<span class="linenos"> 31</span>          BLUESKY_VERSION:NX_CHAR = b&#39;1.5.2&#39;
<span class="linenos"> 32</span>          EPICS_CA_MAX_ARRAY_BYTES:NX_CHAR = b&#39;1280000&#39;
<span class="linenos"> 33</span>          EPICS_HOST_ARCH:NX_CHAR = b&#39;linux-x86_64&#39;
<span class="linenos"> 34</span>          OPHYD_VERSION:NX_CHAR = b&#39;1.3.3&#39;
<span class="linenos"> 35</span>          beamline_id:NX_CHAR = b&#39;APS USAXS 9-ID-C&#39;
<span class="linenos"> 36</span>          datetime:NX_CHAR = b&#39;2019-05-02 17:45:33.904824&#39;
<span class="linenos"> 37</span>          detectors:NX_CHAR = b&#39;- I0_USAXS\n&#39;
<span class="linenos"> 38</span>          hints:NX_CHAR = b&#39;dimensions:\n- - - m_stage_r\n  - primary\n&#39;
<span class="linenos"> 39</span>          login_id:NX_CHAR = b&#39;usaxs@usaxscontrol.xray.aps.anl.gov&#39;
<span class="linenos"> 40</span>          motors:NX_CHAR = b&#39;- m_stage_r\n&#39;
<span class="linenos"> 41</span>          pid:NX_INT64[] = [ ... ]
<span class="linenos"> 42</span>          plan_name:NX_CHAR = b&#39;tune_mr&#39;
<span class="linenos"> 43</span>          plan_type:NX_CHAR = b&#39;generator&#39;
<span class="linenos"> 44</span>          proposal_id:NX_CHAR = b&#39;testing Bluesky installation&#39;
<span class="linenos"> 45</span>          purpose:NX_CHAR = b&#39;tuner&#39;
<span class="linenos"> 46</span>          run_start_uid:NX_CHAR = 2ffe4d87-9f0c-464a-9d14-213ec71afaf7
<span class="linenos"> 47</span>          tune_md:NX_CHAR = b&quot;initial_position: 8.824977\ntime_iso8601: &#39;2019-05-02 17:45:33.923544&#39;\nwidth: -0.004\n&quot;
<span class="linenos"> 48</span>          tune_parameters:NX_CHAR = b&#39;initial_position: 8.824977\nnum: 31\npeak_choice: com\nwidth: -0.004\nx_axis: m_stage_r\ny_axis: I0_USAXS\n&#39;
<span class="linenos"> 49</span>          uid --&gt; /entry/instrument/bluesky/run_start_uid
<span class="linenos"> 50</span>        streams:NXnote
<span class="linenos"> 51</span>          baseline:NXnote
<span class="linenos"> 52</span>            aps_current:NXdata
<span class="linenos"> 53</span>              EPOCH:NX_FLOAT64[2] = [ ... ]
<span class="linenos"> 54</span>              time:NX_FLOAT64[2] = [ ... ]
<span class="linenos"> 55</span>              value:NX_FLOAT64[2] = [ ... ]
<span class="linenos"> 56</span>              value_end:NX_FLOAT64[] = [ ... ]
<span class="linenos"> 57</span>              value_start:NX_FLOAT64[] = [ ... ]
<span class="linenos"> 58</span>            aps_fill_number:NXdata
<span class="linenos"> 59</span>              EPOCH:NX_FLOAT64[2] = [ ... ]
<span class="linenos"> 60</span>              time:NX_FLOAT64[2] = [ ... ]
<span class="linenos"> 61</span>              value:NX_FLOAT64[2] = [ ... ]
<span class="linenos"> 62</span>              value_end:NX_FLOAT64[] = [ ... ]
<span class="linenos"> 63</span>              value_start:NX_FLOAT64[] = [ ... ]
<span class="linenos"> 64</span>            aps_global_feedback:NXdata
<span class="linenos"> 65</span>              EPOCH:NX_FLOAT64[2] = [ ... ]
<span class="linenos"> 66</span>              time:NX_FLOAT64[2] = [ ... ]
<span class="linenos"> 67</span>              value:NX_CHAR[3,3] = [&quot;Off&quot;, &quot;Off&quot;]
<span class="linenos"> 68</span>              value_end:NX_CHAR = b&#39;Off&#39;
<span class="linenos"> 69</span>              value_start:NX_CHAR = b&#39;Off&#39;
<span class="linenos"> 70</span>            # many baseline groups omitted for brevity
<span class="linenos"> 71</span>          primary:NXnote
<span class="linenos"> 72</span>            I0_USAXS:NXdata
<span class="linenos"> 73</span>              EPOCH:NX_FLOAT64[31] = [ ... ]
<span class="linenos"> 74</span>              time:NX_FLOAT64[31] = [ ... ]
<span class="linenos"> 75</span>              value:NX_FLOAT64[31] = [ ... ]
<span class="linenos"> 76</span>            m_stage_r:NXdata
<span class="linenos"> 77</span>              EPOCH:NX_FLOAT64[31] = [ ... ]
<span class="linenos"> 78</span>              time:NX_FLOAT64[31] = [ ... ]
<span class="linenos"> 79</span>              value:NX_FLOAT64[31] = [ ... ]
<span class="linenos"> 80</span>            m_stage_r_soft_limit_hi:NXdata
<span class="linenos"> 81</span>              EPOCH:NX_FLOAT64[31] = [ ... ]
<span class="linenos"> 82</span>              time:NX_FLOAT64[31] = [ ... ]
<span class="linenos"> 83</span>              value:NX_FLOAT64[31] = [ ... ]
<span class="linenos"> 84</span>            m_stage_r_soft_limit_lo:NXdata
<span class="linenos"> 85</span>              EPOCH:NX_FLOAT64[31] = [ ... ]
<span class="linenos"> 86</span>              time:NX_FLOAT64[31] = [ ... ]
<span class="linenos"> 87</span>              value:NX_FLOAT64[31] = [ ... ]
<span class="linenos"> 88</span>            m_stage_r_user_setpoint:NXdata
<span class="linenos"> 89</span>              EPOCH:NX_FLOAT64[31] = [ ... ]
<span class="linenos"> 90</span>              time:NX_FLOAT64[31] = [ ... ]
<span class="linenos"> 91</span>              value:NX_FLOAT64[31] = [ ... ]
<span class="linenos"> 92</span>            scaler0_display_rate:NXdata
<span class="linenos"> 93</span>              EPOCH:NX_FLOAT64[31] = [ ... ]
<span class="linenos"> 94</span>              time:NX_FLOAT64[31] = [ ... ]
<span class="linenos"> 95</span>              value:NX_FLOAT64[31] = [ ... ]
<span class="linenos"> 96</span>            scaler0_time:NXdata
<span class="linenos"> 97</span>              EPOCH:NX_FLOAT64[31] = [ ... ]
<span class="linenos"> 98</span>              time:NX_FLOAT64[31] = [ ... ]
<span class="linenos"> 99</span>              value:NX_FLOAT64[31] = [ ... ]
<span class="linenos">100</span>      detectors:NXnote
<span class="linenos">101</span>        I0_USAXS:NXdetector
<span class="linenos">102</span>          data --&gt; /entry/instrument/bluesky/streams/primary/I0_USAXS
<span class="linenos">103</span>      monochromator:NXmonochromator
<span class="linenos">104</span>        energy --&gt; /entry/instrument/bluesky/streams/baseline/monochromator_dcm_energy/value_start
<span class="linenos">105</span>        feedback_on --&gt; /entry/instrument/bluesky/streams/baseline/monochromator_feedback_on/value_start
<span class="linenos">106</span>        mode --&gt; /entry/instrument/bluesky/streams/baseline/monochromator_dcm_mode/value_start
<span class="linenos">107</span>        theta --&gt; /entry/instrument/bluesky/streams/baseline/monochromator_dcm_theta/value_start
<span class="linenos">108</span>        wavelength --&gt; /entry/instrument/bluesky/streams/baseline/monochromator_dcm_wavelength/value_start
<span class="linenos">109</span>        y_offset --&gt; /entry/instrument/bluesky/streams/baseline/monochromator_dcm_y_offset/value_start
<span class="linenos">110</span>      positioners:NXnote
<span class="linenos">111</span>        m_stage_r:NXpositioner
<span class="linenos">112</span>          value --&gt; /entry/instrument/bluesky/streams/primary/m_stage_r
<span class="linenos">113</span>      source:NXsource
<span class="linenos">114</span>        name:NX_CHAR = Bluesky framework
<span class="linenos">115</span>        probe:NX_CHAR = x-ray
<span class="linenos">116</span>        type:NX_CHAR = Synchrotron X-ray Source
</pre></div>
</div>
</section>
</section>
<section id="aps-specific-hdf5-nexus-file-structures">
<h2>APS-specific HDF5/NeXus File Structures<a class="headerlink" href="#aps-specific-hdf5-nexus-file-structures" title="Permalink to this heading">#</a></h2>
<p>Examples of additional structure in NeXus file added by
<a class="reference internal" href="#apstools.callbacks.nexus_writer.NXWriterAPS" title="apstools.callbacks.nexus_writer.NXWriterAPS"><code class="xref py py-class docutils literal notranslate"><span class="pre">NXWriterAPS()</span></code></a>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>  source:NXsource
<span class="linenos"> 2</span>    @NX_class = NXsource
<span class="linenos"> 3</span>    @target = /entry/instrument/source
<span class="linenos"> 4</span>    current --&gt; /entry/instrument/bluesky/streams/baseline/aps_current/value_start
<span class="linenos"> 5</span>    energy:NX_INT64[] = 
<span class="linenos"> 6</span>      @units = GeV
<span class="linenos"> 7</span>    fill_number --&gt; /entry/instrument/bluesky/streams/baseline/aps_fill_number/value_start
<span class="linenos"> 8</span>    name:NX_CHAR = Advanced Photon Source
<span class="linenos"> 9</span>      @short_name = APS
<span class="linenos">10</span>    probe:NX_CHAR = x-ray
<span class="linenos">11</span>    type:NX_CHAR = Synchrotron X-ray Source
<span class="linenos">12</span>  undulator:NXinsertion_device
<span class="linenos">13</span>    @NX_class = NXinsertion_device
<span class="linenos">14</span>    @target = /entry/instrument/undulator
<span class="linenos">15</span>    device --&gt; /entry/instrument/bluesky/streams/baseline/undulator_downstream_device/value_start
<span class="linenos">16</span>    energy --&gt; /entry/instrument/bluesky/streams/baseline/undulator_downstream_energy/value_start
<span class="linenos">17</span>    energy_taper --&gt; /entry/instrument/bluesky/streams/baseline/undulator_downstream_energy_taper/value_start
<span class="linenos">18</span>    gap --&gt; /entry/instrument/bluesky/streams/baseline/undulator_downstream_gap/value_start
<span class="linenos">19</span>    gap_taper --&gt; /entry/instrument/bluesky/streams/baseline/undulator_downstream_gap_taper/value_start
<span class="linenos">20</span>    harmonic_value --&gt; /entry/instrument/bluesky/streams/baseline/undulator_downstream_harmonic_value/value_start
<span class="linenos">21</span>    location --&gt; /entry/instrument/bluesky/streams/baseline/undulator_downstream_location/value_start
<span class="linenos">22</span>    total_power --&gt; /entry/instrument/bluesky/streams/baseline/undulator_downstream_total_power/value_start
<span class="linenos">23</span>    type:NX_CHAR = undulator
<span class="linenos">24</span>    version --&gt; /entry/instrument/bluesky/streams/baseline/undulator_downstream_version/value_start
</pre></div>
</div>
</section>
<section id="spec-file-structure">
<h2>SPEC File Structure<a class="headerlink" href="#spec-file-structure" title="Permalink to this heading">#</a></h2>
<p>EXAMPLE : use as Bluesky callback:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">apstools</span> <span class="kn">import</span> <span class="n">SpecWriterCallback</span>
<span class="n">specwriter</span> <span class="o">=</span> <span class="n">SpecWriterCallback</span><span class="p">()</span>
<span class="n">RE</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">specwriter</span><span class="o">.</span><span class="n">receiver</span><span class="p">)</span>
</pre></div>
</div>
<p>EXAMPLE : use as writer from Databroker:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">apstools</span> <span class="kn">import</span> <span class="n">SpecWriterCallback</span>
<span class="n">specwriter</span> <span class="o">=</span> <span class="n">SpecWriterCallback</span><span class="p">()</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">get_documents</span><span class="p">(</span><span class="n">db</span><span class="p">[</span><span class="s2">&quot;a123456&quot;</span><span class="p">]):</span>
    <span class="n">specwriter</span><span class="o">.</span><span class="n">receiver</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">doc</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Look at SPEC data file: &quot;</span><span class="o">+</span><span class="n">specwriter</span><span class="o">.</span><span class="n">spec_filename</span><span class="p">)</span>
</pre></div>
</div>
<p>EXAMPLE : use as writer from Databroker with customizations:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">apstools</span> <span class="kn">import</span> <span class="n">SpecWriterCallback</span>

<span class="c1"># write into file: /tmp/cerium.spec</span>
<span class="n">specwriter</span> <span class="o">=</span> <span class="n">SpecWriterCallback</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;/tmp/cerium.spec&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">get_documents</span><span class="p">(</span><span class="n">db</span><span class="p">[</span><span class="s2">&quot;abcd123&quot;</span><span class="p">]):</span>
    <span class="n">specwriter</span><span class="o">.</span><span class="n">receiver</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">doc</span><span class="p">)</span>

<span class="c1"># write into file: /tmp/barium.dat</span>
<span class="n">specwriter</span><span class="o">.</span><span class="n">newfile</span><span class="p">(</span><span class="s2">&quot;/tmp/barium.dat&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">get_documents</span><span class="p">(</span><span class="n">db</span><span class="p">[</span><span class="s2">&quot;b46b63d4&quot;</span><span class="p">]):</span>
    <span class="n">specwriter</span><span class="o">.</span><span class="n">receiver</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">doc</span><span class="p">)</span>
</pre></div>
</div>
<p>Example output from <code class="docutils literal notranslate"><span class="pre">SpecWriterCallback()</span></code>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>#F test_specdata.txt
<span class="linenos"> 2</span>#E 1510948301
<span class="linenos"> 3</span>#D Fri Nov 17 13:51:41 2017
<span class="linenos"> 4</span>#C BlueSky  user = mintadmin  host = mint-vm
<span class="linenos"> 5</span>
<span class="linenos"> 6</span>#S 233  scan(detectors=[&#39;synthetic_pseudovoigt&#39;], num=20, motor=[&#39;m1&#39;], start=-1.65, stop=-1.25, per_step=None)
<span class="linenos"> 7</span>#D Fri Nov 17 11:58:56 2017
<span class="linenos"> 8</span>#C Fri Nov 17 11:58:56 2017.  plan_type = generator
<span class="linenos"> 9</span>#C Fri Nov 17 11:58:56 2017.  uid = ddb81ac5-f3ee-4219-b047-c1196d08a5c1
<span class="linenos">10</span>#MD beamline_id = developer__YOUR_BEAMLINE_HERE
<span class="linenos">11</span>#MD login_id = mintadmin@mint-vm
<span class="linenos">12</span>#MD motors = [&#39;m1&#39;]
<span class="linenos">13</span>#MD num_intervals = 19
<span class="linenos">14</span>#MD num_points = 20
<span class="linenos">15</span>#MD pid = 7133
<span class="linenos">16</span>#MD plan_pattern = linspace
<span class="linenos">17</span>#MD plan_pattern_args = {&#39;start&#39;: -1.65, &#39;stop&#39;: -1.25, &#39;num&#39;: 20}
<span class="linenos">18</span>#MD plan_pattern_module = numpy
<span class="linenos">19</span>#MD proposal_id = None
<span class="linenos">20</span>#N 20
<span class="linenos">21</span>#L m1  m1_user_setpoint  Epoch_float  Epoch  synthetic_pseudovoigt
<span class="linenos">22</span>-1.6500000000000001 -1.65 8.27465009689331 8 2155.6249784809206
<span class="linenos">23</span>-1.6288 -1.6289473684210525 8.46523666381836 8 2629.5229081466964
<span class="linenos">24</span>-1.608 -1.6078947368421053 8.665581226348877 9 3277.4074328018964
<span class="linenos">25</span>-1.5868 -1.5868421052631578 8.865738153457642 9 4246.145049452576
<span class="linenos">26</span>-1.5656 -1.5657894736842104 9.066259145736694 9 5825.186516381953
<span class="linenos">27</span>-1.5448000000000002 -1.5447368421052632 9.266754627227783 9 8803.414029867528
<span class="linenos">28</span>-1.5236 -1.5236842105263158 9.467074871063232 9 15501.419687691103
<span class="linenos">29</span>-1.5028000000000001 -1.5026315789473683 9.667330741882324 10 29570.38936784884
<span class="linenos">30</span>-1.4816 -1.4815789473684209 9.867793798446655 10 55562.3437459487
<span class="linenos">31</span>-1.4604000000000001 -1.4605263157894737 10.067811012268066 10 89519.64275090238
<span class="linenos">32</span>-1.4396 -1.4394736842105262 10.268356084823608 10 97008.97190269837
<span class="linenos">33</span>-1.4184 -1.418421052631579 10.470621824264526 10 65917.29757650592
<span class="linenos">34</span>-1.3972 -1.3973684210526316 10.669955730438232 11 36203.46726798266
<span class="linenos">35</span>-1.3764 -1.3763157894736842 10.870310306549072 11 18897.64061096024
<span class="linenos">36</span>-1.3552 -1.3552631578947367 11.070487976074219 11 10316.223844200193
<span class="linenos">37</span>-1.3344 -1.3342105263157895 11.271018743515015 11 6540.179615556269
<span class="linenos">38</span>-1.3132000000000001 -1.313157894736842 11.4724280834198 11 4643.555421314616
<span class="linenos">39</span>-1.292 -1.2921052631578946 11.673305034637451 12 3533.8582404216445
<span class="linenos">40</span>-1.2712 -1.2710526315789474 11.874176025390625 12 2809.1872596809008
<span class="linenos">41</span>-1.25 -1.25 12.074703216552734 12 2285.9226305883626
<span class="linenos">42</span>#C Fri Nov 17 11:59:08 2017.  num_events_primary = 20
<span class="linenos">43</span>#C Fri Nov 17 11:59:08 2017.  time = 2017-11-17 11:59:08.324011
<span class="linenos">44</span>#C Fri Nov 17 11:59:08 2017.  exit_status = success
</pre></div>
</div>
</section>
<section id="module-apstools.callbacks.callback_base">
<span id="source-code"></span><h2>Source Code<a class="headerlink" href="#module-apstools.callbacks.callback_base" title="Permalink to this heading">#</a></h2>
<section id="base-class-for-file-writer-callbacks">
<h3>Base Class for File Writer Callbacks<a class="headerlink" href="#base-class-for-file-writer-callbacks" title="Permalink to this heading">#</a></h3>
<table class="autosummary longtable table autosummary">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#apstools.callbacks.callback_base.FileWriterCallbackBase" title="apstools.callbacks.callback_base.FileWriterCallbackBase"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FileWriterCallbackBase</span></code></a>(*args, **kwargs)</p></td>
<td><p>Base class for filewriter callbacks.</p></td>
</tr>
</tbody>
</table>
</section>
<dl class="py class">
<dt class="sig sig-object py" id="apstools.callbacks.callback_base.FileWriterCallbackBase">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">apstools.callbacks.callback_base.</span></span><span class="sig-name descname"><span class="pre">FileWriterCallbackBase</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/callback_base.html#FileWriterCallbackBase"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.callback_base.FileWriterCallbackBase" title="Permalink to this definition">#</a></dt>
<dd><p>Base class for filewriter callbacks.</p>
<p id="index-0">New with apstools release 1.3.0.</p>
<p>Applications should subclass and rewrite the <code class="docutils literal notranslate"><span class="pre">writer()</span></code> method.</p>
<p>The local buffers are cleared when a start document is received.
Content is collected here from each document until the stop document.
The content is written once the stop document is received.</p>
<p>User Interface methods</p>
<table class="autosummary longtable table autosummary">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#apstools.callbacks.callback_base.FileWriterCallbackBase.receiver" title="apstools.callbacks.callback_base.FileWriterCallbackBase.receiver"><code class="xref py py-obj docutils literal notranslate"><span class="pre">receiver</span></code></a>(key, doc)</p></td>
<td><p>bluesky callback (handles a stream of documents)</p></td>
</tr>
</tbody>
</table>
<p>Internal methods</p>
<table class="autosummary longtable table autosummary">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#apstools.callbacks.callback_base.FileWriterCallbackBase.clear" title="apstools.callbacks.callback_base.FileWriterCallbackBase.clear"><code class="xref py py-obj docutils literal notranslate"><span class="pre">clear</span></code></a>()</p></td>
<td><p>delete any saved data from the cache and reinitialize</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#apstools.callbacks.callback_base.FileWriterCallbackBase.make_file_name" title="apstools.callbacks.callback_base.FileWriterCallbackBase.make_file_name"><code class="xref py py-obj docutils literal notranslate"><span class="pre">make_file_name</span></code></a>()</p></td>
<td><p>generate a file name to be used as default</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#apstools.callbacks.callback_base.FileWriterCallbackBase.writer" title="apstools.callbacks.callback_base.FileWriterCallbackBase.writer"><code class="xref py py-obj docutils literal notranslate"><span class="pre">writer</span></code></a>()</p></td>
<td><p>print summary of run as diagnostic</p></td>
</tr>
</tbody>
</table>
<p>Document Handler methods</p>
<table class="autosummary longtable table autosummary">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#apstools.callbacks.callback_base.FileWriterCallbackBase.bulk_events" title="apstools.callbacks.callback_base.FileWriterCallbackBase.bulk_events"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bulk_events</span></code></a>(doc)</p></td>
<td><p>Deprecated.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#apstools.callbacks.callback_base.FileWriterCallbackBase.datum" title="apstools.callbacks.callback_base.FileWriterCallbackBase.datum"><code class="xref py py-obj docutils literal notranslate"><span class="pre">datum</span></code></a>(doc)</p></td>
<td><p>Like an event, but for data recorded outside of bluesky.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#apstools.callbacks.callback_base.FileWriterCallbackBase.descriptor" title="apstools.callbacks.callback_base.FileWriterCallbackBase.descriptor"><code class="xref py py-obj docutils literal notranslate"><span class="pre">descriptor</span></code></a>(doc)</p></td>
<td><p>description of the data stream to be acquired</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#apstools.callbacks.callback_base.FileWriterCallbackBase.event" title="apstools.callbacks.callback_base.FileWriterCallbackBase.event"><code class="xref py py-obj docutils literal notranslate"><span class="pre">event</span></code></a>(doc)</p></td>
<td><p>a single &quot;row&quot; of data</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#apstools.callbacks.callback_base.FileWriterCallbackBase.resource" title="apstools.callbacks.callback_base.FileWriterCallbackBase.resource"><code class="xref py py-obj docutils literal notranslate"><span class="pre">resource</span></code></a>(doc)</p></td>
<td><p>like a descriptor, but for data recorded outside of bluesky</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#apstools.callbacks.callback_base.FileWriterCallbackBase.start" title="apstools.callbacks.callback_base.FileWriterCallbackBase.start"><code class="xref py py-obj docutils literal notranslate"><span class="pre">start</span></code></a>(doc)</p></td>
<td><p>beginning of a run, clear cache and collect metadata</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#apstools.callbacks.callback_base.FileWriterCallbackBase.stop" title="apstools.callbacks.callback_base.FileWriterCallbackBase.stop"><code class="xref py py-obj docutils literal notranslate"><span class="pre">stop</span></code></a>(doc)</p></td>
<td><p>end of the run, end collection and initiate the <code class="docutils literal notranslate"><span class="pre">writer()</span></code> method</p></td>
</tr>
</tbody>
</table>
<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.callback_base.FileWriterCallbackBase.bulk_events">
<span class="sig-name descname"><span class="pre">bulk_events</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">doc</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/callback_base.html#FileWriterCallbackBase.bulk_events"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.callback_base.FileWriterCallbackBase.bulk_events" title="Permalink to this definition">#</a></dt>
<dd><p>Deprecated. Use EventPage instead.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.callback_base.FileWriterCallbackBase.clear">
<span class="sig-name descname"><span class="pre">clear</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/callback_base.html#FileWriterCallbackBase.clear"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.callback_base.FileWriterCallbackBase.clear" title="Permalink to this definition">#</a></dt>
<dd><p>delete any saved data from the cache and reinitialize</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.callback_base.FileWriterCallbackBase.datum">
<span class="sig-name descname"><span class="pre">datum</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">doc</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/callback_base.html#FileWriterCallbackBase.datum"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.callback_base.FileWriterCallbackBase.datum" title="Permalink to this definition">#</a></dt>
<dd><p>Like an event, but for data recorded outside of bluesky.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Datum</span>
<span class="o">=====</span>
<span class="n">datum_id</span>        <span class="p">:</span> <span class="mi">621</span><span class="n">caa0f</span><span class="o">-</span><span class="mi">70</span><span class="n">f1</span><span class="o">-</span><span class="mf">4e3</span><span class="n">d</span><span class="o">-</span><span class="mi">8718</span><span class="o">-</span><span class="n">b5123d434502</span><span class="o">/</span><span class="mi">0</span>
<span class="n">datum_kwargs</span>    <span class="p">:</span>
<span class="n">HDF5_file_name</span>  <span class="p">:</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">usaxscontrol</span><span class="o">/</span><span class="n">USAXS_data</span><span class="o">/</span><span class="mi">2020</span><span class="o">-</span><span class="mi">06</span><span class="o">/</span><span class="mi">06_10</span><span class="n">_Minjee_waxs</span><span class="o">/</span><span class="n">AGIX3N1_0699</span><span class="o">.</span><span class="n">hdf</span>
<span class="n">point_number</span>    <span class="p">:</span> <span class="mi">0</span>
<span class="n">resource</span>        <span class="p">:</span> <span class="mi">621</span><span class="n">caa0f</span><span class="o">-</span><span class="mi">70</span><span class="n">f1</span><span class="o">-</span><span class="mf">4e3</span><span class="n">d</span><span class="o">-</span><span class="mi">8718</span><span class="o">-</span><span class="n">b5123d434502</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.callback_base.FileWriterCallbackBase.descriptor">
<span class="sig-name descname"><span class="pre">descriptor</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">doc</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/callback_base.html#FileWriterCallbackBase.descriptor"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.callback_base.FileWriterCallbackBase.descriptor" title="Permalink to this definition">#</a></dt>
<dd><p>description of the data stream to be acquired</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.callback_base.FileWriterCallbackBase.event">
<span class="sig-name descname"><span class="pre">event</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">doc</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/callback_base.html#FileWriterCallbackBase.event"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.callback_base.FileWriterCallbackBase.event" title="Permalink to this definition">#</a></dt>
<dd><p>a single “row” of data</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.callback_base.FileWriterCallbackBase.make_file_name">
<span class="sig-name descname"><span class="pre">make_file_name</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/callback_base.html#FileWriterCallbackBase.make_file_name"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.callback_base.FileWriterCallbackBase.make_file_name" title="Permalink to this definition">#</a></dt>
<dd><p>generate a file name to be used as default</p>
<p>default format: {ymd}-{hms}-S{scan_id}-{short_uid}.{ext}
where the time (the run start time):</p>
<ul class="simple">
<li><p>ymd = {year:4d}{month:02d}{day:02d}</p></li>
<li><p>hms = {hour:02d}{minute:02d}{second:02d}</p></li>
</ul>
<p>override in subclass to change</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.callback_base.FileWriterCallbackBase.receiver">
<span class="sig-name descname"><span class="pre">receiver</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">doc</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/callback_base.html#FileWriterCallbackBase.receiver"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.callback_base.FileWriterCallbackBase.receiver" title="Permalink to this definition">#</a></dt>
<dd><p>bluesky callback (handles a stream of documents)</p>
<span class="target" id="index-1"></span></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.callback_base.FileWriterCallbackBase.resource">
<span class="sig-name descname"><span class="pre">resource</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">doc</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/callback_base.html#FileWriterCallbackBase.resource"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.callback_base.FileWriterCallbackBase.resource" title="Permalink to this definition">#</a></dt>
<dd><p>like a descriptor, but for data recorded outside of bluesky</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.callback_base.FileWriterCallbackBase.start">
<span class="sig-name descname"><span class="pre">start</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">doc</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/callback_base.html#FileWriterCallbackBase.start"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.callback_base.FileWriterCallbackBase.start" title="Permalink to this definition">#</a></dt>
<dd><p>beginning of a run, clear cache and collect metadata</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.callback_base.FileWriterCallbackBase.stop">
<span class="sig-name descname"><span class="pre">stop</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">doc</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/callback_base.html#FileWriterCallbackBase.stop"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.callback_base.FileWriterCallbackBase.stop" title="Permalink to this definition">#</a></dt>
<dd><p>end of the run, end collection and initiate the <code class="docutils literal notranslate"><span class="pre">writer()</span></code> method</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.callback_base.FileWriterCallbackBase.writer">
<span class="sig-name descname"><span class="pre">writer</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/callback_base.html#FileWriterCallbackBase.writer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.callback_base.FileWriterCallbackBase.writer" title="Permalink to this definition">#</a></dt>
<dd><p>print summary of run as diagnostic</p>
<p>override this method in subclass to write a file</p>
</dd></dl>

</dd></dl>

<span class="target" id="module-apstools.callbacks.nexus_writer"></span><section id="nexus-file-writer-callbacks">
<h3>NeXus File Writer Callbacks<a class="headerlink" href="#nexus-file-writer-callbacks" title="Permalink to this heading">#</a></h3>
<table class="autosummary longtable table autosummary">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#apstools.callbacks.nexus_writer.NXWriter" title="apstools.callbacks.nexus_writer.NXWriter"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NXWriter</span></code></a>(*args, **kwargs)</p></td>
<td><p>General class for writing HDF5/NeXus file (using only NeXus base classes).</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#apstools.callbacks.nexus_writer.NXWriterAPS" title="apstools.callbacks.nexus_writer.NXWriterAPS"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NXWriterAPS</span></code></a>(*args, **kwargs)</p></td>
<td><p>Customize <a class="reference internal" href="#apstools.callbacks.nexus_writer.NXWriter" title="apstools.callbacks.nexus_writer.NXWriter"><code class="xref py py-class docutils literal notranslate"><span class="pre">NXWriter</span></code></a> with APS-specific content.</p></td>
</tr>
</tbody>
</table>
</section>
<dl class="py class">
<dt class="sig sig-object py" id="apstools.callbacks.nexus_writer.NXWriter">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">apstools.callbacks.nexus_writer.</span></span><span class="sig-name descname"><span class="pre">NXWriter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/nexus_writer.html#NXWriter"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.nexus_writer.NXWriter" title="Permalink to this definition">#</a></dt>
<dd><p>General class for writing HDF5/NeXus file (using only NeXus base classes).</p>
<p id="index-2">One scan is written to one HDF5/NeXus file.</p>
<dl>
<dt>..note::</dt><dd><p>If you use <code class="docutils literal notranslate"><span class="pre">NXWriter</span></code>, you must wait for the <cite>writer()</cite> method to
finish before proceeding with the next acquisition or processing.  (The
<cite>writer()</cite> method is launched in a background thread to complete once
all readable assets are available, potentially even after the run ends.)</p>
<p>See the table below for which wait method to call.</p>
</dd>
</dl>
<p>EXAMPLES:</p>
<p>Interactive use (outside of a plan):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ...</span>
<span class="n">nxwriter</span> <span class="o">=</span> <span class="n">NXWriter</span><span class="p">()</span>  <span class="c1"># create the callback instance</span>
<span class="n">RE</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">nxwriter</span><span class="o">.</span><span class="n">receiver</span><span class="p">)</span>  <span class="c1"># subscribe to the RunEngine</span>
<span class="c1"># ...</span>
<span class="n">RE</span><span class="p">(</span><span class="n">bp</span><span class="o">.</span><span class="n">count</span><span class="p">([</span><span class="n">camera</span><span class="p">]))</span>
<span class="n">nxwriter</span><span class="o">.</span><span class="n">wait_writer</span><span class="p">()</span>
<span class="c1"># ...</span>
<span class="n">run</span> <span class="o">=</span> <span class="n">cat</span><span class="o">.</span><span class="n">v2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># for additional processing</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There are two methods to wait for the callback.  One is for <em>interactive</em>
use when not using the RunEngine.  The other is for use <em>in a plan</em> that
is executed by the bluesky RunEngine.</p>
<blockquote>
<div><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>When</p></th>
<th class="head"><p>Method</p></th>
<th class="head"><p>Which uses</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>interactive</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">wait_writer()</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">time.sleep()</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>in a plan</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">wait_writer_plan_stub()</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">yield</span> <span class="pre">from</span> <span class="pre">bps.sleep()</span></code></p></td>
</tr>
</tbody>
</table>
<p>The <code class="docutils literal notranslate"><span class="pre">wait_writer()</span></code> method calls <code class="docutils literal notranslate"><span class="pre">time.sleep()</span></code> and this would block
the RunEngine from its routine processing of other background tasks.
The <code class="docutils literal notranslate"><span class="pre">wait_writer_plan_stub()</span></code> method replaces that call with <code class="docutils literal notranslate"><span class="pre">yield</span>
<span class="pre">from</span> <span class="pre">bps.sleep()</span></code> which does not block the RunEngine from processing
other background tasks.</p>
</div></blockquote>
</div>
<p>In a custom <strong>plan</strong>, use the <code class="docutils literal notranslate"><span class="pre">wait_writer_plan_stub()</span></code> method instead:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ...</span>
<span class="n">nxwriter</span> <span class="o">=</span> <span class="n">NXWriter</span><span class="p">()</span>  <span class="c1"># create the callback instance</span>
<span class="n">RE</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">nxwriter</span><span class="o">.</span><span class="n">receiver</span><span class="p">)</span>  <span class="c1"># subscribe to the RunEngine</span>
<span class="c1"># ...</span>

<span class="k">def</span> <span class="nf">my_plan</span><span class="p">(</span><span class="n">dets</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">yield from</span> <span class="n">bp</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">dets</span><span class="p">)</span>
        <span class="k">yield from</span> <span class="n">nxwriter</span><span class="o">.</span><span class="n">wait_writer_plan_stub</span><span class="p">()</span>
</pre></div>
</div>
<p>METHODS</p>
<table class="autosummary longtable table autosummary">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#apstools.callbacks.nexus_writer.NXWriter.writer" title="apstools.callbacks.nexus_writer.NXWriter.writer"><code class="xref py py-obj docutils literal notranslate"><span class="pre">writer</span></code></a>()</p></td>
<td><p>Write collected data to HDF5/NeXus data file.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#apstools.callbacks.nexus_writer.NXWriter.h5string" title="apstools.callbacks.nexus_writer.NXWriter.h5string"><code class="xref py py-obj docutils literal notranslate"><span class="pre">h5string</span></code></a>(text)</p></td>
<td><p>Format string for h5py interface.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#apstools.callbacks.nexus_writer.NXWriter.add_dataset_attributes" title="apstools.callbacks.nexus_writer.NXWriter.add_dataset_attributes"><code class="xref py py-obj docutils literal notranslate"><span class="pre">add_dataset_attributes</span></code></a>(ds, v[, long_name])</p></td>
<td><p>add attributes from v dictionary to dataset ds</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#apstools.callbacks.nexus_writer.NXWriter.assign_signal_type" title="apstools.callbacks.nexus_writer.NXWriter.assign_signal_type"><code class="xref py py-obj docutils literal notranslate"><span class="pre">assign_signal_type</span></code></a>()</p></td>
<td><p>decide if a signal in the primary stream is a detector or a positioner</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#apstools.callbacks.nexus_writer.NXWriter.create_NX_group" title="apstools.callbacks.nexus_writer.NXWriter.create_NX_group"><code class="xref py py-obj docutils literal notranslate"><span class="pre">create_NX_group</span></code></a>(parent, specification)</p></td>
<td><p>create an h5 group with named NeXus class (specification)</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#apstools.callbacks.nexus_writer.NXWriter.get_sample_title" title="apstools.callbacks.nexus_writer.NXWriter.get_sample_title"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_sample_title</span></code></a>()</p></td>
<td><p>return the title for this sample</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#apstools.callbacks.nexus_writer.NXWriter.get_stream_link" title="apstools.callbacks.nexus_writer.NXWriter.get_stream_link"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_stream_link</span></code></a>(signal[, stream, ref])</p></td>
<td><p>return the h5 object for <code class="docutils literal notranslate"><span class="pre">signal</span></code></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#apstools.callbacks.nexus_writer.NXWriter.wait_writer" title="apstools.callbacks.nexus_writer.NXWriter.wait_writer"><code class="xref py py-obj docutils literal notranslate"><span class="pre">wait_writer</span></code></a>()</p></td>
<td><p>Wait for the writer to finish.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#apstools.callbacks.nexus_writer.NXWriter.wait_writer_plan_stub" title="apstools.callbacks.nexus_writer.NXWriter.wait_writer_plan_stub"><code class="xref py py-obj docutils literal notranslate"><span class="pre">wait_writer_plan_stub</span></code></a>()</p></td>
<td><p>Wait for the writer to finish.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#apstools.callbacks.nexus_writer.NXWriter.write_data" title="apstools.callbacks.nexus_writer.NXWriter.write_data"><code class="xref py py-obj docutils literal notranslate"><span class="pre">write_data</span></code></a>(parent)</p></td>
<td><p>group: /entry/<a class="reference external" href="data:NXdata">data:NXdata</a></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#apstools.callbacks.nexus_writer.NXWriter.write_detector" title="apstools.callbacks.nexus_writer.NXWriter.write_detector"><code class="xref py py-obj docutils literal notranslate"><span class="pre">write_detector</span></code></a>(parent)</p></td>
<td><p>group: /entry/instrument/detectors:NXnote/DETECTOR:NXdetector</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#apstools.callbacks.nexus_writer.NXWriter.write_entry" title="apstools.callbacks.nexus_writer.NXWriter.write_entry"><code class="xref py py-obj docutils literal notranslate"><span class="pre">write_entry</span></code></a>()</p></td>
<td><p>group: /entry/<a class="reference external" href="data:NXentry">data:NXentry</a></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#apstools.callbacks.nexus_writer.NXWriter.write_instrument" title="apstools.callbacks.nexus_writer.NXWriter.write_instrument"><code class="xref py py-obj docutils literal notranslate"><span class="pre">write_instrument</span></code></a>(parent)</p></td>
<td><p>group: /entry/instrument:NXinstrument</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#apstools.callbacks.nexus_writer.NXWriter.write_metadata" title="apstools.callbacks.nexus_writer.NXWriter.write_metadata"><code class="xref py py-obj docutils literal notranslate"><span class="pre">write_metadata</span></code></a>(parent)</p></td>
<td><p>group: /entry/instrument/bluesky/metadata:NXnote</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#apstools.callbacks.nexus_writer.NXWriter.write_monochromator" title="apstools.callbacks.nexus_writer.NXWriter.write_monochromator"><code class="xref py py-obj docutils literal notranslate"><span class="pre">write_monochromator</span></code></a>(parent)</p></td>
<td><p>group: /entry/instrument/monochromator:NXmonochromator</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#apstools.callbacks.nexus_writer.NXWriter.write_positioner" title="apstools.callbacks.nexus_writer.NXWriter.write_positioner"><code class="xref py py-obj docutils literal notranslate"><span class="pre">write_positioner</span></code></a>(parent)</p></td>
<td><p>group: /entry/instrument/positioners:NXnote/POSITIONER:NXpositioner</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#apstools.callbacks.nexus_writer.NXWriter.write_root" title="apstools.callbacks.nexus_writer.NXWriter.write_root"><code class="xref py py-obj docutils literal notranslate"><span class="pre">write_root</span></code></a>(filename)</p></td>
<td><p>root of the HDF5 file</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#apstools.callbacks.nexus_writer.NXWriter.write_sample" title="apstools.callbacks.nexus_writer.NXWriter.write_sample"><code class="xref py py-obj docutils literal notranslate"><span class="pre">write_sample</span></code></a>(parent)</p></td>
<td><p>group: /entry/sample:NXsample</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#apstools.callbacks.nexus_writer.NXWriter.write_slits" title="apstools.callbacks.nexus_writer.NXWriter.write_slits"><code class="xref py py-obj docutils literal notranslate"><span class="pre">write_slits</span></code></a>(parent)</p></td>
<td><p>group: /entry/instrument/slits:NXnote/SLIT:NXslit</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#apstools.callbacks.nexus_writer.NXWriter.write_source" title="apstools.callbacks.nexus_writer.NXWriter.write_source"><code class="xref py py-obj docutils literal notranslate"><span class="pre">write_source</span></code></a>(parent)</p></td>
<td><p>group: /entry/instrument/source:NXsource</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#apstools.callbacks.nexus_writer.NXWriter.write_streams" title="apstools.callbacks.nexus_writer.NXWriter.write_streams"><code class="xref py py-obj docutils literal notranslate"><span class="pre">write_streams</span></code></a>(parent)</p></td>
<td><p>group: /entry/instrument/bluesky/streams:NXnote</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#apstools.callbacks.nexus_writer.NXWriter.write_user" title="apstools.callbacks.nexus_writer.NXWriter.write_user"><code class="xref py py-obj docutils literal notranslate"><span class="pre">write_user</span></code></a>(parent)</p></td>
<td><p>group: /entry/contact:NXuser</p></td>
</tr>
</tbody>
</table>
<p>New with apstools release 1.3.0.
Update in release 1.6.11 to wait for area detector HDF5 files.</p>
<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.nexus_writer.NXWriter.add_dataset_attributes">
<span class="sig-name descname"><span class="pre">add_dataset_attributes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">v</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">long_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/nexus_writer.html#NXWriter.add_dataset_attributes"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.nexus_writer.NXWriter.add_dataset_attributes" title="Permalink to this definition">#</a></dt>
<dd><p>add attributes from v dictionary to dataset ds</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.nexus_writer.NXWriter.assign_signal_type">
<span class="sig-name descname"><span class="pre">assign_signal_type</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/nexus_writer.html#NXWriter.assign_signal_type"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.nexus_writer.NXWriter.assign_signal_type" title="Permalink to this definition">#</a></dt>
<dd><p>decide if a signal in the primary stream is a detector or a positioner</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.nexus_writer.NXWriter.create_NX_group">
<span class="sig-name descname"><span class="pre">create_NX_group</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parent</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">specification</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/nexus_writer.html#NXWriter.create_NX_group"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.nexus_writer.NXWriter.create_NX_group" title="Permalink to this definition">#</a></dt>
<dd><p>create an h5 group with named NeXus class (specification)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.nexus_writer.NXWriter.getResourceFile">
<span class="sig-name descname"><span class="pre">getResourceFile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">resource_id</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/nexus_writer.html#NXWriter.getResourceFile"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.nexus_writer.NXWriter.getResourceFile" title="Permalink to this definition">#</a></dt>
<dd><p>full path to the resource file specified by uid <code class="docutils literal notranslate"><span class="pre">resource_id</span></code></p>
<p>override in subclass as needed</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.nexus_writer.NXWriter.get_sample_title">
<span class="sig-name descname"><span class="pre">get_sample_title</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/nexus_writer.html#NXWriter.get_sample_title"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.nexus_writer.NXWriter.get_sample_title" title="Permalink to this definition">#</a></dt>
<dd><p>return the title for this sample</p>
<p>default title: {plan_name}-S{scan_id}-{short_uid}</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.nexus_writer.NXWriter.get_stream_link">
<span class="sig-name descname"><span class="pre">get_stream_link</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">signal</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stream</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ref</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/nexus_writer.html#NXWriter.get_stream_link"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.nexus_writer.NXWriter.get_stream_link" title="Permalink to this definition">#</a></dt>
<dd><p>return the h5 object for <code class="docutils literal notranslate"><span class="pre">signal</span></code></p>
<p>DEFAULTS</p>
<p><code class="docutils literal notranslate"><span class="pre">stream</span></code> : <code class="docutils literal notranslate"><span class="pre">baseline</span></code>
<code class="docutils literal notranslate"><span class="pre">key</span></code> : <code class="docutils literal notranslate"><span class="pre">value_start</span></code></p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.nexus_writer.NXWriter.h5string">
<span class="sig-name descname"><span class="pre">h5string</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">text</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/nexus_writer.html#NXWriter.h5string"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.nexus_writer.NXWriter.h5string" title="Permalink to this definition">#</a></dt>
<dd><p>Format string for h5py interface.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.nexus_writer.NXWriter.wait_writer">
<span class="sig-name descname"><span class="pre">wait_writer</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/nexus_writer.html#NXWriter.wait_writer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.nexus_writer.NXWriter.wait_writer" title="Permalink to this definition">#</a></dt>
<dd><p>Wait for the writer to finish.  For interactive use (Not in a plan).</p>
<p>If you use <code class="docutils literal notranslate"><span class="pre">NXWriter</span></code> interactively, you must call
<code class="docutils literal notranslate"><span class="pre">NXWriter.wait_writer()</span></code> which waits for all data processing to finish
before proceeding with the next acquisition or processing.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.nexus_writer.NXWriter.wait_writer_plan_stub">
<span class="sig-name descname"><span class="pre">wait_writer_plan_stub</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/nexus_writer.html#NXWriter.wait_writer_plan_stub"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.nexus_writer.NXWriter.wait_writer_plan_stub" title="Permalink to this definition">#</a></dt>
<dd><p>Wait for the writer to finish.  Use in a plan (with RunEngine).</p>
<p>If you use <code class="docutils literal notranslate"><span class="pre">NXWriter</span></code> in a plan, you must call
<code class="docutils literal notranslate"><span class="pre">NXWriter.wait_writer()</span></code> which waits for all data processing to finish
before proceeding with the next acquisition or processing.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.nexus_writer.NXWriter.write_data">
<span class="sig-name descname"><span class="pre">write_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parent</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/nexus_writer.html#NXWriter.write_data"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.nexus_writer.NXWriter.write_data" title="Permalink to this definition">#</a></dt>
<dd><p>group: /entry/<a class="reference external" href="data:NXdata">data:NXdata</a></p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.nexus_writer.NXWriter.write_detector">
<span class="sig-name descname"><span class="pre">write_detector</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parent</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/nexus_writer.html#NXWriter.write_detector"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.nexus_writer.NXWriter.write_detector" title="Permalink to this definition">#</a></dt>
<dd><p>group: /entry/instrument/detectors:NXnote/DETECTOR:NXdetector</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.nexus_writer.NXWriter.write_entry">
<span class="sig-name descname"><span class="pre">write_entry</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/nexus_writer.html#NXWriter.write_entry"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.nexus_writer.NXWriter.write_entry" title="Permalink to this definition">#</a></dt>
<dd><p>group: /entry/<a class="reference external" href="data:NXentry">data:NXentry</a></p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.nexus_writer.NXWriter.write_instrument">
<span class="sig-name descname"><span class="pre">write_instrument</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parent</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/nexus_writer.html#NXWriter.write_instrument"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.nexus_writer.NXWriter.write_instrument" title="Permalink to this definition">#</a></dt>
<dd><p>group: /entry/instrument:NXinstrument</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.nexus_writer.NXWriter.write_metadata">
<span class="sig-name descname"><span class="pre">write_metadata</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parent</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/nexus_writer.html#NXWriter.write_metadata"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.nexus_writer.NXWriter.write_metadata" title="Permalink to this definition">#</a></dt>
<dd><p>group: /entry/instrument/bluesky/metadata:NXnote</p>
<p>metadata from the bluesky start document</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.nexus_writer.NXWriter.write_monochromator">
<span class="sig-name descname"><span class="pre">write_monochromator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parent</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/nexus_writer.html#NXWriter.write_monochromator"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.nexus_writer.NXWriter.write_monochromator" title="Permalink to this definition">#</a></dt>
<dd><p>group: /entry/instrument/monochromator:NXmonochromator</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.nexus_writer.NXWriter.write_positioner">
<span class="sig-name descname"><span class="pre">write_positioner</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parent</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/nexus_writer.html#NXWriter.write_positioner"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.nexus_writer.NXWriter.write_positioner" title="Permalink to this definition">#</a></dt>
<dd><p>group: /entry/instrument/positioners:NXnote/POSITIONER:NXpositioner</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.nexus_writer.NXWriter.write_root">
<span class="sig-name descname"><span class="pre">write_root</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/nexus_writer.html#NXWriter.write_root"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.nexus_writer.NXWriter.write_root" title="Permalink to this definition">#</a></dt>
<dd><p>root of the HDF5 file</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.nexus_writer.NXWriter.write_sample">
<span class="sig-name descname"><span class="pre">write_sample</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parent</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/nexus_writer.html#NXWriter.write_sample"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.nexus_writer.NXWriter.write_sample" title="Permalink to this definition">#</a></dt>
<dd><p>group: /entry/sample:NXsample</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.nexus_writer.NXWriter.write_slits">
<span class="sig-name descname"><span class="pre">write_slits</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parent</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/nexus_writer.html#NXWriter.write_slits"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.nexus_writer.NXWriter.write_slits" title="Permalink to this definition">#</a></dt>
<dd><p>group: /entry/instrument/slits:NXnote/SLIT:NXslit</p>
<p>override in subclass to store content, name patterns
vary with each instrument</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.nexus_writer.NXWriter.write_source">
<span class="sig-name descname"><span class="pre">write_source</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parent</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/nexus_writer.html#NXWriter.write_source"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.nexus_writer.NXWriter.write_source" title="Permalink to this definition">#</a></dt>
<dd><p>group: /entry/instrument/source:NXsource</p>
<p>Note: this is (somewhat) generic, override for a different source</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.nexus_writer.NXWriter.write_streams">
<span class="sig-name descname"><span class="pre">write_streams</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parent</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/nexus_writer.html#NXWriter.write_streams"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.nexus_writer.NXWriter.write_streams" title="Permalink to this definition">#</a></dt>
<dd><p>group: /entry/instrument/bluesky/streams:NXnote</p>
<p>data from all the bluesky streams</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.nexus_writer.NXWriter.write_user">
<span class="sig-name descname"><span class="pre">write_user</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parent</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/nexus_writer.html#NXWriter.write_user"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.nexus_writer.NXWriter.write_user" title="Permalink to this definition">#</a></dt>
<dd><p>group: /entry/contact:NXuser</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.nexus_writer.NXWriter.writer">
<span class="sig-name descname"><span class="pre">writer</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/nexus_writer.html#NXWriter.writer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.nexus_writer.NXWriter.writer" title="Permalink to this definition">#</a></dt>
<dd><p>Write collected data to HDF5/NeXus data file.</p>
<p>The callback launches <code class="docutils literal notranslate"><span class="pre">_threaded_writer()</span></code> and returns. In the thread,
<code class="docutils literal notranslate"><span class="pre">write_root()</span></code> (or methods within) can wait on certain items (such as
an external HDF5 file written by an area detector IOC) to become
readable or a timeout period has expired.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="apstools.callbacks.nexus_writer.NXWriterAPS">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">apstools.callbacks.nexus_writer.</span></span><span class="sig-name descname"><span class="pre">NXWriterAPS</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/nexus_writer.html#NXWriterAPS"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.nexus_writer.NXWriterAPS" title="Permalink to this definition">#</a></dt>
<dd><p>Customize <a class="reference internal" href="#apstools.callbacks.nexus_writer.NXWriter" title="apstools.callbacks.nexus_writer.NXWriter"><code class="xref py py-class docutils literal notranslate"><span class="pre">NXWriter</span></code></a> with APS-specific content.</p>
<p id="index-3">New with apstools release 1.3.0.</p>
<ul class="simple">
<li><p>Adds <cite>/entry/instrument/undulator</cite> group if metadata exists.</p></li>
<li><p>Adds APS information to <cite>/entry/instrument/source</cite> group.</p></li>
</ul>
<table class="autosummary longtable table autosummary">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#apstools.callbacks.nexus_writer.NXWriterAPS.write_instrument" title="apstools.callbacks.nexus_writer.NXWriterAPS.write_instrument"><code class="xref py py-obj docutils literal notranslate"><span class="pre">write_instrument</span></code></a>(parent)</p></td>
<td><p>group: /entry/instrument:NXinstrument</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#apstools.callbacks.nexus_writer.NXWriterAPS.write_source" title="apstools.callbacks.nexus_writer.NXWriterAPS.write_source"><code class="xref py py-obj docutils literal notranslate"><span class="pre">write_source</span></code></a>(parent)</p></td>
<td><p>group: /entry/instrument/source:NXsource</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#apstools.callbacks.nexus_writer.NXWriterAPS.write_undulator" title="apstools.callbacks.nexus_writer.NXWriterAPS.write_undulator"><code class="xref py py-obj docutils literal notranslate"><span class="pre">write_undulator</span></code></a>(parent)</p></td>
<td><p>group: /entry/instrument/undulator:NXinsertion_device</p></td>
</tr>
</tbody>
</table>
<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.nexus_writer.NXWriterAPS.write_instrument">
<span class="sig-name descname"><span class="pre">write_instrument</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parent</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/nexus_writer.html#NXWriterAPS.write_instrument"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.nexus_writer.NXWriterAPS.write_instrument" title="Permalink to this definition">#</a></dt>
<dd><p>group: /entry/instrument:NXinstrument</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.nexus_writer.NXWriterAPS.write_source">
<span class="sig-name descname"><span class="pre">write_source</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parent</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/nexus_writer.html#NXWriterAPS.write_source"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.nexus_writer.NXWriterAPS.write_source" title="Permalink to this definition">#</a></dt>
<dd><p>group: /entry/instrument/source:NXsource</p>
<p>Note: this is specific to the APS, override for a different source</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.nexus_writer.NXWriterAPS.write_undulator">
<span class="sig-name descname"><span class="pre">write_undulator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parent</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/nexus_writer.html#NXWriterAPS.write_undulator"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.nexus_writer.NXWriterAPS.write_undulator" title="Permalink to this definition">#</a></dt>
<dd><p>group: /entry/instrument/undulator:NXinsertion_device</p>
</dd></dl>

</dd></dl>

<span class="target" id="module-apstools.callbacks.spec_file_writer"></span><section id="spec-data-file-writer-callback">
<h3>SPEC Data File Writer Callback<a class="headerlink" href="#spec-data-file-writer-callback" title="Permalink to this heading">#</a></h3>
<p>EXAMPLE:</p>
<p>Execution of this plan (with <code class="docutils literal notranslate"><span class="pre">RE(myPlan())</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">myPlan</span><span class="p">():</span>
    <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">open_run</span><span class="p">()</span>
    <span class="n">spec_comment</span><span class="p">(</span><span class="s2">&quot;this is a start document comment&quot;</span><span class="p">,</span> <span class="s2">&quot;start&quot;</span><span class="p">)</span>
    <span class="n">spec_comment</span><span class="p">(</span><span class="s2">&quot;this is a descriptor document comment&quot;</span><span class="p">,</span> <span class="s2">&quot;descriptor&quot;</span><span class="p">)</span>
    <span class="k">yield</span> <span class="n">bps</span><span class="o">.</span><span class="n">Msg</span><span class="p">(</span><span class="s1">&#39;checkpoint&#39;</span><span class="p">)</span>
    <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">trigger_and_read</span><span class="p">([</span><span class="n">scaler</span><span class="p">])</span>
    <span class="n">spec_comment</span><span class="p">(</span><span class="s2">&quot;this is an event document comment after the first read&quot;</span><span class="p">)</span>
    <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">yield</span> <span class="n">bps</span><span class="o">.</span><span class="n">Msg</span><span class="p">(</span><span class="s1">&#39;checkpoint&#39;</span><span class="p">)</span>
    <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">trigger_and_read</span><span class="p">([</span><span class="n">scaler</span><span class="p">])</span>
    <span class="n">spec_comment</span><span class="p">(</span><span class="s2">&quot;this is an event document comment after the second read&quot;</span><span class="p">)</span>
    <span class="n">spec_comment</span><span class="p">(</span><span class="s2">&quot;this is a stop document comment&quot;</span><span class="p">,</span> <span class="s2">&quot;stop&quot;</span><span class="p">)</span>
    <span class="k">yield from</span> <span class="n">bps</span><span class="o">.</span><span class="n">close_run</span><span class="p">()</span>
</pre></div>
</div>
<p>results in this SPEC file output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#S 1145  myPlan()</span>
<span class="c1">#D Mon Jan 28 12:48:09 2019</span>
<span class="c1">#C Mon Jan 28 12:48:09 2019.  plan_type = generator</span>
<span class="c1">#C Mon Jan 28 12:48:09 2019.  uid = ef98648a-8e3a-4e7e-ac99-3290c9b5fca7</span>
<span class="c1">#C Mon Jan 28 12:48:09 2019.  this is a start document comment</span>
<span class="c1">#C Mon Jan 28 12:48:09 2019.  this is a descriptor document comment</span>
<span class="c1">#MD APSTOOLS_VERSION = 2019.0103.0+5.g0f4e8b2</span>
<span class="c1">#MD BLUESKY_VERSION = 1.4.1</span>
<span class="c1">#MD OPHYD_VERSION = 1.3.0</span>
<span class="c1">#MD SESSION_START = 2019-01-28 12:19:25.446836</span>
<span class="c1">#MD beamline_id = developer</span>
<span class="c1">#MD ipython_session_start = 2018-02-14 12:54:06.447450</span>
<span class="c1">#MD login_id = mintadmin@mint-vm</span>
<span class="c1">#MD pid = 21784</span>
<span class="c1">#MD proposal_id = None</span>
<span class="c1">#N 2</span>
<span class="c1">#L Epoch_float  scaler_time  Epoch</span>
<span class="mf">1.4297869205474854</span> <span class="mf">1.1</span> <span class="mi">1</span>
<span class="mf">4.596935987472534</span> <span class="mf">1.1</span> <span class="mi">5</span>
<span class="c1">#C Mon Jan 28 12:48:11 2019.  this is an event document comment after the first read</span>
<span class="c1">#C Mon Jan 28 12:48:14 2019.  this is an event document comment after the second read</span>
<span class="c1">#C Mon Jan 28 12:48:14 2019.  this is a stop document comment</span>
<span class="c1">#C Mon Jan 28 12:48:14 2019.  num_events_primary = 2</span>
<span class="c1">#C Mon Jan 28 12:48:14 2019.  exit_status = success</span>
</pre></div>
</div>
<table class="autosummary longtable table autosummary">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback" title="apstools.callbacks.spec_file_writer.SpecWriterCallback"><code class="xref py py-obj docutils literal notranslate"><span class="pre">SpecWriterCallback</span></code></a>([filename, auto_write, ...])</p></td>
<td><p>Collect data from Bluesky RunEngine documents to write as SPEC data.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#apstools.callbacks.spec_file_writer.spec_comment" title="apstools.callbacks.spec_file_writer.spec_comment"><code class="xref py py-obj docutils literal notranslate"><span class="pre">spec_comment</span></code></a>(comment[, doc, writer])</p></td>
<td><p>make it easy to add spec-style comments in a custom plan</p></td>
</tr>
</tbody>
</table>
</section>
<dl class="py class">
<dt class="sig sig-object py" id="apstools.callbacks.spec_file_writer.SpecWriterCallback">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">apstools.callbacks.spec_file_writer.</span></span><span class="sig-name descname"><span class="pre">SpecWriterCallback</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">auto_write</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">RE</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reset_scan_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/spec_file_writer.html#SpecWriterCallback"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback" title="Permalink to this definition">#</a></dt>
<dd><p>Collect data from Bluesky RunEngine documents to write as SPEC data.</p>
<p id="index-4">This gathers data from all documents in a scan and appends scan to the file
when the <code class="docutils literal notranslate"><span class="pre">stop</span></code> document is received.  One or more scans can be written to
the same file.  The file format is text.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">SpecWriterCallback()</span></code> does <strong>not</strong> inherit
from <code class="docutils literal notranslate"><span class="pre">FileWriterCallbackBase()</span></code>.</p>
</div>
<p>PARAMETERS</p>
<dl class="simple">
<dt>filename</dt><dd><p><em>string</em> :
(optional)
Local, relative or absolute name of SPEC data file to be used.
If <code class="docutils literal notranslate"><span class="pre">filename=None</span></code>, defaults to format of <code class="docutils literal notranslate"><span class="pre">YYYmmdd-HHMMSS.dat</span></code>
derived from the current system time.</p>
</dd>
<dt>auto_write</dt><dd><p><em>boolean</em> :
(optional)
If <code class="docutils literal notranslate"><span class="pre">True</span></code> (default), <code class="docutils literal notranslate"><span class="pre">write_scan()</span></code> is called when <em>stop</em> document
is received.
If <code class="docutils literal notranslate"><span class="pre">False</span></code>, the caller is responsible for calling <code class="docutils literal notranslate"><span class="pre">write_scan()</span></code>
before the next <code class="docutils literal notranslate"><span class="pre">start</span></code> document is received.</p>
</dd>
<dt>RE</dt><dd><p><em>object</em> :
Instance of <code class="docutils literal notranslate"><span class="pre">bluesky.RunEngine</span></code> or <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
</dd>
<dt>reset_scan_id</dt><dd><p><em>boolean</em> :
(optional)
If True, and filename exists, then sets <code class="docutils literal notranslate"><span class="pre">RE.md.scan_id</span></code> to
highest scan number in existing SPEC data file.
default: False</p>
</dd>
</dl>
<p>User Interface methods</p>
<table class="autosummary longtable table autosummary">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback.receiver" title="apstools.callbacks.spec_file_writer.SpecWriterCallback.receiver"><code class="xref py py-obj docutils literal notranslate"><span class="pre">receiver</span></code></a>(key, document)</p></td>
<td><p>Bluesky callback: receive all documents for handling</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback.newfile" title="apstools.callbacks.spec_file_writer.SpecWriterCallback.newfile"><code class="xref py py-obj docutils literal notranslate"><span class="pre">newfile</span></code></a>([filename, scan_id, RE])</p></td>
<td><p>prepare to use a new SPEC data file</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback.usefile" title="apstools.callbacks.spec_file_writer.SpecWriterCallback.usefile"><code class="xref py py-obj docutils literal notranslate"><span class="pre">usefile</span></code></a>(filename)</p></td>
<td><p>read from existing SPEC data file</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback.make_default_filename" title="apstools.callbacks.spec_file_writer.SpecWriterCallback.make_default_filename"><code class="xref py py-obj docutils literal notranslate"><span class="pre">make_default_filename</span></code></a>()</p></td>
<td><p>generate a file name to be used as default</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback.clear" title="apstools.callbacks.spec_file_writer.SpecWriterCallback.clear"><code class="xref py py-obj docutils literal notranslate"><span class="pre">clear</span></code></a>()</p></td>
<td><p>reset all scan data defaults</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback.prepare_scan_contents" title="apstools.callbacks.spec_file_writer.SpecWriterCallback.prepare_scan_contents"><code class="xref py py-obj docutils literal notranslate"><span class="pre">prepare_scan_contents</span></code></a>()</p></td>
<td><p>format the scan for a SPEC data file</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback.write_scan" title="apstools.callbacks.spec_file_writer.SpecWriterCallback.write_scan"><code class="xref py py-obj docutils literal notranslate"><span class="pre">write_scan</span></code></a>()</p></td>
<td><p>write the most recent (completed) scan to the file</p></td>
</tr>
</tbody>
</table>
<p>Internal methods</p>
<table class="autosummary longtable table autosummary">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback.write_header" title="apstools.callbacks.spec_file_writer.SpecWriterCallback.write_header"><code class="xref py py-obj docutils literal notranslate"><span class="pre">write_header</span></code></a>()</p></td>
<td><p>Write the (initial) header section of a SPEC data file.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback.start" title="apstools.callbacks.spec_file_writer.SpecWriterCallback.start"><code class="xref py py-obj docutils literal notranslate"><span class="pre">start</span></code></a>(doc)</p></td>
<td><p>handle <em>start</em> documents</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback.descriptor" title="apstools.callbacks.spec_file_writer.SpecWriterCallback.descriptor"><code class="xref py py-obj docutils literal notranslate"><span class="pre">descriptor</span></code></a>(doc)</p></td>
<td><p>handle <em>descriptor</em> documents</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback.event" title="apstools.callbacks.spec_file_writer.SpecWriterCallback.event"><code class="xref py py-obj docutils literal notranslate"><span class="pre">event</span></code></a>(doc)</p></td>
<td><p>handle <em>event</em> documents</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback.bulk_events" title="apstools.callbacks.spec_file_writer.SpecWriterCallback.bulk_events"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bulk_events</span></code></a>(doc)</p></td>
<td><p>handle <em>bulk_events</em> documents</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback.datum" title="apstools.callbacks.spec_file_writer.SpecWriterCallback.datum"><code class="xref py py-obj docutils literal notranslate"><span class="pre">datum</span></code></a>(doc)</p></td>
<td><p>handle <em>datum</em> documents</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback.resource" title="apstools.callbacks.spec_file_writer.SpecWriterCallback.resource"><code class="xref py py-obj docutils literal notranslate"><span class="pre">resource</span></code></a>(doc)</p></td>
<td><p>handle <em>resource</em> documents</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback.stop" title="apstools.callbacks.spec_file_writer.SpecWriterCallback.stop"><code class="xref py py-obj docutils literal notranslate"><span class="pre">stop</span></code></a>(doc)</p></td>
<td><p>handle <em>stop</em> documents</p></td>
</tr>
</tbody>
</table>
<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.spec_file_writer.SpecWriterCallback.bulk_events">
<span class="sig-name descname"><span class="pre">bulk_events</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">doc</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/spec_file_writer.html#SpecWriterCallback.bulk_events"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback.bulk_events" title="Permalink to this definition">#</a></dt>
<dd><p>handle <em>bulk_events</em> documents</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.spec_file_writer.SpecWriterCallback.clear">
<span class="sig-name descname"><span class="pre">clear</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/spec_file_writer.html#SpecWriterCallback.clear"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback.clear" title="Permalink to this definition">#</a></dt>
<dd><p>reset all scan data defaults</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.spec_file_writer.SpecWriterCallback.datum">
<span class="sig-name descname"><span class="pre">datum</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">doc</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/spec_file_writer.html#SpecWriterCallback.datum"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback.datum" title="Permalink to this definition">#</a></dt>
<dd><p>handle <em>datum</em> documents</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.spec_file_writer.SpecWriterCallback.descriptor">
<span class="sig-name descname"><span class="pre">descriptor</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">doc</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/spec_file_writer.html#SpecWriterCallback.descriptor"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback.descriptor" title="Permalink to this definition">#</a></dt>
<dd><p>handle <em>descriptor</em> documents</p>
<p>prepare for primary scan data, ignore any other data stream</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.spec_file_writer.SpecWriterCallback.event">
<span class="sig-name descname"><span class="pre">event</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">doc</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/spec_file_writer.html#SpecWriterCallback.event"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback.event" title="Permalink to this definition">#</a></dt>
<dd><p>handle <em>event</em> documents</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.spec_file_writer.SpecWriterCallback.make_default_filename">
<span class="sig-name descname"><span class="pre">make_default_filename</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/spec_file_writer.html#SpecWriterCallback.make_default_filename"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback.make_default_filename" title="Permalink to this definition">#</a></dt>
<dd><p>generate a file name to be used as default</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.spec_file_writer.SpecWriterCallback.newfile">
<span class="sig-name descname"><span class="pre">newfile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scan_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">RE</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/spec_file_writer.html#SpecWriterCallback.newfile"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback.newfile" title="Permalink to this definition">#</a></dt>
<dd><p>prepare to use a new SPEC data file</p>
<p>but don’t create it until we have data</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.spec_file_writer.SpecWriterCallback.prepare_scan_contents">
<span class="sig-name descname"><span class="pre">prepare_scan_contents</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/spec_file_writer.html#SpecWriterCallback.prepare_scan_contents"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback.prepare_scan_contents" title="Permalink to this definition">#</a></dt>
<dd><p>format the scan for a SPEC data file</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>[str] a list of lines to append to the data file</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.spec_file_writer.SpecWriterCallback.receiver">
<span class="sig-name descname"><span class="pre">receiver</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">document</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/spec_file_writer.html#SpecWriterCallback.receiver"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback.receiver" title="Permalink to this definition">#</a></dt>
<dd><p>Bluesky callback: receive all documents for handling</p>
<span class="target" id="index-5"></span></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.spec_file_writer.SpecWriterCallback.resource">
<span class="sig-name descname"><span class="pre">resource</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">doc</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/spec_file_writer.html#SpecWriterCallback.resource"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback.resource" title="Permalink to this definition">#</a></dt>
<dd><p>handle <em>resource</em> documents</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.spec_file_writer.SpecWriterCallback.start">
<span class="sig-name descname"><span class="pre">start</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">doc</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/spec_file_writer.html#SpecWriterCallback.start"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback.start" title="Permalink to this definition">#</a></dt>
<dd><p>handle <em>start</em> documents</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.spec_file_writer.SpecWriterCallback.stop">
<span class="sig-name descname"><span class="pre">stop</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">doc</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/spec_file_writer.html#SpecWriterCallback.stop"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback.stop" title="Permalink to this definition">#</a></dt>
<dd><p>handle <em>stop</em> documents</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.spec_file_writer.SpecWriterCallback.usefile">
<span class="sig-name descname"><span class="pre">usefile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/spec_file_writer.html#SpecWriterCallback.usefile"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback.usefile" title="Permalink to this definition">#</a></dt>
<dd><p>read from existing SPEC data file</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.spec_file_writer.SpecWriterCallback.write_header">
<span class="sig-name descname"><span class="pre">write_header</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/spec_file_writer.html#SpecWriterCallback.write_header"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback.write_header" title="Permalink to this definition">#</a></dt>
<dd><p>Write the (initial) header section of a SPEC data file.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apstools.callbacks.spec_file_writer.SpecWriterCallback.write_scan">
<span class="sig-name descname"><span class="pre">write_scan</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/spec_file_writer.html#SpecWriterCallback.write_scan"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback.write_scan" title="Permalink to this definition">#</a></dt>
<dd><p>write the most recent (completed) scan to the file</p>
<ul class="simple">
<li><p>creates file if not existing</p></li>
<li><p>writes header if needed</p></li>
<li><p>appends scan data</p></li>
</ul>
<p>note:  does nothing if there are no lines to be written</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="apstools.callbacks.spec_file_writer.spec_comment">
<span class="sig-prename descclassname"><span class="pre">apstools.callbacks.spec_file_writer.</span></span><span class="sig-name descname"><span class="pre">spec_comment</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">comment</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">doc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">writer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/apstools/callbacks/spec_file_writer.html#spec_comment"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apstools.callbacks.spec_file_writer.spec_comment" title="Permalink to this definition">#</a></dt>
<dd><p>make it easy to add spec-style comments in a custom plan</p>
<p>These comments <em>only</em> go into the SPEC data file.</p>
<p>PARAMETERS</p>
<dl class="simple">
<dt>comment <em>string</em> :</dt><dd><p>(optional)
Comment text to be written.  SPEC expects it to be only one line!</p>
</dd>
<dt>doc <em>string</em> :</dt><dd><p>(optional)
Bluesky RunEngine document type.
One of: <code class="docutils literal notranslate"><span class="pre">start</span> <span class="pre">descriptor</span> <span class="pre">event</span> <span class="pre">resource</span> <span class="pre">datum</span> <span class="pre">stop</span></code>
(default: <code class="docutils literal notranslate"><span class="pre">event</span></code>)</p>
</dd>
<dt>writer <em>obj</em> :</dt><dd><p>(optional)
Instance of <code class="docutils literal notranslate"><span class="pre">SpecWriterCallback()</span></code>,
typically: <code class="docutils literal notranslate"><span class="pre">specwriter</span> <span class="pre">=</span> <span class="pre">SpecWriterCallback()</span></code></p>
</dd>
</dl>
</dd></dl>

</section>
</section>


                </article>
              
              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="_devices.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Devices</p>
      </div>
    </a>
    <a class="right-next"
       href="_plans.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Plans</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#examples">Examples</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#programmer-s-note">Programmer’s Note</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#hdf5-nexus-file-writers">HDF5/NeXus File Writers</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#filewritercallbackbase">FileWriterCallbackBase</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#output-file-name-and-path">Output File Name and Path</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#metadata">Metadata</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nxwriter">NXWriter</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Output File Name and Path</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Metadata</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nxwriteraps">NXWriterAPS</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#hdf5-nexus-file-structures">HDF5/NeXus File Structures</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Metadata</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#streams">Streams</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#baseline">Baseline</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#full-structure">Full Structure</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#aps-specific-hdf5-nexus-file-structures">APS-specific HDF5/NeXus File Structures</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#spec-file-structure">SPEC File Structure</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#module-apstools.callbacks.callback_base">Source Code</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#base-class-for-file-writer-callbacks">Base Class for File Writer Callbacks</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.callback_base.FileWriterCallbackBase"><code class="docutils literal notranslate"><span class="pre">FileWriterCallbackBase</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.callback_base.FileWriterCallbackBase.bulk_events"><code class="docutils literal notranslate"><span class="pre">FileWriterCallbackBase.bulk_events()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.callback_base.FileWriterCallbackBase.clear"><code class="docutils literal notranslate"><span class="pre">FileWriterCallbackBase.clear()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.callback_base.FileWriterCallbackBase.datum"><code class="docutils literal notranslate"><span class="pre">FileWriterCallbackBase.datum()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.callback_base.FileWriterCallbackBase.descriptor"><code class="docutils literal notranslate"><span class="pre">FileWriterCallbackBase.descriptor()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.callback_base.FileWriterCallbackBase.event"><code class="docutils literal notranslate"><span class="pre">FileWriterCallbackBase.event()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.callback_base.FileWriterCallbackBase.make_file_name"><code class="docutils literal notranslate"><span class="pre">FileWriterCallbackBase.make_file_name()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.callback_base.FileWriterCallbackBase.receiver"><code class="docutils literal notranslate"><span class="pre">FileWriterCallbackBase.receiver()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.callback_base.FileWriterCallbackBase.resource"><code class="docutils literal notranslate"><span class="pre">FileWriterCallbackBase.resource()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.callback_base.FileWriterCallbackBase.start"><code class="docutils literal notranslate"><span class="pre">FileWriterCallbackBase.start()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.callback_base.FileWriterCallbackBase.stop"><code class="docutils literal notranslate"><span class="pre">FileWriterCallbackBase.stop()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.callback_base.FileWriterCallbackBase.writer"><code class="docutils literal notranslate"><span class="pre">FileWriterCallbackBase.writer()</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nexus-file-writer-callbacks">NeXus File Writer Callbacks</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.nexus_writer.NXWriter"><code class="docutils literal notranslate"><span class="pre">NXWriter</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.nexus_writer.NXWriter.add_dataset_attributes"><code class="docutils literal notranslate"><span class="pre">NXWriter.add_dataset_attributes()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.nexus_writer.NXWriter.assign_signal_type"><code class="docutils literal notranslate"><span class="pre">NXWriter.assign_signal_type()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.nexus_writer.NXWriter.create_NX_group"><code class="docutils literal notranslate"><span class="pre">NXWriter.create_NX_group()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.nexus_writer.NXWriter.getResourceFile"><code class="docutils literal notranslate"><span class="pre">NXWriter.getResourceFile()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.nexus_writer.NXWriter.get_sample_title"><code class="docutils literal notranslate"><span class="pre">NXWriter.get_sample_title()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.nexus_writer.NXWriter.get_stream_link"><code class="docutils literal notranslate"><span class="pre">NXWriter.get_stream_link()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.nexus_writer.NXWriter.h5string"><code class="docutils literal notranslate"><span class="pre">NXWriter.h5string()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.nexus_writer.NXWriter.wait_writer"><code class="docutils literal notranslate"><span class="pre">NXWriter.wait_writer()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.nexus_writer.NXWriter.wait_writer_plan_stub"><code class="docutils literal notranslate"><span class="pre">NXWriter.wait_writer_plan_stub()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.nexus_writer.NXWriter.write_data"><code class="docutils literal notranslate"><span class="pre">NXWriter.write_data()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.nexus_writer.NXWriter.write_detector"><code class="docutils literal notranslate"><span class="pre">NXWriter.write_detector()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.nexus_writer.NXWriter.write_entry"><code class="docutils literal notranslate"><span class="pre">NXWriter.write_entry()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.nexus_writer.NXWriter.write_instrument"><code class="docutils literal notranslate"><span class="pre">NXWriter.write_instrument()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.nexus_writer.NXWriter.write_metadata"><code class="docutils literal notranslate"><span class="pre">NXWriter.write_metadata()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.nexus_writer.NXWriter.write_monochromator"><code class="docutils literal notranslate"><span class="pre">NXWriter.write_monochromator()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.nexus_writer.NXWriter.write_positioner"><code class="docutils literal notranslate"><span class="pre">NXWriter.write_positioner()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.nexus_writer.NXWriter.write_root"><code class="docutils literal notranslate"><span class="pre">NXWriter.write_root()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.nexus_writer.NXWriter.write_sample"><code class="docutils literal notranslate"><span class="pre">NXWriter.write_sample()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.nexus_writer.NXWriter.write_slits"><code class="docutils literal notranslate"><span class="pre">NXWriter.write_slits()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.nexus_writer.NXWriter.write_source"><code class="docutils literal notranslate"><span class="pre">NXWriter.write_source()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.nexus_writer.NXWriter.write_streams"><code class="docutils literal notranslate"><span class="pre">NXWriter.write_streams()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.nexus_writer.NXWriter.write_user"><code class="docutils literal notranslate"><span class="pre">NXWriter.write_user()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.nexus_writer.NXWriter.writer"><code class="docutils literal notranslate"><span class="pre">NXWriter.writer()</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.nexus_writer.NXWriterAPS"><code class="docutils literal notranslate"><span class="pre">NXWriterAPS</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.nexus_writer.NXWriterAPS.write_instrument"><code class="docutils literal notranslate"><span class="pre">NXWriterAPS.write_instrument()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.nexus_writer.NXWriterAPS.write_source"><code class="docutils literal notranslate"><span class="pre">NXWriterAPS.write_source()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.nexus_writer.NXWriterAPS.write_undulator"><code class="docutils literal notranslate"><span class="pre">NXWriterAPS.write_undulator()</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#spec-data-file-writer-callback">SPEC Data File Writer Callback</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback"><code class="docutils literal notranslate"><span class="pre">SpecWriterCallback</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback.bulk_events"><code class="docutils literal notranslate"><span class="pre">SpecWriterCallback.bulk_events()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback.clear"><code class="docutils literal notranslate"><span class="pre">SpecWriterCallback.clear()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback.datum"><code class="docutils literal notranslate"><span class="pre">SpecWriterCallback.datum()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback.descriptor"><code class="docutils literal notranslate"><span class="pre">SpecWriterCallback.descriptor()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback.event"><code class="docutils literal notranslate"><span class="pre">SpecWriterCallback.event()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback.make_default_filename"><code class="docutils literal notranslate"><span class="pre">SpecWriterCallback.make_default_filename()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback.newfile"><code class="docutils literal notranslate"><span class="pre">SpecWriterCallback.newfile()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback.prepare_scan_contents"><code class="docutils literal notranslate"><span class="pre">SpecWriterCallback.prepare_scan_contents()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback.receiver"><code class="docutils literal notranslate"><span class="pre">SpecWriterCallback.receiver()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback.resource"><code class="docutils literal notranslate"><span class="pre">SpecWriterCallback.resource()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback.start"><code class="docutils literal notranslate"><span class="pre">SpecWriterCallback.start()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback.stop"><code class="docutils literal notranslate"><span class="pre">SpecWriterCallback.stop()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback.usefile"><code class="docutils literal notranslate"><span class="pre">SpecWriterCallback.usefile()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback.write_header"><code class="docutils literal notranslate"><span class="pre">SpecWriterCallback.write_header()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.spec_file_writer.SpecWriterCallback.write_scan"><code class="docutils literal notranslate"><span class="pre">SpecWriterCallback.write_scan()</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#apstools.callbacks.spec_file_writer.spec_comment"><code class="docutils literal notranslate"><span class="pre">spec_comment()</span></code></a></li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div class="tocsection sourcelink">
    <a href="../_sources/api/_filewriters.rst.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      © Copyright 2017-2023, UChicago Argonne, LLC.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    <br/>
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.13.3.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>