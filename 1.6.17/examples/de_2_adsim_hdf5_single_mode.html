

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Area Detector, Single mode, HDF5 file &#8212; apstools 1.6.17 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'examples/de_2_adsim_hdf5_single_mode';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://raw.githubusercontent.com/BCDA-APS/apstools/main/docs/source/_static/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = '1.6.17';
        </script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="ADPerkinElmer Area Detector with default HDF5 File Name" href="de_ad_pe.html" />
    <link rel="prev" title="Area Detector with custom HDF5 File Name" href="de_1_adsim_hdf5_custom_names.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  <div class="navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    <p class="title logo__title">apstools 1.6.17 documentation</p>
  
</a></div>
    
      <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button type="button" class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle" data-bs-toggle="dropdown">
      1.6.17  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div class="version-switcher__menu dropdown-menu list-group-flush py-0">
    <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
    
  </div>
  
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../overview.html">
                        Overview
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../applications/index.html">
                        Applications
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="index.html">
                        Guides
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../api/index.html">
                        API Documentation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../install.html">
                        Installation
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../changes.html">
                        Change History
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../license.html">
                        License
                      </a>
                    </li>
                
                </div>
            </div>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../overview.html">
                        Overview
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../applications/index.html">
                        Applications
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="index.html">
                        Guides
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../api/index.html">
                        API Documentation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../install.html">
                        Installation
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../changes.html">
                        Change History
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../license.html">
                        License
                      </a>
                    </li>
                
                </div>
            </div>
            
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="de_0_adsim_hdf5_basic.html">Area Detector with default HDF5 File Name</a></li>
<li class="toctree-l1"><a class="reference internal" href="de_1_adsim_hdf5_custom_names.html">Area Detector with custom HDF5 File Name</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Area Detector, Single mode, HDF5 file</a></li>
<li class="toctree-l1"><a class="reference internal" href="de_ad_pe.html">ADPerkinElmer Area Detector with default HDF5 File Name</a></li>
<li class="toctree-l1"><a class="reference internal" href="de_ad_pilatus.html">ADPilatus Area Detector with default HDF5 File Name</a></li>
<li class="toctree-l1"><a class="reference internal" href="de_scaler_motor_flyer.html">Fly Scans with EPICS motor and scaler</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="fw_nxwriter.html">Output scan(s) to a NeXus/HDF5 file</a></li>
<li class="toctree-l1"><a class="reference internal" href="fw_specfile_example.html">Output scan(s) to a SPEC data file.</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ho_contingency.html">How to interrupt/stop/abort a running plan &amp; recover to safe settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="ho_list_control_objects.html">What are the objects to control?</a></li>
<li class="toctree-l1"><a class="reference internal" href="ho_search_databroker.html">How to Search for Bluesky Data?</a></li>
<li class="toctree-l1"><a class="reference internal" href="ho_session_logs.html">How to setup logging</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="pl_excel_scan.html">The <code class="docutils literal notranslate"><span class="pre">Excel_plan()</span></code> – batch scans using a spreadsheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="pl_lineup.html">The <code class="docutils literal notranslate"><span class="pre">lineup()</span></code> plan - align an axis with a signal</a></li>
<li class="toctree-l1"><a class="reference internal" href="pl_nscan.html">The <code class="docutils literal notranslate"><span class="pre">nscan()</span></code> plan – scan multiple axes together</a></li>
<li class="toctree-l1"><a class="reference internal" href="pl_run_command_list.html">The <code class="xref py py-func docutils literal notranslate"><span class="pre">run_command_file()</span></code> plan – batch scans using a text file</a></li>
<li class="toctree-l1"><a class="reference internal" href="pl_tuneaxis.html">The <code class="docutils literal notranslate"><span class="pre">TuneAxis()</span></code> plan - align an axis with a signal</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumbs">
  <ul class="bd-breadcrumbs" role="navigation" aria-label="Breadcrumb">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">Guides</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">Area Detector, Single mode, HDF5 file</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="Area-Detector,-Single-mode,-HDF5-file">
<h1>Area Detector, Single mode, HDF5 file<a class="headerlink" href="#Area-Detector,-Single-mode,-HDF5-file" title="Permalink to this heading">#</a></h1>
<p><strong>Objective</strong></p>
<p>The <a class="reference external" href="https://areadetector.github.io/master/index.html">EPICS area detector</a> software has a <code class="docutils literal notranslate"><span class="pre">Single</span></code> mode that reduces the configuration steps needed to acquire image frame(s) and output file(s). (EPICS Area Detector will write each frame to a separate file.)</p>
<p>Here, we show how to configure the EPICS controls, then acquire an image with <a class="reference external" href="https://blueskyproject.io/">bluesky</a> and write it to an <a class="reference external" href="https://www.hdfgroup.org/solutions/hdf5">HDF5</a> file.</p>
<p><strong>Contents</strong></p>
<ul class="simple">
<li><p><a class="reference internal" href="#EPICS-Area-Detector-IOC"><span class="std std-ref">EPICS Area Detector IOC</span></a> is pre-built</p></li>
<li><p><a class="reference internal" href="#File-Directories"><span class="std std-ref">File Directories</span></a> are different on IOC and bluesky workstation</p></li>
<li><p><a class="reference internal" href="#ophyd"><span class="std std-ref">ophyd</span></a> to describe the hardware</p></li>
<li><p><a class="reference internal" href="#bluesky"><span class="std std-ref">bluesky</span></a> for the measurement</p></li>
<li><p><a class="reference internal" href="#databroker"><span class="std std-ref">databroker</span></a> to view the image</p></li>
<li><p><a class="reference internal" href="#punx"><span class="std std-ref">punx</span></a> (not part of Bluesky) to look at the HDF5 file</p></li>
<li><p><a class="reference internal" href="#Recapitulation"><span class="std std-ref">Recapitulation</span></a> - rendition with no explanations</p></li>
</ul>
<p>In other examples (such as AD with <a class="reference internal" href="de_0_adsim_hdf5_basic.html"><span class="doc">default file names</span></a> or <a class="reference internal" href="de_1_adsim_hdf5_custom_names.html"><span class="doc">custom file names</span></a>), we described the details of the area detector support. Refer to those examples for the details. Here, following the same general outline, we leverage that knowledge and proceed to the specifics for this example.</p>
<section id="EPICS-Area-Detector-IOC">
<h2>EPICS Area Detector IOC<a class="headerlink" href="#EPICS-Area-Detector-IOC" title="Permalink to this heading">#</a></h2>
<p>This example uses a prebuilt <a class="reference external" href="https://areadetector.github.io/master/ADSimDetector/simDetector.html">ADSimDetector</a> driver, packaged in a <a class="reference external" href="https://www.docker.com/">docker</a> image (<a class="reference external" href="https://hub.docker.com/r/prjemian/synapps/tags">prjemian/synapps</a>). The <a class="reference external" href="https://docs.epics-controls.org/projects/how-tos/en/latest/getting-started/creating-ioc.html">EPICS IOC</a> is configured with prefix <code class="docutils literal notranslate"><span class="pre">ad:</span></code> using the <a class="reference external" href="https://raw.githubusercontent.com/prjemian/epics-docker/main/resources/iocmgr.sh">bash shell
script</a>:</p>
<pre>
user@workstation:~$ <b>iocmgr.sh start ADSIM ad</b>
</pre><div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">IOC</span> <span class="o">=</span> <span class="s2">&quot;ad:&quot;</span>
</pre></div>
</div>
</div>
</section>
<section id="File-Directories">
<h2>File Directories<a class="headerlink" href="#File-Directories" title="Permalink to this heading">#</a></h2>
<p>Files from the IOC are mounted on the docker host in the directory <code class="docutils literal notranslate"><span class="pre">/tmp/docker_ioc/iocad</span></code>. The bluesky session runs on the docker host.</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>system</p></th>
<th class="head"><p>file directory</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>area detector IOC</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/tmp</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>bluesky</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/tmp/docker_ioc/iocad/tmp</span></code></p></td>
</tr>
</tbody>
</table>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pathlib</span>

<span class="c1"># These paths are specific to how this IOC is implemented.</span>
<span class="n">AD_IOC_MOUNT_PATH</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/tmp&quot;</span><span class="p">)</span>
<span class="n">BLUESKY_MOUNT_PATH</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/tmp/docker_ioc/iocad/tmp&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Next, define some structures that we will use when constructing the detector object. The <code class="docutils literal notranslate"><span class="pre">IMAGE_DIR</span></code> describes our default choice for where to store image files. We can change this at run time by changing thearea detector file writer’s <code class="docutils literal notranslate"><span class="pre">FilePath</span></code> PV (before starting image acquisition).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">IMAGE_DIR</span> <span class="o">=</span> <span class="s2">&quot;example/%Y/%m/</span><span class="si">%d</span><span class="s2">&quot;</span>  <span class="c1"># our choice for file arrangement</span>

<span class="c1"># MUST end with a `/`, pathlib will NOT provide it</span>
<span class="n">WRITE_PATH_TEMPLATE</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">AD_IOC_MOUNT_PATH</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">IMAGE_DIR</span><span class="si">}</span><span class="s2">/&quot;</span>
<span class="n">READ_PATH_TEMPLATE</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">BLUESKY_MOUNT_PATH</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">IMAGE_DIR</span><span class="si">}</span><span class="s2">/&quot;</span>
</pre></div>
</div>
</div>
</section>
<section id="ophyd">
<h2>ophyd<a class="headerlink" href="#ophyd" title="Permalink to this heading">#</a></h2>
<p>Here’s a screen view of the configuration we want (<code class="docutils literal notranslate"><span class="pre">HDF</span></code> plugin on the left, <code class="docutils literal notranslate"><span class="pre">cam</span></code> plugin on the right):</p>
<p><img alt="Area Detector configuration for writing HDF5 files in Single mode" src="../_images/ad_hdf5_single_mode.png" /></p>
<section id="Preparation">
<h3>Preparation<a class="headerlink" href="#Preparation" title="Permalink to this heading">#</a></h3>
<p>Configure how <a class="reference external" href="https://matplotlib.org/">matplotlib</a> charts will be displayed in the notebook.</p>
<p>We’ll import additional libraries as needed by each of the following steps.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># matplotlib graphics, choices include: inline, notebook, auto</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>  <span class="c1"># turn on matplotlib plots</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.pyplot._IonContext at 0x7fa2e7f64d30&gt;
</pre></div></div>
</div>
</section>
<section id="cam">
<h3>cam<a class="headerlink" href="#cam" title="Permalink to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">cam</span></code> Device describes the EPICS area detector camera driver for this detector. Here we use the <code class="docutils literal notranslate"><span class="pre">SimDetectorCam</span></code> (ADSimDetector) but you could use just about any other supported Cam instead.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">apstools.devices</span> <span class="kn">import</span> <span class="n">CamMixin_V34</span>
<span class="kn">from</span> <span class="nn">ophyd.areadetector</span> <span class="kn">import</span> <span class="n">SimDetectorCam</span>

<span class="k">class</span> <span class="nc">TheDetectorCam</span><span class="p">(</span><span class="n">CamMixin_V34</span><span class="p">,</span> <span class="n">SimDetectorCam</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Revise SimDetectorCam for ADCore revisions.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stage_sigs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">acquire_time</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
                <span class="n">acquire_period</span><span class="o">=</span><span class="mf">0.015</span><span class="p">,</span>  <span class="c1"># a wee bit longer than acquire_time</span>
                <span class="n">num_images</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">num_exposures</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  <span class="c1"># Exp./image</span>
                <span class="n">wait_for_plugins</span><span class="o">=</span><span class="s2">&quot;Yes&quot;</span><span class="p">,</span>
                <span class="n">array_callbacks</span><span class="o">=</span><span class="s2">&quot;Enable&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="HDF5">
<h3>HDF5<a class="headerlink" href="#HDF5" title="Permalink to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">hdf1</span></code> Device describes the HDF5 File Writing plugin for this detector. With <code class="docutils literal notranslate"><span class="pre">FileStoreHDF5SingleIterativeWrite</span></code>, you will get a single HDF5 file for each frame you acquire (<em>n</em> frames, <em>n</em> files).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ophyd.areadetector.filestore_mixins</span> <span class="kn">import</span> <span class="n">FileStoreHDF5SingleIterativeWrite</span>
<span class="kn">from</span> <span class="nn">ophyd.areadetector.plugins</span> <span class="kn">import</span> <span class="n">HDF5Plugin_V34</span> <span class="k">as</span> <span class="n">HDF5Plugin</span>
<span class="kn">import</span> <span class="nn">warnings</span>


<span class="k">class</span> <span class="nc">CustomHDF5Plugin</span><span class="p">(</span><span class="n">FileStoreHDF5SingleIterativeWrite</span><span class="p">,</span> <span class="n">HDF5Plugin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add data acquisition methods to HDF5Plugin.</span>

<span class="sd">    * ``stage()`` - prepare device PVs before data acquisition</span>
<span class="sd">    * ``unstage()`` - restore device PVs after data acquisition</span>
<span class="sd">    * ``generate_datum()`` - coordinate image storage metadata</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stage_sigs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">array_callbacks</span><span class="o">=</span><span class="s2">&quot;Disable&quot;</span><span class="p">,</span>
                <span class="n">auto_increment</span><span class="o">=</span><span class="s2">&quot;Yes&quot;</span><span class="p">,</span>
                <span class="n">auto_save</span><span class="o">=</span><span class="s2">&quot;Yes&quot;</span><span class="p">,</span>
                <span class="n">blocking_callbacks</span><span class="o">=</span><span class="s2">&quot;No&quot;</span><span class="p">,</span>
                <span class="n">compression</span><span class="o">=</span><span class="s2">&quot;zlib&quot;</span><span class="p">,</span>
                <span class="n">lazy_open</span><span class="o">=</span><span class="s2">&quot;Yes&quot;</span><span class="p">,</span>
                <span class="n">store_perform</span><span class="o">=</span><span class="s2">&quot;No&quot;</span><span class="p">,</span>
                <span class="n">zlevel</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># capture is not used with Single mode</span>
        <span class="c1"># parent.cam.array_callbacks is staged once in the cam</span>
        <span class="c1"># create_directory must be set before file_path, which is set before staging</span>
        <span class="n">remove_these</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            capture</span>
<span class="s2">            array_counter</span>
<span class="s2">            parent.cam.array_callbacks</span>
<span class="s2">            create_directory</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">remove_these</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage_sigs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stage_sigs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">stage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Again, do not press the Capture button in the HDF plugin</span>
        <span class="k">if</span> <span class="s2">&quot;capture&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage_sigs</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Do not use capture with file_write_mode=&#39;Single&#39;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stage_sigs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;capture&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">stage</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
<section id="detector">
<h3>detector<a class="headerlink" href="#detector" title="Permalink to this heading">#</a></h3>
<p>The detector class, a subclass of <code class="docutils literal notranslate"><span class="pre">DetectorBase</span></code>, brings together the detector driver <code class="docutils literal notranslate"><span class="pre">cam</span></code> and plugins.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">apstools.devices</span> <span class="kn">import</span> <span class="n">SingleTrigger_V34</span>
<span class="kn">from</span> <span class="nn">ophyd</span> <span class="kn">import</span> <span class="n">ADComponent</span>
<span class="kn">from</span> <span class="nn">ophyd.areadetector</span> <span class="kn">import</span> <span class="n">DetectorBase</span>
<span class="kn">from</span> <span class="nn">ophyd.areadetector.plugins</span> <span class="kn">import</span> <span class="n">ImagePlugin_V34</span> <span class="k">as</span> <span class="n">ImagePlugin</span>

<span class="k">class</span> <span class="nc">CustomDetector</span><span class="p">(</span><span class="n">SingleTrigger_V34</span><span class="p">,</span> <span class="n">DetectorBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ADSimDetector</span>

<span class="sd">    SingleTrigger:</span>

<span class="sd">    * stop any current acquisition</span>
<span class="sd">    * sets image_mode to &#39;Multiple&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">cam</span> <span class="o">=</span> <span class="n">ADComponent</span><span class="p">(</span><span class="n">TheDetectorCam</span><span class="p">,</span> <span class="s2">&quot;cam1:&quot;</span><span class="p">)</span>
    <span class="n">hdf1</span> <span class="o">=</span> <span class="n">ADComponent</span><span class="p">(</span>
        <span class="n">CustomHDF5Plugin</span><span class="p">,</span>
        <span class="s2">&quot;HDF1:&quot;</span><span class="p">,</span>
        <span class="n">write_path_template</span><span class="o">=</span><span class="n">WRITE_PATH_TEMPLATE</span><span class="p">,</span>
        <span class="n">read_path_template</span><span class="o">=</span><span class="n">READ_PATH_TEMPLATE</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">ADComponent</span><span class="p">(</span><span class="n">ImagePlugin</span><span class="p">,</span> <span class="s2">&quot;image1:&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>With all the above setup, create the Python detector object, <code class="docutils literal notranslate"><span class="pre">adsimdet</span></code> and wait for it to connect with EPICS.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adsimdet</span> <span class="o">=</span> <span class="n">CustomDetector</span><span class="p">(</span><span class="n">IOC</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;adsimdet&quot;</span><span class="p">)</span>
<span class="n">adsimdet</span><span class="o">.</span><span class="n">wait_for_connection</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Check that all plugins used by the IOC have been defined in the Python structure. Expect that this function returns an empty list: <code class="docutils literal notranslate"><span class="pre">[]</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adsimdet</span><span class="o">.</span><span class="n">missing_plugins</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[]
</pre></div></div>
</div>
<p>We must configure <code class="docutils literal notranslate"><span class="pre">adsimdet</span></code> so the HDF5 plugin (by its attribute name <code class="docutils literal notranslate"><span class="pre">hdf1</span></code>) will be called during <code class="docutils literal notranslate"><span class="pre">adsimdet.read()</span></code>, as used by data acquisition.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adsimdet</span><span class="o">.</span><span class="n">read_attrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;hdf1&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Configure the HDF5 plugin so it will create up to 5 subdirectories for the image directory.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adsimdet</span><span class="o">.</span><span class="n">hdf1</span><span class="o">.</span><span class="n">create_directory</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p><em>Prime</em> the HDF5 plugin, if necessary.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">apstools.devices</span> <span class="kn">import</span> <span class="n">ensure_AD_plugin_primed</span>

<span class="c1"># this step is needed for ophyd</span>
<span class="n">ensure_AD_plugin_primed</span><span class="p">(</span><span class="n">adsimdet</span><span class="o">.</span><span class="n">hdf1</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Check how <code class="docutils literal notranslate"><span class="pre">adsim</span></code> is <a class="reference external" href="https://blueskyproject.io/ophyd/user_v1/explanations/staging.html">staged</a> (configured for data acquisition).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adsimdet</span><span class="o">.</span><span class="n">stage_sigs</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
OrderedDict([(&#39;cam.acquire&#39;, 0), (&#39;cam.image_mode&#39;, 1)])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># adsimdet.cam.stage_sigs[&quot;num_images&quot;] = 1  # default is 1</span>
<span class="n">adsimdet</span><span class="o">.</span><span class="n">cam</span><span class="o">.</span><span class="n">stage_sigs</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
OrderedDict([(&#39;acquire_time&#39;, 0.01),
             (&#39;acquire_period&#39;, 0.015),
             (&#39;num_images&#39;, 1),
             (&#39;num_exposures&#39;, 1),
             (&#39;wait_for_plugins&#39;, &#39;Yes&#39;),
             (&#39;array_callbacks&#39;, &#39;Enable&#39;)])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adsimdet</span><span class="o">.</span><span class="n">hdf1</span><span class="o">.</span><span class="n">stage_sigs</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
OrderedDict([(&#39;enable&#39;, 1),
             (&#39;blocking_callbacks&#39;, &#39;No&#39;),
             (&#39;auto_increment&#39;, &#39;Yes&#39;),
             (&#39;auto_save&#39;, &#39;Yes&#39;),
             (&#39;num_capture&#39;, 0),
             (&#39;file_template&#39;, &#39;%s%s_%6.6d.h5&#39;),
             (&#39;file_write_mode&#39;, &#39;Single&#39;),
             (&#39;array_callbacks&#39;, &#39;Disable&#39;),
             (&#39;compression&#39;, &#39;zlib&#39;),
             (&#39;lazy_open&#39;, &#39;Yes&#39;),
             (&#39;store_perform&#39;, &#39;No&#39;),
             (&#39;zlevel&#39;, 6)])
</pre></div></div>
</div>
</section>
</section>
<section id="bluesky">
<h2>bluesky<a class="headerlink" href="#bluesky" title="Permalink to this heading">#</a></h2>
<p>Within the <a class="reference external" href="https://blueskyproject.io/">Bluesky framework</a>, <a class="reference external" href="https://blueskyproject.io/bluesky">bluesky</a> is the package that orchestrates the data acquisition steps, including where to direct acquired data for storage. <a class="reference internal" href="#databroker"><span class="std std-ref">Later</span></a>, we’ll use <a class="reference external" href="https://blueskyproject.io/databroker">databroker</a> to access the image data.</p>
<p>First, setup the RunEngine object <code class="docutils literal notranslate"><span class="pre">RE</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">bluesky</span>

<span class="n">RE</span> <span class="o">=</span> <span class="n">bluesky</span><span class="o">.</span><span class="n">RunEngine</span><span class="p">()</span>
</pre></div>
</div>
</div>
<section id="databroker-(as-RunEngine-subscriber)">
<h3>databroker (as RunEngine subscriber)<a class="headerlink" href="#databroker-(as-RunEngine-subscriber)" title="Permalink to this heading">#</a></h3>
<p>Setup the databroker (with a temporary databroker catalog) as a subscriber to the documents published from the bluesky <code class="docutils literal notranslate"><span class="pre">RunEngine</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">databroker</span>

<span class="n">cat</span> <span class="o">=</span> <span class="n">databroker</span><span class="o">.</span><span class="n">temp</span><span class="p">()</span><span class="o">.</span><span class="n">v2</span>  <span class="c1"># or use your own catalog: databroker.catalog[&quot;CATALOG_NAME&quot;]</span>
<span class="n">cat</span> <span class="o">=</span> <span class="n">databroker</span><span class="o">.</span><span class="n">catalog</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">]</span>
<span class="n">RE</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">cat</span><span class="o">.</span><span class="n">v1</span><span class="o">.</span><span class="n">insert</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0
</pre></div></div>
</div>
<p><strong>Take an image with the area detector</strong></p>
<p>Finally, we are ready to acquire an image. We’ll use the standard bluesky <a class="reference external" href="https://blueskyproject.io/bluesky/generated/bluesky.plans.count.html#bluesky.plans.count">count()</a> plan. Also add some metadata about this image.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">bluesky.plans</span> <span class="k">as</span> <span class="nn">bp</span>

<span class="n">uids</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span>
    <span class="n">bp</span><span class="o">.</span><span class="n">count</span><span class="p">([</span><span class="n">adsimdet</span><span class="p">],</span>
    <span class="n">md</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Area Detector, Single mode, HDF5 file&quot;</span><span class="p">,</span>
        <span class="n">purpose</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="databroker">
<h2>databroker<a class="headerlink" href="#databroker" title="Permalink to this heading">#</a></h2>
<p>Here we show how to access and display the acquired image using databroker as the interface to the data files and run metadata.</p>
<p>First, find the run we just acquired. We’ll index to that run using the <code class="docutils literal notranslate"><span class="pre">uid</span></code> returned by the above call to <code class="docutils literal notranslate"><span class="pre">RE()</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run</span> <span class="o">=</span> <span class="n">cat</span><span class="o">.</span><span class="n">v2</span><span class="p">[</span><span class="n">uids</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<span class="n">run</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
BlueskyRun
  uid=&#39;6780800e-b08a-4933-bf26-8618b3fb53ed&#39;
  exit_status=&#39;success&#39;
  2022-09-30 16:31:38.860 -- 2022-09-30 16:31:38.965
  Streams:
    * primary

</pre></div></div>
</div>
<p><strong>Get the image frame from the run</strong></p>
<p>Combining several steps into one line, extract the image frame from the run. We know the image data is in the <code class="docutils literal notranslate"><span class="pre">primary</span></code> stream, that the image is recorded under the name <code class="docutils literal notranslate"><span class="pre">&quot;adsimdet_image&quot;</span></code> (or <code class="docutils literal notranslate"><span class="pre">adsimdet.image.name</span></code>), and the <code class="docutils literal notranslate"><span class="pre">image</span></code> frame is the last two indices.</p>
<p>Import <a class="reference external" href="https://hdf5plugin.readthedocs.io">hdf5plugin</a>, a library that supports advanced compression modes for data in HDF5 files. (We don’t have to call any of its modules directly. The <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">hdf5plugin</span></code> will install entry points needed when the supported compression modes are called.) We did not need this previously since it was the IOC that wrote the HDF5 file with the chosen compression mode.</p>
<p>NOTE: Any Python client that reads data compressed with these compression modes will also need to import the <code class="docutils literal notranslate"><span class="pre">hdf5plugin</span></code> library, or provide alternative support.</p>
<p>NOTE: Make sure you are using at least version 0.0.10 (or higher) of the <a class="reference external" href="https://github.com/bluesky/area-detector-handlers/pull/32">area-detector-handlers</a> for an important bugfix relating to how databroker will read these HDF5 files.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">hdf5plugin</span>  <span class="c1"># required for LZ4, Blosc, and other compression codecs</span>

<span class="n">frame</span> <span class="o">=</span> <span class="n">run</span><span class="o">.</span><span class="n">primary</span><span class="o">.</span><span class="n">read</span><span class="p">()[</span><span class="n">adsimdet</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">frame</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray &#x27;adsimdet_image&#x27; (dim_1: 1024, dim_2: 1024)&gt;
array([[ 9, 10, 11, ...,  6,  7,  8],
       [10, 11, 12, ...,  7,  8,  9],
       [11, 12, 13, ...,  8,  9, 10],
       ...,
       [ 6,  7,  8, ...,  3,  4,  5],
       [ 7,  8,  9, ...,  4,  5,  6],
       [ 8,  9, 10, ...,  5,  6,  7]], dtype=uint8)
Coordinates:
    time     float64 1.665e+09
Dimensions without coordinates: dim_1, dim_2
Attributes:
    object:   adsimdet</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'>'adsimdet_image'</div><ul class='xr-dim-list'><li><span>dim_1</span>: 1024</li><li><span>dim_2</span>: 1024</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-825af180-07d0-426e-a747-01fc7e31d0cf' class='xr-array-in' type='checkbox' checked><label for='section-825af180-07d0-426e-a747-01fc7e31d0cf' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>9 10 11 12 13 14 15 16 17 18 19 20 ... 252 253 254 255 0 1 2 3 4 5 6 7</span></div><div class='xr-array-data'><pre>array([[ 9, 10, 11, ...,  6,  7,  8],
       [10, 11, 12, ...,  7,  8,  9],
       [11, 12, 13, ...,  8,  9, 10],
       ...,
       [ 6,  7,  8, ...,  3,  4,  5],
       [ 7,  8,  9, ...,  4,  5,  6],
       [ 8,  9, 10, ...,  5,  6,  7]], dtype=uint8)</pre></div></div></li><li class='xr-section-item'><input id='section-49c877c0-88a1-4bdd-a44a-7f8e14fb57f8' class='xr-section-summary-in' type='checkbox'  checked><label for='section-49c877c0-88a1-4bdd-a44a-7f8e14fb57f8' class='xr-section-summary' >Coordinates: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>time</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>1.665e+09</div><input id='attrs-e09bf08f-59a8-42f0-af47-46ce06d24518' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-e09bf08f-59a8-42f0-af47-46ce06d24518' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-7e2c00f1-ff9d-48cc-b963-ff96a5e50e88' class='xr-var-data-in' type='checkbox'><label for='data-7e2c00f1-ff9d-48cc-b963-ff96a5e50e88' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array(1.6645735e+09)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-5fc00c4c-3e4e-45ae-b7bf-5ef90e8f4237' class='xr-section-summary-in' type='checkbox'  checked><label for='section-5fc00c4c-3e4e-45ae-b7bf-5ef90e8f4237' class='xr-section-summary' >Attributes: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>object :</span></dt><dd>adsimdet</dd></dl></div></li></ul></div></div></div>
</div>
<section id="Visualize-the-image">
<h3>Visualize the image<a class="headerlink" href="#Visualize-the-image" title="Permalink to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">frame</span></code> is an <a class="reference external" href="https://docs.xarray.dev/en/stable/generated/xarray.Dataset.html">xarray Dataset</a>, which has a method to visualize the data as shown here:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">frame</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.collections.QuadMesh at 0x7fa2623cedc0&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_de_2_adsim_hdf5_single_mode_42_1.png" src="../_images/examples_de_2_adsim_hdf5_single_mode_42_1.png" />
</div>
</div>
</section>
<section id="Where-is-the-image-file-on-disk?">
<h3>Where is the image file on disk?<a class="headerlink" href="#Where-is-the-image-file-on-disk?" title="Permalink to this heading">#</a></h3>
<p>So far, we have not had to know the name of the file on disk with the image data. Still, we can learn about that from the run’s metadata, by querying one of its internal structures.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rsrc</span> <span class="o">=</span> <span class="n">run</span><span class="o">.</span><span class="n">primary</span><span class="o">.</span><span class="n">_resources</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">rsrc</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Resource({&#39;path_semantics&#39;: &#39;posix&#39;,
 &#39;resource_kwargs&#39;: {&#39;filename&#39;: &#39;62e73032-4d57-4e37-b784&#39;,
                     &#39;frame_per_point&#39;: 1,
                     &#39;template&#39;: &#39;%s%s_%6.6d.h5&#39;},
 &#39;resource_path&#39;: &#39;tmp/docker_ioc/iocad/tmp/example/2022/09/30&#39;,
 &#39;root&#39;: &#39;/&#39;,
 &#39;run_start&#39;: &#39;6780800e-b08a-4933-bf26-8618b3fb53ed&#39;,
 &#39;spec&#39;: &#39;AD_HDF5_SINGLE&#39;,
 &#39;uid&#39;: &#39;e00f8f86-4dbe-46c1-959e-3d504986b7f5&#39;})
</pre></div></div>
</div>
<p>This information has shown the path to the image file <em>as seen from the bluesky workstation’s file system.</em> We can parse this structure for the file name. In this case, the file is found since the <code class="docutils literal notranslate"><span class="pre">resource_path</span></code> is written relative to the <code class="docutils literal notranslate"><span class="pre">READ_PATH_TEMPLATE</span></code> defined <a class="reference internal" href="#File-Directories"><span class="std std-ref">above</span></a>. It takes a bit of work to re-assemble the file name.</p>
<p>This is an important distinction since the IOC and bluesky see the same file on different directory paths, as described <a class="reference internal" href="#File-Directories"><span class="std std-ref">above</span></a>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">file_name</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span>
    <span class="n">rsrc</span><span class="p">[</span><span class="s2">&quot;resource_kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;template&quot;</span><span class="p">]</span> <span class="o">%</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rsrc</span><span class="p">[</span><span class="s1">&#39;root&#39;</span><span class="p">]</span><span class="si">}{</span><span class="n">rsrc</span><span class="p">[</span><span class="s1">&#39;resource_path&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">/&quot;</span><span class="p">,</span>
        <span class="n">rsrc</span><span class="p">[</span><span class="s2">&quot;resource_kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;filename&quot;</span><span class="p">],</span>
        <span class="n">rsrc</span><span class="p">[</span><span class="s2">&quot;resource_kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;frame_per_point&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_name</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span><span class="si">=}</span><span class="se">\n</span><span class="si">{</span><span class="n">file_name</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
file_name.exists()=True
file_name=PosixPath(&#39;/tmp/docker_ioc/iocad/tmp/example/2022/09/30/62e73032-4d57-4e37-b784_000000.h5&#39;)
</pre></div></div>
</div>
<p>Alternatively, get the name of the image file on the bluesky (local) workstation from the <code class="docutils literal notranslate"><span class="pre">adsimdet</span></code> object.</p>
<p>NOTE: This method relies on information currently defined in EPICS, via the <code class="docutils literal notranslate"><span class="pre">adsimdet.hdf1</span></code>, so it may not be successful if the HDF plugin has been changed since the image was acquired.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">apstools.devices</span> <span class="kn">import</span> <span class="n">AD_full_file_name_local</span>

<span class="n">local_file_name</span> <span class="o">=</span> <span class="n">AD_full_file_name_local</span><span class="p">(</span><span class="n">adsimdet</span><span class="o">.</span><span class="n">hdf1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">local_file_name</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span><span class="si">=}</span><span class="se">\n</span><span class="si">{</span><span class="n">local_file_name</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">local_file_name</span> <span class="o">==</span> <span class="n">file_name</span>  <span class="c1"># compare the two names</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
local_file_name.exists()=True
local_file_name=PosixPath(&#39;/tmp/docker_ioc/iocad/tmp/example/2022/09/30/62e73032-4d57-4e37-b784_000000.h5&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
</section>
</section>
<section id="punx">
<h2>punx<a class="headerlink" href="#punx" title="Permalink to this heading">#</a></h2>
<p>Next, we demonstrate access to the HDF5 image file using the <a class="reference external" href="https://punx.readthedocs.io">punx</a> program, showing the tree structure of the data file (the image data may be found at HDF5 address <code class="docutils literal notranslate"><span class="pre">/entry/data/data</span></code>, another reference to the exact same data is found at <code class="docutils literal notranslate"><span class="pre">/entry/instrument/detector/data</span></code>):</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">apstools.utils</span> <span class="kn">import</span> <span class="n">unix</span>

<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">unix</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;punx tree </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
!!! WARNING: this program is not ready for distribution.

/tmp/docker_ioc/iocad/tmp/example/2022/09/30/62e73032-4d57-4e37-b784_000000.h5 : NeXus data file
  entry:NXentry
    @NX_class = &#34;NXentry&#34;
    data:NXdata
      @NX_class = &#34;NXdata&#34;
      data:NX_UINT8[1024,1024] = __array
        __array = [
            [9, 10, 11, &#39;...&#39;, 8]
            [10, 11, 12, &#39;...&#39;, 9]
            [11, 12, 13, &#39;...&#39;, 10]
            ...
            [8, 9, 10, &#39;...&#39;, 7]
          ]
        @NDArrayDimBinning = [1 1]
        @NDArrayDimOffset = [0 0]
        @NDArrayDimReverse = [0 0]
        @NDArrayNumDims = 2
        @signal = 1
    instrument:NXinstrument
      @NX_class = &#34;NXinstrument&#34;
      NDAttributes:NXcollection
        @NX_class = &#34;NXcollection&#34;
        @hostname = &#34;zap&#34;
        NDArrayEpicsTSSec:NX_UINT32 = 1033421498
          @NDAttrDescription = &#34;The NDArray EPICS timestamp seconds past epoch&#34;
          @NDAttrName = &#34;NDArrayEpicsTSSec&#34;
          @NDAttrSource = &#34;Driver&#34;
          @NDAttrSourceType = &#34;NDAttrSourceDriver&#34;
        NDArrayEpicsTSnSec:NX_UINT32 = 913238900
          @NDAttrDescription = &#34;The NDArray EPICS timestamp nanoseconds&#34;
          @NDAttrName = &#34;NDArrayEpicsTSnSec&#34;
          @NDAttrSource = &#34;Driver&#34;
          @NDAttrSourceType = &#34;NDAttrSourceDriver&#34;
        NDArrayTimeStamp:NX_FLOAT64 = 1033421498.9031079
          @NDAttrDescription = &#34;The timestamp of the NDArray as float64&#34;
          @NDAttrName = &#34;NDArrayTimeStamp&#34;
          @NDAttrSource = &#34;Driver&#34;
          @NDAttrSourceType = &#34;NDAttrSourceDriver&#34;
        NDArrayUniqueId:NX_INT32 = 1033
          @NDAttrDescription = &#34;The unique ID of the NDArray&#34;
          @NDAttrName = &#34;NDArrayUniqueId&#34;
          @NDAttrSource = &#34;Driver&#34;
          @NDAttrSourceType = &#34;NDAttrSourceDriver&#34;
      detector:NXdetector
        @NX_class = &#34;NXdetector&#34;
        data:NX_UINT8[1024,1024] = __array
          __array = [
              [9, 10, 11, &#39;...&#39;, 8]
              [10, 11, 12, &#39;...&#39;, 9]
              [11, 12, 13, &#39;...&#39;, 10]
              ...
              [8, 9, 10, &#39;...&#39;, 7]
            ]
          @NDArrayDimBinning = [1 1]
          @NDArrayDimOffset = [0 0]
          @NDArrayDimReverse = [0 0]
          @NDArrayNumDims = 2
          @signal = 1
        NDAttributes:NXcollection
          @NX_class = &#34;NXcollection&#34;
          ColorMode:NX_INT32 = 0
            @NDAttrDescription = &#34;Color mode&#34;
            @NDAttrName = &#34;ColorMode&#34;
            @NDAttrSource = &#34;Driver&#34;
            @NDAttrSourceType = &#34;NDAttrSourceDriver&#34;
      performance

</pre></div></div>
</div>
</section>
<section id="Recapitulation">
<h2>Recapitulation<a class="headerlink" href="#Recapitulation" title="Permalink to this heading">#</a></h2>
<p>Let’s gather the above parts together as one would usually write code.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="c1"># matplotlib graphics, choices include: inline, notebook, auto</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">auto</span>

<span class="kn">from</span> <span class="nn">apstools.devices</span> <span class="kn">import</span> <span class="n">ensure_AD_plugin_primed</span>
<span class="kn">from</span> <span class="nn">apstools.devices</span> <span class="kn">import</span> <span class="n">CamMixin_V34</span>
<span class="kn">from</span> <span class="nn">apstools.devices</span> <span class="kn">import</span> <span class="n">SingleTrigger_V34</span>
<span class="kn">import</span> <span class="nn">hdf5plugin</span>  <span class="c1"># required for LZ4, Blosc, and other compression codecs</span>
<span class="kn">from</span> <span class="nn">ophyd</span> <span class="kn">import</span> <span class="n">ADComponent</span>
<span class="kn">from</span> <span class="nn">ophyd.areadetector</span> <span class="kn">import</span> <span class="n">DetectorBase</span>
<span class="kn">from</span> <span class="nn">ophyd.areadetector</span> <span class="kn">import</span> <span class="n">SimDetectorCam</span>
<span class="kn">from</span> <span class="nn">ophyd.areadetector.filestore_mixins</span> <span class="kn">import</span> <span class="n">FileStoreHDF5SingleIterativeWrite</span>
<span class="kn">from</span> <span class="nn">ophyd.areadetector.plugins</span> <span class="kn">import</span> <span class="n">HDF5Plugin_V34</span> <span class="k">as</span> <span class="n">HDF5Plugin</span>
<span class="kn">from</span> <span class="nn">ophyd.areadetector.plugins</span> <span class="kn">import</span> <span class="n">ImagePlugin_V34</span> <span class="k">as</span> <span class="n">ImagePlugin</span>
<span class="kn">import</span> <span class="nn">bluesky</span>
<span class="kn">import</span> <span class="nn">bluesky.plans</span> <span class="k">as</span> <span class="nn">bp</span>
<span class="kn">import</span> <span class="nn">databroker</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pathlib</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>  <span class="c1"># turn on matplotlib plots</span>

<span class="n">RE</span> <span class="o">=</span> <span class="n">bluesky</span><span class="o">.</span><span class="n">RunEngine</span><span class="p">()</span>
<span class="n">cat</span> <span class="o">=</span> <span class="n">databroker</span><span class="o">.</span><span class="n">temp</span><span class="p">()</span><span class="o">.</span><span class="n">v2</span>
<span class="c1"># or use your own catalog like this example:</span>
<span class="c1"># cat = databroker.catalog[&quot;training&quot;]</span>
<span class="n">RE</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">cat</span><span class="o">.</span><span class="n">v1</span><span class="o">.</span><span class="n">insert</span><span class="p">)</span>

<span class="n">IOC</span> <span class="o">=</span> <span class="s2">&quot;ad:&quot;</span>

<span class="c1"># These paths are specific to how this IOC is implemented.</span>
<span class="n">AD_IOC_MOUNT_PATH</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/tmp&quot;</span><span class="p">)</span>
<span class="n">BLUESKY_MOUNT_PATH</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/tmp/docker_ioc/iocad/tmp&quot;</span><span class="p">)</span>

<span class="n">IMAGE_DIR</span> <span class="o">=</span> <span class="s2">&quot;example/%Y/%m/</span><span class="si">%d</span><span class="s2">&quot;</span>  <span class="c1"># our choice for file arrangement</span>

<span class="c1"># MUST end with a `/`, pathlib will NOT provide it</span>
<span class="n">WRITE_PATH_TEMPLATE</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">AD_IOC_MOUNT_PATH</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">IMAGE_DIR</span><span class="si">}</span><span class="s2">/&quot;</span>
<span class="n">READ_PATH_TEMPLATE</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">BLUESKY_MOUNT_PATH</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">IMAGE_DIR</span><span class="si">}</span><span class="s2">/&quot;</span>


<span class="k">class</span> <span class="nc">TheDetectorCam</span><span class="p">(</span><span class="n">CamMixin_V34</span><span class="p">,</span> <span class="n">SimDetectorCam</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Revise SimDetectorCam for ADCore revisions.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stage_sigs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">acquire_time</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
                <span class="n">acquire_period</span><span class="o">=</span><span class="mf">0.015</span><span class="p">,</span>  <span class="c1"># a wee bit longer than acquire_time</span>
                <span class="n">num_images</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">num_exposures</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  <span class="c1"># Exp./image</span>
                <span class="n">wait_for_plugins</span><span class="o">=</span><span class="s2">&quot;Yes&quot;</span><span class="p">,</span>
                <span class="n">array_callbacks</span><span class="o">=</span><span class="s2">&quot;Enable&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>


<span class="k">class</span> <span class="nc">CustomHDF5Plugin</span><span class="p">(</span><span class="n">FileStoreHDF5SingleIterativeWrite</span><span class="p">,</span> <span class="n">HDF5Plugin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add data acquisition methods to HDF5Plugin.</span>

<span class="sd">    * ``stage()`` - prepare device PVs before data acquisition</span>
<span class="sd">    * ``unstage()`` - restore device PVs after data acquisition</span>
<span class="sd">    * ``generate_datum()`` - coordinate image storage metadata</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stage_sigs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">array_callbacks</span><span class="o">=</span><span class="s2">&quot;Disable&quot;</span><span class="p">,</span>
                <span class="n">auto_increment</span><span class="o">=</span><span class="s2">&quot;Yes&quot;</span><span class="p">,</span>
                <span class="n">auto_save</span><span class="o">=</span><span class="s2">&quot;Yes&quot;</span><span class="p">,</span>
                <span class="n">blocking_callbacks</span><span class="o">=</span><span class="s2">&quot;No&quot;</span><span class="p">,</span>
                <span class="n">compression</span><span class="o">=</span><span class="s2">&quot;zlib&quot;</span><span class="p">,</span>
                <span class="n">lazy_open</span><span class="o">=</span><span class="s2">&quot;Yes&quot;</span><span class="p">,</span>
                <span class="n">store_perform</span><span class="o">=</span><span class="s2">&quot;No&quot;</span><span class="p">,</span>
                <span class="n">zlevel</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># capture is not used with Single mode</span>
        <span class="c1"># parent.cam.array_callbacks is staged once in the cam</span>
        <span class="c1"># create_directory must be set before file_path, which is set before staging</span>
        <span class="n">remove_these</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            capture</span>
<span class="s2">            array_counter</span>
<span class="s2">            parent.cam.array_callbacks</span>
<span class="s2">            create_directory</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">remove_these</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage_sigs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stage_sigs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">stage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Again, do not press the Capture button in the HDF plugin</span>
        <span class="k">if</span> <span class="s2">&quot;capture&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage_sigs</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Do not use capture with file_write_mode=&#39;Single&#39;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stage_sigs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;capture&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">stage</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">CustomDetector</span><span class="p">(</span><span class="n">SingleTrigger_V34</span><span class="p">,</span> <span class="n">DetectorBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ADSimDetector</span>

<span class="sd">    SingleTrigger:</span>

<span class="sd">    * stop any current acquisition</span>
<span class="sd">    * sets image_mode to &#39;Multiple&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">cam</span> <span class="o">=</span> <span class="n">ADComponent</span><span class="p">(</span><span class="n">TheDetectorCam</span><span class="p">,</span> <span class="s2">&quot;cam1:&quot;</span><span class="p">)</span>
    <span class="n">hdf1</span> <span class="o">=</span> <span class="n">ADComponent</span><span class="p">(</span>
        <span class="n">CustomHDF5Plugin</span><span class="p">,</span>
        <span class="s2">&quot;HDF1:&quot;</span><span class="p">,</span>
        <span class="n">write_path_template</span><span class="o">=</span><span class="n">WRITE_PATH_TEMPLATE</span><span class="p">,</span>
        <span class="n">read_path_template</span><span class="o">=</span><span class="n">READ_PATH_TEMPLATE</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">ADComponent</span><span class="p">(</span><span class="n">ImagePlugin</span><span class="p">,</span> <span class="s2">&quot;image1:&quot;</span><span class="p">)</span>


<span class="n">adsimdet</span> <span class="o">=</span> <span class="n">CustomDetector</span><span class="p">(</span><span class="n">IOC</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;adsimdet&quot;</span><span class="p">)</span>
<span class="n">adsimdet</span><span class="o">.</span><span class="n">wait_for_connection</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">adsimdet</span><span class="o">.</span><span class="n">missing_plugins</span><span class="p">()</span>
<span class="n">adsimdet</span><span class="o">.</span><span class="n">read_attrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;hdf1&quot;</span><span class="p">)</span>
<span class="n">adsimdet</span><span class="o">.</span><span class="n">hdf1</span><span class="o">.</span><span class="n">create_directory</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">)</span>
<span class="n">NUM_FRAMES</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">adsimdet</span><span class="o">.</span><span class="n">cam</span><span class="o">.</span><span class="n">stage_sigs</span><span class="p">[</span><span class="s2">&quot;num_frames&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">NUM_FRAMES</span>

<span class="c1"># this step is needed for ophyd</span>
<span class="n">ensure_AD_plugin_primed</span><span class="p">(</span><span class="n">adsimdet</span><span class="o">.</span><span class="n">hdf1</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>


<span class="n">uids</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span>
    <span class="n">bp</span><span class="o">.</span><span class="n">count</span><span class="p">([</span><span class="n">adsimdet</span><span class="p">],</span>
    <span class="n">md</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Area Detector, Single mode, HDF5 file&quot;</span><span class="p">,</span>
        <span class="n">purpose</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">run</span> <span class="o">=</span> <span class="n">cat</span><span class="o">.</span><span class="n">v2</span><span class="p">[</span><span class="n">uids</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<span class="n">frame</span> <span class="o">=</span> <span class="n">run</span><span class="o">.</span><span class="n">primary</span><span class="o">.</span><span class="n">read</span><span class="p">()[</span><span class="n">adsimdet</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

<span class="n">frame</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">()</span>  <span class="c1"># show the image</span>
</pre></div>
</div>
</section>
</section>


                </article>
              
              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="de_1_adsim_hdf5_custom_names.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Area Detector with custom HDF5 File Name</p>
      </div>
    </a>
    <a class="right-next"
       href="de_ad_pe.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">ADPerkinElmer Area Detector with default HDF5 File Name</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#EPICS-Area-Detector-IOC">EPICS Area Detector IOC</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#File-Directories">File Directories</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ophyd">ophyd</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Preparation">Preparation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cam">cam</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#HDF5">HDF5</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#detector">detector</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bluesky">bluesky</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#databroker-(as-RunEngine-subscriber)">databroker (as RunEngine subscriber)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#databroker">databroker</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Visualize-the-image">Visualize the image</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Where-is-the-image-file-on-disk?">Where is the image file on disk?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#punx">punx</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Recapitulation">Recapitulation</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div class="tocsection sourcelink">
    <a href="../_sources/examples/de_2_adsim_hdf5_single_mode.ipynb.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      © Copyright 2017-2023, UChicago Argonne, LLC.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    <br/>
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.13.3.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>